## Copyright (C) 2007-2012, 2014-2017 Free Software Foundation, Inc.
## Written by Keisuke Nishida, Roger While, Simon Sobisch, Edward Hart,
## Ron Norman
##
## This file is part of GnuCOBOL.
##
## The GnuCOBOL compiler is free software: you can redistribute it
## and/or modify it under the terms of the GNU General Public License
## as published by the Free Software Foundation, either version 3 of the
## License, or (at your option) any later version.
##
## GnuCOBOL is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
## GNU General Public License for more details.
##
## You should have received a copy of the GNU General Public License
## along with GnuCOBOL.  If not, see <http://www.gnu.org/licenses/>.

### GnuCOBOL Test Suite


AT_SETUP([Ambiguous AND/OR])
AT_KEYWORDS([misc expression])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 ONE   PIC 9 VALUE 1.
       01 TWO   PIC 9 VALUE 2.
       01 THREE PIC 9 VALUE 3.
       PROCEDURE        DIVISION.
           IF THREE = ONE AND TWO OR THREE
               DISPLAY "OK"
               END-DISPLAY
           END-IF.
           IF THREE = ONE OR TWO AND THREE
               DISPLAY "NO"
               END-DISPLAY
           END-IF.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [0], [],
[prog.cob: 11: Warning: Suggest parentheses around AND within OR
prog.cob: 15: Warning: Suggest parentheses around OR within AND
])

AT_CLEANUP

AT_SETUP([Incorrect Conditional])
AT_KEYWORDS([EXPRESSION])

AT_DATA([prog.cob], [
       IDENTIFICATION DIVISION.
       PROGRAM-ID. prog.
       ENVIRONMENT DIVISION.
       DATA DIVISION.
      ******************************************************************
       WORKING-STORAGE SECTION.
      *
       01 FLD9 PIC 9 VALUE 1.
       01 FLD8 PIC 9 VALUE 2.
       01 FLDX PIC 9 VALUE 5.
       01 FLDY PIC 9 VALUE 6.

       PROCEDURE DIVISION.
           IF 1 AND 2 > 1 THEN
                DISPLAY 'Test 1 is WRONG'
           ELSE
                DISPLAY 'Test 1 is OK'.

           IF FLD8 AND FLDX > FLD9 THEN
                DISPLAY 'Test 2 is OK' 
           ELSE
                DISPLAY 'Test 2 is Wrong'.

           IF FLD8 OR FLDX > FLD9 THEN
                DISPLAY 'Test 2 is OK' 
           ELSE
                DISPLAY 'Test 2 is Wrong'.

           IF FLD8 > 2 AND FLDX > FLD9 THEN
                DISPLAY 'Test 2 is OK' 
           ELSE
                DISPLAY 'Test 2 is Wrong'.

           IF FLD9 IS NUMERIC AND FLD8 THEN
                DISPLAY 'Test 2 is OK' 
           ELSE
                DISPLAY 'Test 2 is Wrong'.

           IF FLDX > FLD9 AND FLD8 AND 9 THEN
                DISPLAY 'Test 3 is OK ' FLDX ' > ' FLD9 ' & ' FLD8
           ELSE
                DISPLAY 'Test 3 is Wrong'.

           IF FLDX > FLD9 OR FLD8 OR 9 THEN
                DISPLAY 'Test 3 is OK'
           ELSE
                DISPLAY 'Test 3 is Wrong'.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -std=cobol2002 prog.cob ], [1], [],
[prog.cob: 15: Error: Invalid conditional expression
prog.cob: 20: Error: Invalid conditional expression
prog.cob: 25: Error: Invalid conditional expression
prog.cob: 35: Error: Invalid expression
])

AT_CLEANUP

AT_SETUP([Warn Literal size])
AT_KEYWORDS([Numeric])

AT_DATA([prog.cob], [
       IDENTIFICATION DIVISION.
       PROGRAM-ID. prog.
       DATA DIVISION.
       WORKING-STORAGE SECTION.
       01 WS-LINE-NUMBER    PIC 9(3) VALUE ZERO.
       01 WS-NUMBER         PIC 9(3)V99 VALUE ZERO.
       01 WS-TEXT           PIC X(5) VALUE 'CAT'.
       01 PIC-9-SIGNED      PIC S9(2) VALUE 5.
       01 PIC-9-NOT-SIGNED  PIC 9(3) VALUE 5.
       01 PIC-9-NOT-DECIMAL PIC 9(3) VALUE 5.
       01 XX                PIC 9(2) VALUE 2.
       01 PIC-9-DECIMAL     PIC 9(3)V9 VALUE 5.
       01 COMPUTE-1         PIC 999V9999 VALUE 654.1873.
       01 GROUP-ITEM-X6     PIC X(6) VALUE 'CAT'.
       01 IF-D16            PIC PP99 VALUE .0012.
       PROCEDURE DIVISION.
       MAIN.
           IF GROUP-ITEM-X6 = '1234567' 
               CONTINUE.
           IF PIC-9-NOT-DECIMAL = 1.1
               CONTINUE.
           IF PIC-9-NOT-DECIMAL = 1.0
               CONTINUE.
           IF PIC-9-DECIMAL = 1.1
               CONTINUE.
           IF PIC-9-DECIMAL = 1.100
               CONTINUE.
           IF PIC-9-SIGNED NOT = 11.0
               CONTINUE.
           IF PIC-9-NOT-SIGNED < 0
               CONTINUE.
           IF PIC-9-NOT-SIGNED < ZERO
               CONTINUE.
           IF PIC-9-NOT-SIGNED < (25 - 50)
               CONTINUE.
           IF PIC-9-DECIMAL = (2.24 / 2)
               CONTINUE.
           IF PIC-9-NOT-DECIMAL = "123"
               CONTINUE.
           IF PIC-9-NOT-DECIMAL = "1B0"
               CONTINUE.
           IF PIC-9-NOT-DECIMAL (1:3) = "1B0"
               CONTINUE.
           IF PIC-9-NOT-DECIMAL (1:3) NOT = "Hot Doggy"
               CONTINUE.
           IF PIC-9-NOT-DECIMAL (1:XX) NOT = "Hi"
               CONTINUE.
           IF WS-LINE-NUMBER > '123'
              CONTINUE.
           IF WS-TEXT > 'DOGGY'
              CONTINUE.
           IF WS-NUMBER > 123.999
              CONTINUE.
           IF WS-LINE-NUMBER > 2345
              CONTINUE.
           IF WS-LINE-NUMBER <= 1234
              CONTINUE.
           IF WS-LINE-NUMBER > '1234'
              CONTINUE.
           IF 5432 < WS-LINE-NUMBER 
              CONTINUE.
           IF 7855 >= WS-LINE-NUMBER 
              CONTINUE.
           IF WS-TEXT > 'DOGGY++'
              CONTINUE.
           IF WS-TEXT > 3.141596
              CONTINUE.
           IF WS-TEXT = 3.141596
              CONTINUE.
           IF 'DOG+CAT' NOT = WS-TEXT
              CONTINUE.
           IF ( COMPUTE-1 < 654.20038) AND 
              ( COMPUTE-1 > 654.17422) THEN
              CONTINUE.
           IF ( COMPUTE-1 < 5654.20)
              CONTINUE.
           IF ( COMPUTE-1 > 5654.20)
              CONTINUE.
           IF ( 5654.20 > COMPUTE-1)
              CONTINUE.
           IF ( 5654.20 < COMPUTE-1)
              CONTINUE.
           IF IF-D16 POSITIVE
              CONTINUE.
           IF IF-D16 NOT POSITIVE
              CONTINUE.
           IF IF-D16 NEGATIVE
              CONTINUE.
           IF IF-D16 NOT NEGATIVE
              CONTINUE.
           IF PIC-9-NOT-SIGNED > (25 - 50)
               CONTINUE.
           IF PIC-9-NOT-SIGNED >= -1
               CONTINUE.
           IF PIC-9-NOT-SIGNED > 0.0
               CONTINUE.
           IF PIC-9-NOT-SIGNED > ZERO
               CONTINUE.
           IF PIC-9-NOT-SIGNED >= 0.0
               CONTINUE.
           IF PIC-9-NOT-SIGNED >= ZERO
               CONTINUE.
           STOP RUN RETURNING 0.
])

AT_CHECK([$COMPILE -std=cobol2002 prog.cob ], [0], [], [prog.cob: In paragraph 'MAIN':
prog.cob: 19: Warning: Literal '1234567' is longer than GROUP-ITEM-X6
prog.cob: 19: Warning: Expression is always FALSE
prog.cob: 21: Warning: Literal '1.1' has more decimals than PIC-9-NOT-DECIMAL
prog.cob: 21: Warning: Expression is always FALSE
prog.cob: 31: Warning: Unsigned 'PIC-9-NOT-SIGNED' may not be LESS THAN ZERO
prog.cob: 33: Warning: Unsigned 'PIC-9-NOT-SIGNED' may not be LESS THAN ZERO
prog.cob: 35: Warning: Unsigned 'PIC-9-NOT-SIGNED' may not be LESS THAN -25
prog.cob: 37: Warning: Literal '1.12' has more decimals than PIC-9-DECIMAL
prog.cob: 37: Warning: Expression is always FALSE
prog.cob: 41: Warning: Literal '1B0' is alphanumeric but PIC-9-NOT-DECIMAL is numeric
prog.cob: 53: Warning: Literal '123.999' has more decimals than WS-NUMBER
prog.cob: 55: Warning: Literal '2345' has more digits than WS-LINE-NUMBER
prog.cob: 55: Warning: Expression is always FALSE
prog.cob: 57: Warning: Literal '1234' has more digits than WS-LINE-NUMBER
prog.cob: 57: Warning: Expression is always TRUE
prog.cob: 59: Warning: Literal '1234' has more digits than WS-LINE-NUMBER
prog.cob: 59: Warning: Expression is always FALSE
prog.cob: 61: Warning: Literal '5432' has more digits than WS-LINE-NUMBER
prog.cob: 61: Warning: Expression is always FALSE
prog.cob: 63: Warning: Literal '7855' has more digits than WS-LINE-NUMBER
prog.cob: 63: Warning: Expression is always TRUE
prog.cob: 65: Warning: Literal 'DOGGY++' is longer than WS-TEXT
prog.cob: 67: Warning: Literal '3.141596' is longer than WS-TEXT
prog.cob: 69: Warning: Literal '3.141596' is longer than WS-TEXT
prog.cob: 69: Warning: Expression is always FALSE
prog.cob: 71: Warning: Literal 'DOG+CAT' is longer than WS-TEXT
prog.cob: 71: Warning: Expression is always TRUE
prog.cob: 73: Warning: Literal '654.20038' has more decimals than COMPUTE-1
prog.cob: 74: Warning: Literal '654.17422' has more decimals than COMPUTE-1
prog.cob: 76: Warning: Literal '5654.20' has more digits than COMPUTE-1
prog.cob: 76: Warning: Expression is always TRUE
prog.cob: 78: Warning: Literal '5654.20' has more digits than COMPUTE-1
prog.cob: 78: Warning: Expression is always FALSE
prog.cob: 80: Warning: Literal '5654.20' has more digits than COMPUTE-1
prog.cob: 80: Warning: Expression is always TRUE
prog.cob: 82: Warning: Literal '5654.20' has more digits than COMPUTE-1
prog.cob: 82: Warning: Expression is always FALSE
prog.cob: 88: Warning: Unsigned 'IF-D16' may not be LESS THAN ZERO
prog.cob: 90: Warning: Unsigned 'IF-D16' may not be LESS THAN ZERO
prog.cob: 92: Warning: Unsigned 'PIC-9-NOT-SIGNED' may always be GREATER THAN -25
prog.cob: 94: Warning: Unsigned 'PIC-9-NOT-SIGNED' may always be GREATER OR EQUAL -1
prog.cob: 100: Warning: Unsigned 'PIC-9-NOT-SIGNED' may always be GREATER OR EQUAL ZERO
prog.cob: 102: Warning: Unsigned 'PIC-9-NOT-SIGNED' may always be GREATER OR EQUAL ZERO
])

AT_CHECK([./prog], [0], [], [])

AT_CLEANUP


AT_SETUP([Invalid expression])
AT_KEYWORDS([misc])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01  CON          CONSTANT 10.
       01  V            PIC 9.
       78  C78          VALUE 'A'.
       PROCEDURE        DIVISION.
           IF FUNCTION TRIM (' ')
              CONTINUE
              CONTINUE
           END-IF.
           IF CON
              CONTINUE
              CONTINUE
           END-IF.
           IF V
              CONTINUE
              CONTINUE
           END-IF.
           IF C78
              CONTINUE
              CONTINUE
           END-IF.
           IF '2'
              CONTINUE
              CONTINUE
           END-IF.
           EVALUATE TRUE
              WHEN FUNCTION TRIM (' ')
                 CONTINUE
                 CONTINUE
              WHEN CON
                 CONTINUE
                 CONTINUE
              WHEN V
                 CONTINUE
                 CONTINUE
              WHEN C78
                 CONTINUE
                 CONTINUE
              WHEN '2'
                 CONTINUE
              WHEN OTHER
                 CONTINUE
           END-EVALUATE.
           PERFORM VARYING V
                   FROM 1 BY 1
                   UNTIL FUNCTION TRIM (' ')
              CONTINUE
              CONTINUE
           END-PERFORM.
           PERFORM VARYING V
                   FROM 1 BY 1
                   UNTIL V
              CONTINUE
              CONTINUE
           END-PERFORM.
           PERFORM VARYING V
                   FROM 1 BY 1
                   UNTIL C78
              CONTINUE
              CONTINUE
           END-PERFORM.
           PERFORM VARYING V
                   FROM 1 BY 1
                   UNTIL '2'
              CONTINUE
              CONTINUE
           END-PERFORM.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 10: Error: Invalid expression
prog.cob: 14: Error: Invalid expression
prog.cob: 18: Error: Invalid expression
prog.cob: 22: Error: Invalid expression
prog.cob: 26: Error: Invalid expression
prog.cob: 31: Error: Invalid expression
prog.cob: 34: Error: Invalid expression
prog.cob: 37: Error: Invalid expression
prog.cob: 40: Error: Invalid expression
prog.cob: 43: Error: Invalid expression
prog.cob: 50: Error: Invalid expression
prog.cob: 56: Error: Invalid expression
prog.cob: 62: Error: Invalid expression
prog.cob: 68: Error: Invalid expression
])

AT_CLEANUP


AT_SETUP([Missing headers])
AT_KEYWORDS([misc])

AT_DATA([prog.cob], [
       SOURCE-COMPUTER. GNU-LINUX.
       SPECIAL-NAMES.
            SYMBOLIC NL IS 101
                     NL2   102
            NUMERIC SIGN TRAILING SEPARATE
            DECIMAL-POINT IS COMMA
            .

            SELECT PRINT-FILE ASSIGN "EXTRXW"
            ORGANIZATION LINE SEQUENTIAL
            .
       DATA DIVISION.
       FD  PRINT-FILE EXTERNAL.
       01  PRINT-REC          PIC X(64).

           DISPLAY "X"
           END-DISPLAY
           ACCEPT OMITTED
           END-ACCEPT
           GOBACK
           .
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 2: Error: PROGRAM-ID header missing
prog.cob: 2: Error: ENVIRONMENT DIVISION header missing
prog.cob: 2: Error: CONFIGURATION SECTION header missing
prog.cob: 10: Error: INPUT-OUTPUT SECTION header missing
prog.cob: 10: Error: FILE-CONTROL header missing
prog.cob: 14: Error: FILE SECTION header missing
prog.cob: 17: Error: PROCEDURE DIVISION header missing
])

AT_CLEANUP

AT_SETUP([INITIALIZE constant])
AT_KEYWORDS([misc])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01  CON          CONSTANT 10.
       01  V            PIC 9.
       78  C78          VALUE 'A'.
       PROCEDURE DIVISION.
           INITIALIZE CON.
           INITIALIZE V.
           INITIALIZE V, 9.
           INITIALIZE C78, V.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 10: Error: Invalid INITIALIZE statement
prog.cob: 12: Error: Invalid INITIALIZE statement
prog.cob: 13: Error: Invalid INITIALIZE statement
])

AT_CLEANUP


AT_SETUP([CLASS duplicate values])
AT_KEYWORDS([misc])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT      DIVISION.
       CONFIGURATION    SECTION.
       SPECIAL-NAMES.
            SYMBOLIC NL IS 101
                     NL2   102
            CLASS    CHECK-VALID    'a' THRU 'z'
                                    'A' THRU 'Z'
                                    'cdef'
            NUMERIC SIGN TRAILING SEPARATE
            DECIMAL-POINT IS COMMA
            .
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 X             PIC X(8).
       PROCEDURE        DIVISION.
           IF X         IS CHECK-VALID
              DISPLAY "OK"
              END-DISPLAY
           END-IF.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 9: Error: Duplicate values in class 'CHECK-VALID'
])

AT_CLEANUP


AT_SETUP([INSPECT invalid size])
AT_KEYWORDS([misc])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 X             PIC X(8).
       PROCEDURE        DIVISION.
           INSPECT X REPLACING ALL SPACES BY "AA".
           INSPECT X REPLACING ALL "ABC"  BY "AA".
           INSPECT X REPLACING ALL "DEF"  BY SPACES.
           INSPECT X CONVERTING SPACES TO "AA".
           INSPECT X CONVERTING "ABC"  TO "AA".
           INSPECT X CONVERTING "DEF"  TO SPACES.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 8: Error: REPLACING operands differ in size
prog.cob: 9: Error: REPLACING operands differ in size
prog.cob: 11: Error: CONVERTING operands differ in size
prog.cob: 12: Error: CONVERTING operands differ in size
])

AT_CLEANUP


AT_SETUP([INSPECT invalid target])
AT_KEYWORDS([misc])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 X             PIC X(8).
       PROCEDURE        DIVISION.
           INSPECT FUNCTION TRIM(X) REPLACING ALL "ABC" BY "DEF".
           INSPECT FUNCTION TRIM(X) CONVERTING "ABC" TO "AAA".
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 8: Error: Invalid target for REPLACING
prog.cob: 9: Error: Invalid target for CONVERTING
])

AT_CLEANUP


AT_SETUP([INSPECT missing keyword])
AT_KEYWORDS([misc])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 X             PIC X(8).
       PROCEDURE        DIVISION.
           INSPECT X REPLACING "AB" BY "CD".
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 8: Error: INSPECT missing a keyword
])

AT_CLEANUP


AT_SETUP([Maximum data size])
AT_KEYWORDS([misc])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 SINGLE-ITEM   PIC X(999999999).
       01 GROUP-ITEM1.
          05 FILLER     PIC X(999999999).
       01 GROUP-ITEM2.
          05 FILLER     PIC X(199999999).
          05 FILLER     PIC X(199999999).
       PROCEDURE        DIVISION.
           STOP RUN.

])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 6: Error: 'SINGLE-ITEM' cannot be larger than 268435456 bytes
prog.cob: 8: Error: 'FILLER 1' cannot be larger than 268435456 bytes
prog.cob: 7: Error: 'GROUP-ITEM1' cannot be larger than 268435456 bytes
prog.cob: 9: Error: 'GROUP-ITEM2' cannot be larger than 268435456 bytes
])

AT_CLEANUP


AT_SETUP([Unreachable statement])
AT_KEYWORDS([misc extensions])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT f ASSIGN TO 'f' LINE SEQUENTIAL.
       DATA DIVISION.
       FILE SECTION.
       FD  f.
       01  f-rec PIC X.
       WORKING-STORAGE  SECTION.
       PROCEDURE        DIVISION.
       DECLARATIVES.
       f-error SECTION.
           USE AFTER ERROR ON f.
           GOBACK
           .
       END DECLARATIVES.

           DISPLAY "VALID"
           END-DISPLAY.

       P01.
           GO TO P02.
           DISPLAY "INVALID"
           END-DISPLAY.
       P02.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -Wunreachable prog.cob], [0], [],
[prog.cob: In paragraph 'P01':
prog.cob: 26: Warning: Unreachable statement 'DISPLAY'
])

AT_CLEANUP


AT_SETUP([CRT STATUS])
AT_KEYWORDS([SPECIAL-NAMES misc])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SPECIAL-NAMES.
           CRT STATUS IS MY-CRT-STATUS.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 X             PIC X.
       PROCEDURE        DIVISION.
           ACCEPT X END-ACCEPT.
           STOP RUN.
])

AT_DATA([prog2.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog2.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SPECIAL-NAMES.
           CRT STATUS IS MY-CRT-STATUS.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 X             PIC X.
       77 MY-CRT-STATUS PIC 9(04).
       PROCEDURE        DIVISION.
           ACCEPT X END-ACCEPT.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 7: Error: 'MY-CRT-STATUS' is not defined
])
AT_CHECK([$COMPILE_ONLY prog2.cob], [0], [], [])

AT_CLEANUP


AT_SETUP([SWITCHES])
AT_KEYWORDS([runmisc extensions])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SPECIAL-NAMES.
           SW1
             ON  IS SWIT1-ON
             OFF IS SWIT1-OFF
           .
           SWITCH B IS SWITCH-B
             ON  IS SWIT2-ON
             OFF IS SWIT2-OFF
           .
           SWITCH-25
             ON  IS SWIT25-ON
             OFF IS SWIT25-OFF
           .
           SWITCH-25
             ON  IS SWIT25-IS-ON
             OFF IS SWIT25-IS-OFF
           .
           SWITCH 25
             ON  IS SWIT25-SP-ON
             OFF IS SWIT25-SP-OFF
           .
           SWITCH Y
             ON  IS SWIT25-Y-ON
             OFF IS SWIT25-Y-OFF
           .
           SWITCH Z
             ON  IS SWIT26-ON
             ON  IS SWIT26-OFF
           .
           SWITCH-32
             ON  IS SWIT32-ON
           .
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01  SWITCH       PIC 99 VALUE 12.
       PROCEDURE        DIVISION.
           ADD SWITCH 1 GIVING SWITCH
           END-ADD.
           IF SWITCH NOT = 13
              DISPLAY "SWITCH (variable) WRONG: "
                      SWITCH
              END-DISPLAY
           END-IF.
           IF SWIT1-ON
              DISPLAY "ON" NO ADVANCING
              END-DISPLAY
           ELSE
              DISPLAY "OFF" NO ADVANCING
              END-DISPLAY
           END-IF.
           IF SWIT2-ON
              DISPLAY " ON" NO ADVANCING
              END-DISPLAY
           ELSE
              DISPLAY " OFF" NO ADVANCING
              END-DISPLAY
           END-IF.
           SET SWITCH-B TO OFF
           IF SWIT2-ON
              CONTINUE
           END-IF.
           IF SWIT25-ON
              CONTINUE
           END-IF.
           IF SWIT26-ON
              CONTINUE
           END-IF.
           IF SWIT32-ON
              CONTINUE
           END-IF.
           IF SWIT32-OFF
              CONTINUE
           END-IF.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 7: Error: Invalid system-name 'SW1'
prog.cob: 8: Error: ON/OFF usage requires a SWITCH name
prog.cob: 9: Error: ON/OFF usage requires a SWITCH name
prog.cob: 11: Error: Invalid system-name 'SWITCH B'
prog.cob: 12: Error: ON/OFF usage requires a SWITCH name
prog.cob: 13: Error: ON/OFF usage requires a SWITCH name
prog.cob: 23: Error: Invalid system-name 'SWITCH 25'
prog.cob: 24: Error: ON/OFF usage requires a SWITCH name
prog.cob: 25: Error: ON/OFF usage requires a SWITCH name
prog.cob: 27: Error: Invalid system-name 'SWITCH Y'
prog.cob: 28: Error: ON/OFF usage requires a SWITCH name
prog.cob: 29: Error: ON/OFF usage requires a SWITCH name
prog.cob: 31: Error: Invalid system-name 'SWITCH Z'
prog.cob: 32: Error: ON/OFF usage requires a SWITCH name
prog.cob: 33: Error: ON/OFF usage requires a SWITCH name
prog.cob: 49: Error: 'SWIT1-ON' is not defined
prog.cob: 56: Error: 'SWIT2-ON' is not defined
prog.cob: 63: Error: 'SWITCH-B' is not defined
prog.cob: 63: Error: syntax error, unexpected OFF
prog.cob: 64: Error: syntax error, unexpected Identifier
prog.cob: 66: Error: syntax error, unexpected END-IF
prog.cob: 70: Error: 'SWIT26-ON' is not defined
prog.cob: 76: Error: 'SWIT32-OFF' is not defined
])
# There should be an additional
#prog.cob: 19: Error: duplicate definition of 'SWITCH-25'
#prog.cob: 15: Error: 'SWITCH-25' previously defined here
#
AT_CHECK([$COMPILE_ONLY -fsyntax-extension prog.cob], [1], [], 
[prog.cob: 33: Error: Duplicate ON clause
prog.cob: 76: Error: 'SWIT32-OFF' is not defined
])
# There should be an additional
#prog.cob: 19: Error: duplicate definition of 'SWITCH-25'
#prog.cob: 15: Error: 'SWITCH-25' previously defined here
#prog.cob: 23: Error: duplicate definition of 'SWITCH 25'
#prog.cob: 15: Error: 'SWITCH-25' previously defined here
#prog.cob: 27: Error: duplicate definition of 'SWITCH Y'
#prog.cob: 15: Error: 'SWITCH-25' previously defined here

AT_CLEANUP


AT_SETUP([ACCEPT WITH ( NO ) UPDATE / DEFAULT])
AT_KEYWORDS([misc extensions])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 X             PIC X.
       PROCEDURE        DIVISION.
           ACCEPT X                 END-ACCEPT.
           ACCEPT X WITH    UPDATE  END-ACCEPT.
           ACCEPT X WITH    DEFAULT END-ACCEPT.
           ACCEPT X WITH NO UPDATE  END-ACCEPT.
           ACCEPT X WITH NO DEFAULT END-ACCEPT.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -cb_conf=accept-update:yes prog.cob], [0], [], [])

AT_CLEANUP


AT_SETUP([ACCEPT WITH AUTO / TAB])
AT_KEYWORDS([AUTO-SKIP AUTOTERMINATE misc extensions])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 X             PIC X.
       PROCEDURE        DIVISION.
           ACCEPT X                       END-ACCEPT.
           ACCEPT X WITH    AUTO          END-ACCEPT.
           ACCEPT X WITH    AUTO-SKIP     END-ACCEPT.
           ACCEPT X WITH    AUTOTERMINATE END-ACCEPT.
           ACCEPT X WITH    TAB           END-ACCEPT.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -cb_conf=accept-auto:yes prog.cob], [0], [], [])

AT_CLEANUP


AT_SETUP([Source text after column 72 in Fixed-form])
AT_KEYWORDS([misc fixed])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       PROCEDURE        DIVISION.                                       COMMENT
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -W prog.cob], [0], [],
[prog.cob: 8: Warning: Source text after column 72
])

AT_CLEANUP


AT_SETUP([Line overflow in Fixed-form / Free-form])
AT_KEYWORDS([misc])

# We're testing trailing tabs and whitespace (should not lead to warning)
# along with comments after boundaries (col 72 / col 512)

# AT_DATA removes trailing spaces, workaround: add "_" and
# remove it later via sed

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.                                           																																																																																																																																		_
       DATA             DIVISION.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  _
       WORKING-STORAGE  SECTION.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   *> This is a real comment
       PROCEDURE        DIVISION.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  This is commentary only
           CONTINUE.                                              *> comment after column 72
      *    This is a very long comment that exceeds column 72 but doesn't exceed 512 bytes, therefore not leading to a line overflow. As it is a comment line there is no "Source text after column 72" warning
           CONTINUE.                                                    CONTINUE.
           CONTINUE.                                                                        _
           STOP RUN.
])

# AT_DATA workaround via sed:
AT_CHECK([sed -e 's/_$//' prog.cob > prog.sed && mv prog.sed prog.cob], [0], [], [])

AT_CHECK([$COMPILE_ONLY -fixed -W prog.cob], [0], [],
[prog.cob: 7: Warning: Source text exceeds 512 bytes, will be truncated
prog.cob: 8: Warning: Source text exceeds 512 bytes, will be truncated
prog.cob: 11: Warning: Source text after column 72
])

AT_CHECK([$COMPILE_ONLY -free -W prog.cob], [1], [],
[prog.cob: 7: Warning: Source text exceeds 512 bytes, will be truncated
prog.cob: 8: Warning: Source text exceeds 512 bytes, will be truncated
prog.cob: 8: Error: Unknown statement 'This'
])

AT_CLEANUP


AT_SETUP([Continuation Indicator - too many lines])
AT_KEYWORDS([misc fixed literals])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       PROCEDURE        DIVISION.
           DISPLAY '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    ' ' END-DISPLAY.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 538: Error: Buffer overrun - Too much continuation lines
])

AT_CLEANUP


AT_SETUP([Literal too long])
AT_KEYWORDS([misc literals literal-length continuation])

# Currently not checked, see Feature Request #43
AT_SKIP_IF(true)

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       PROCEDURE        DIVISION.
           DISPLAY '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    ' ' END-DISPLAY.
           STOP RUN.
])

AT_DATA([prog2.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog2.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       PROCEDURE        DIVISION.
           DISPLAY '    '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           ' ' END-DISPLAY.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -std=default -fixed prog.cob], [1], [],
[prog.cob: 148: Error: Literal too long, exceeds 8191 alphanumeric character positions.
])

AT_CHECK([$COMPILE_ONLY -std=default -free prog2.cob], [1], [],
[prog.cob: 45: Error: Literal too long, exceeds 8191 alphanumeric character positions.
])

AT_CLEANUP





AT_SETUP([Line and floating comments])
AT_KEYWORDS([misc extensions])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       PROCEDURE        DIVISION.
      *    DISPLAY 'COMMENT'             END-DISPLAY
      /    DISPLAY 'COMMENTSLASH'        END-DISPLAY
*          DISPLAY 'MFCOMMENTASTERISK'   END-DISPLAY
/          DISPLAY 'MFCOMMENTSLASH'      END-DISPLAY
 *         DISPLAY 'NOMFCOMMENTASTERISK' END-DISPLAY
 /         DISPLAY 'NOMFCOMMENTSLASH'    END-DISPLAY
        *> DISPLAY 'FLOATING'            END-DISPLAY
 *>        DISPLAY 'NOFLOATING'          END-DISPLAY
           STOP RUN.
])

AT_DATA([prog2.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog2.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       PROCEDURE        DIVISION.
      *    DISPLAY 'COMMENT'             END-DISPLAY
      /    DISPLAY 'COMMENTSLASH'        END-DISPLAY
      $    DISPLAY 'COMMENTDOLLAR'       END-DISPLAY
*          DISPLAY 'MFCOMMENTASTERISK'   END-DISPLAY
/          DISPLAY 'MFCOMMENTSLASH'      END-DISPLAY
 *         DISPLAY 'NOMFCOMMENTASTERISK' END-DISPLAY
 /         DISPLAY 'NOMFCOMMENTSLASH'    END-DISPLAY
        *> DISPLAY 'FLOATING'            END-DISPLAY
        |  DISPLAY 'ACUFLOATING'         END-DISPLAY
 |         DISPLAY 'NOACUFLOATING'       END-DISPLAY
 *>        DISPLAY 'NOFLOATING'          END-DISPLAY
           STOP RUN.
])

AT_DATA([prog3.cob], [
IDENTIFICATION   DIVISION.
PROGRAM-ID.      prog3.
ENVIRONMENT DIVISION.
CONFIGURATION SECTION.
DATA             DIVISION.
WORKING-STORAGE  SECTION.
PROCEDURE        DIVISION.
      * DISPLAY 'NOCOMMENT'           END-DISPLAY
      / DISPLAY 'NOCOMMENTSLASH'      END-DISPLAY
      $ DISPLAY 'NOCOMMENTDOLLAR'     END-DISPLAY
*       DISPLAY 'NOMFCOMMENTASTERISK' END-DISPLAY
/       DISPLAY 'NOMFCOMMENTSLASH'    END-DISPLAY
 |      DISPLAY 'ACUFLOATING'         END-DISPLAY
 *>     DISPLAY 'FLOATING'            END-DISPLAY
        STOP RUN.
])

AT_CHECK([$COMPILE prog.cob], [0], [], [])

AT_CHECK([./prog], [0],
[MFCOMMENTASTERISK
MFCOMMENTSLASH
NOMFCOMMENTASTERISK
NOMFCOMMENTSLASH
NOFLOATING
], [])

AT_CHECK([$COMPILE_ONLY prog2.cob], [1], [],
[prog2.cob: 11: Error: Invalid indicator '$' at column 7
])


AT_CHECK([$COMPILE -fmfcomment prog.cob], [0], [],
[])

AT_CHECK([./prog], [0],
[NOMFCOMMENTASTERISK
NOMFCOMMENTSLASH
NOFLOATING
], [])

AT_CHECK([$COMPILE_ONLY -fmfcomment prog2.cob], [1], [],
[prog2.cob: 11: Error: Invalid indicator '$' at column 7
])


AT_CHECK([$COMPILE -facucomment prog.cob], [0], [], [])

AT_CHECK([./prog], [0],
[MFCOMMENTASTERISK
MFCOMMENTSLASH
NOMFCOMMENTASTERISK
NOMFCOMMENTSLASH
NOFLOATING
], [])

AT_CHECK([$COMPILE -facucomment prog2.cob], [0], [], [])

AT_CHECK([./prog2], [0],
[MFCOMMENTASTERISK
MFCOMMENTSLASH
NOMFCOMMENTASTERISK
NOMFCOMMENTSLASH
NOACUFLOATING
NOFLOATING
], [])


AT_CHECK([$COMPILE_ONLY -free prog3.cob], [1], [],
[prog3.cob: 11: Warning: Spurious '$' detected - ignoring
prog3.cob: 9: Error: syntax error, unexpected *
prog3.cob: 9: Error: syntax error, unexpected Literal
prog3.cob: 10: Error: syntax error, unexpected /
prog3.cob: 10: Error: syntax error, unexpected Literal
prog3.cob: 12: Error: syntax error, unexpected *
prog3.cob: 12: Error: syntax error, unexpected Literal
prog3.cob: 13: Error: syntax error, unexpected /
prog3.cob: 13: Error: syntax error, unexpected Literal
prog3.cob: 14: Error: Invalid symbol: | - Skipping word
])
AT_CHECK([$COMPILE_ONLY -free -fmfcomment prog3.cob], [1], [],
[prog3.cob: 11: Warning: Spurious '$' detected - ignoring
prog3.cob: 9: Error: syntax error, unexpected *
prog3.cob: 9: Error: syntax error, unexpected Literal
prog3.cob: 10: Error: syntax error, unexpected /
prog3.cob: 10: Error: syntax error, unexpected Literal
prog3.cob: 12: Error: syntax error, unexpected *
prog3.cob: 12: Error: syntax error, unexpected Literal
prog3.cob: 13: Error: syntax error, unexpected /
prog3.cob: 13: Error: syntax error, unexpected Literal
prog3.cob: 14: Error: Invalid symbol: | - Skipping word
])
AT_CHECK([$COMPILE_ONLY -free -facucomment prog3.cob], [1], [],
[prog3.cob: 11: Warning: Spurious '$' detected - ignoring
prog3.cob: 9: Error: syntax error, unexpected *
prog3.cob: 9: Error: syntax error, unexpected Literal
prog3.cob: 10: Error: syntax error, unexpected /
prog3.cob: 10: Error: syntax error, unexpected Literal
prog3.cob: 12: Error: syntax error, unexpected *
prog3.cob: 12: Error: syntax error, unexpected Literal
prog3.cob: 13: Error: syntax error, unexpected /
prog3.cob: 13: Error: syntax error, unexpected Literal
])

AT_CLEANUP

AT_SETUP([Continuation of COBOL words])
AT_KEYWORDS([misc fixed])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       PROCEDURE        DIVISION.
           GO
      -    BACK.
])

AT_CHECK([$COMPILE_ONLY -std=cobol2014 prog.cob], [0], [],
[prog.cob: 5: Warning: Continuation of COBOL words is archaic in COBOL 2014
])
AT_CHECK([$COMPILE_ONLY prog.cob], [0], [],
[prog.cob: 5: Warning: Continuation of COBOL words used
])


AT_CLEANUP

AT_SETUP([word length])
AT_KEYWORDS([misc word-length])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01  FILLER        PIC 9(01) VALUE 0.
           88 SOME-SPECIAL-VAL-WITH-LENGTH30    VALUE 0.
           88 SOME-SPECIAL-VAL-WITH-LENGTH-31   VALUE 1.
           88 SOME-SPECIAL-VAL-WITH-LENGTH-32C  VALUE 1.
           88 SOME-SPECIAL-VAL-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES      VALUE 3.
           88 SOME-SPECIAL-VAL-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE VALUE 4.
       PROCEDURE        DIVISION.
       SOME-SPECIAL-PAR-WITH-LENGTH30.
           SET  SOME-SPECIAL-VAL-WITH-LENGTH30   TO TRUE.
       SOME-SPECIAL-PAR-WITH-LENGTH-31.
           SET  SOME-SPECIAL-VAL-WITH-LENGTH-31  TO TRUE.
       SOME-SPECIAL-PAR-WITH-LENGTH-32C.
           SET  SOME-SPECIAL-VAL-WITH-LENGTH-32C TO TRUE.
       SOME-SPECIAL-PAR-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES.
           SET  SOME-SPECIAL-VAL-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES TO TRUE.
       SOME-SPECIAL-PAR-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE.
           SET  SOME-SPECIAL-VAL-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE TO TRUE.
           STOP RUN.
])

AT_DATA([prog2.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog2.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01  FILLER        PIC 9(01) VALUE 0.
           88 SOME-SPECIAL-VAL-WITH-LENGTH30    VALUE 0.
           88 SOME-SPECIAL-VAL-WITH-LENGTH-31   VALUE 1.
           88 SOME-SPECIAL-VAL-WITH-LENGTH-32C  VALUE 1.
           88 SOME-SPECIAL-VAL-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES      VALUE 3.
       PROCEDURE        DIVISION.
       SOME-SPECIAL-PAR-WITH-LENGTH30.
           SET  SOME-SPECIAL-VAL-WITH-LENGTH30   TO TRUE.
       SOME-SPECIAL-PAR-WITH-LENGTH-31.
           SET  SOME-SPECIAL-VAL-WITH-LENGTH-31  TO TRUE.
       SOME-SPECIAL-PAR-WITH-LENGTH-32C.
           SET  SOME-SPECIAL-VAL-WITH-LENGTH-32C TO TRUE.
       SOME-SPECIAL-PAR-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES.
           SET  SOME-SPECIAL-VAL-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES TO TRUE.
           STOP RUN.
])

AT_CHECK([$COBC -fsyntax-only -free -W prog.cob], [1], [],
[prog.cob: 11: Error: Word length exceeds 31 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-32C'
prog.cob: 12: Error: Word length exceeds 31 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES'
prog.cob: 13: Error: Word length exceeds maximum of 61 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE'
prog.cob: In paragraph 'SOME-SPECIAL-PAR-WITH-LENGTH-31':
prog.cob: 19: Error: Word length exceeds 31 characters - 'SOME-SPECIAL-PAR-WITH-LENGTH-32C'
prog.cob: In paragraph 'SOME-SPECIAL-PAR-WITH-LENGTH-32C':
prog.cob: 20: Error: Word length exceeds 31 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-32C'
prog.cob: 21: Error: Word length exceeds 31 characters - 'SOME-SPECIAL-PAR-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES'
prog.cob: In paragraph 'SOME-SPECIAL-PAR-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES':
prog.cob: 22: Error: Word length exceeds 31 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES'
prog.cob: 23: Error: Word length exceeds maximum of 61 characters - 'SOME-SPECIAL-PAR-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE'
prog.cob: In paragraph 'SOME-SPECIAL-PAR-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE':
prog.cob: 24: Error: Word length exceeds maximum of 61 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE'
])

AT_CHECK([$COBC -fsyntax-only -free -W -cb_conf=word-length:45 prog.cob], [1], [],
[prog.cob: 12: Error: Word length exceeds 45 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES'
prog.cob: 13: Error: Word length exceeds maximum of 61 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE'
prog.cob: In paragraph 'SOME-SPECIAL-PAR-WITH-LENGTH-32C':
prog.cob: 21: Error: Word length exceeds 45 characters - 'SOME-SPECIAL-PAR-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES'
prog.cob: In paragraph 'SOME-SPECIAL-PAR-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES':
prog.cob: 22: Error: Word length exceeds 45 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES'
prog.cob: 23: Error: Word length exceeds maximum of 61 characters - 'SOME-SPECIAL-PAR-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE'
prog.cob: In paragraph 'SOME-SPECIAL-PAR-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE':
prog.cob: 24: Error: Word length exceeds maximum of 61 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE'
])

AT_CHECK([$COBC -fsyntax-only -free -W -cb_conf=word-length:60 prog.cob], [1], [],
[prog.cob: 13: Error: Word length exceeds maximum of 61 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE'
prog.cob: In paragraph 'SOME-SPECIAL-PAR-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES':
prog.cob: 23: Error: Word length exceeds maximum of 61 characters - 'SOME-SPECIAL-PAR-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE'
prog.cob: In paragraph 'SOME-SPECIAL-PAR-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE':
prog.cob: 24: Error: Word length exceeds maximum of 61 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE'
])

AT_CHECK([$COBC -fsyntax-only -free -W -cb_conf=word-length:45 -frelax-syntax prog2.cob], [0], [],
[prog2.cob: 12: Warning: Word length exceeds 45 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES'
prog2.cob: In paragraph 'SOME-SPECIAL-PAR-WITH-LENGTH-32C':
prog2.cob: 20: Warning: Word length exceeds 45 characters - 'SOME-SPECIAL-PAR-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES'
prog2.cob: In paragraph 'SOME-SPECIAL-PAR-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES':
prog2.cob: 21: Warning: Word length exceeds 45 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES'
])

AT_CHECK([$COMPILE_ONLY -free -W -cb_conf=word-length:60 -frelax-syntax prog2.cob], [0], [], [])

AT_CHECK([$COBC -fsyntax-only -free -frelax-syntax prog2.cob], [0], [], [])

AT_CLEANUP


AT_SETUP([REDEFINES with VALUE])
AT_KEYWORDS([Numeric])

AT_DATA([prog.cob], [
       IDENTIFICATION DIVISION.
       PROGRAM-ID. prog.
       DATA  DIVISION.
       WORKING-STORAGE SECTION.
       01  NUM9    PIC 9(6).
       01  NUM9C   PIC 9(6).
       01  TSRDF.
           05  WS-ASK-ID-DATE                PIC X(10).
           05  WS-ASK-ID-DATE-R              REDEFINES WS-ASK-ID-DATE.
               10  WS-ASK-ID-DATE-YYYY       PIC 9(4).
               10  FILLER                    PIC X VALUE '-'.
               10  WS-ASK-ID-DATE-MM         PIC 9(2).
               10  FILLER                    PIC X VALUE '-'.
               10  WS-ASK-ID-DATE-DD         PIC 9(2).
       PROCEDURE DIVISION.
           MOVE SPACES TO NUM9
           DISPLAY "NUM9 value SPACES is " NUM9.
           MOVE LOW-VALUES TO NUM9
           DISPLAY "NUM9 value LOW-VALUES is " NUM9.
           IF NUM9 = LOW-VALUES
               DISPLAY "9(6) tests OK for LOW-VALUES"
           ELSE
               DISPLAY "9(6) Does NOT test OK for LOW-VALUES"
               IF NUM9 = ZERO  
                   DISPLAY "9(6) tests as ZERO instead of LOW-VALUES"
               END-IF
           END-IF.
           MOVE HIGH-VALUES TO NUM9
           DISPLAY "NUM9 value HIGH-VALUES is " NUM9.
           IF NUM9 = HIGH-VALUES
               DISPLAY "9(6) tests OK for HIGH-VALUES"
           ELSE
               DISPLAY "9(6) Does NOT test OK for HIGH-VALUES"
               IF NUM9 = ZERO  
                   DISPLAY "9(6) tests as ZERO instead of HIGH-VALUES"
               END-IF
           END-IF.
           IF NUM9 (1:6) = LOW-VALUES
               DISPLAY "9(6)(1:6) tests OK for LOW-VALUES"
           ELSE
               DISPLAY "9(6)(1:6) Does NOT test OK for LOW-VALUES"
           END-IF.
           MOVE ZERO TO NUM9
           IF NUM9 = ZERO  
               DISPLAY "9(6) tests OK for ZERO"
           ELSE
               DISPLAY "9(6) Does NOT test OK for ZERO"
           END-IF.
           MOVE 2015 TO WS-ASK-ID-DATE-YYYY
           MOVE 08 TO WS-ASK-ID-DATE-MM
           MOVE 21 TO WS-ASK-ID-DATE-DD
           DISPLAY "The date is " WS-ASK-ID-DATE.
           STOP RUN.
])

AT_CHECK([$COMPILE prog.cob], [1], [], [prog.cob: 12: Warning: Initial VALUE clause ignored for REDEFINES item
prog.cob: 14: Warning: Initial VALUE clause ignored for REDEFINES item
prog.cob: 17: Error: MOVE of figurative constant to numeric item used
prog.cob: 19: Error: MOVE of figurative constant to numeric item used
prog.cob: 29: Error: MOVE of figurative constant to numeric item used
])

AT_CLEANUP


AT_SETUP([level 78 NEXT / START OF])
AT_KEYWORDS([extensions constant])

AT_DATA([prog.cob], [
       IDENTIFICATION DIVISION.
       PROGRAM-ID. prog.
       DATA DIVISION.
       WORKING-STORAGE SECTION.
       78  POS0      VALUE NEXT.
       01  MYREC.
          05  FLD1   PIC 9(2).
          05  FLD2   PIC X(7).
             78  POS3    VALUE NEXT.
          05  FLD3   PIC X(2) OCCURS 5 TIMES.
             78  POS4    VALUE NEXT.
          05  FLD4   PIC X(4).
             78  POS-NEXT   VALUE NEXT.
       77  MYREC2 PIC X.
       01  MYREC3 EXTERNAL.
          05  FLD5   PIC X(4).
             78  POS5    VALUE NEXT.
          05  FLD6   PIC X(4).
       01  PICX      PIC XXX VALUE 'Abc'.
       78  HUN       VALUE 10 * (10 + LENGTH OF PICX) + 12.35-2+3.
       78  HUN2      VALUE HUN * (10 + LENGTH OF PICX) -4.
       78  DIV1      VALUE 100 / 3.
       78  STRT4     VALUE START OF FLD4.
       LINKAGE SECTION.
       01  XMYREC.
          05  XFLD1   PIC 9(2).
          05  XFLD2   PIC X(7).
             78  XPOS3    VALUE NEXT.
          05  XFLD3   PIC X(2) OCCURS 5 TIMES.
             78  XPOS4    VALUE NEXT.
          05  XFLD4   PIC X(4).
          05  XFLD5   PIC X(4).
       78  XSTRT4     VALUE START OF XFLD4.
      *
       PROCEDURE DIVISION.
           STOP RUN.
])

AT_CHECK([$COMPILE prog.cob], [1], [],
[prog.cob: 6: Error: VALUE of 'POS0': NEXT target is invalid
prog.cob: 6: Error: no previous data-item found
prog.cob: 10: Error: VALUE of 'POS3': NEXT target is invalid
prog.cob: 10: Error: target must be in FILE SECTION or LINKAGE SECTION or have the EXTERNAL clause
prog.cob: 12: Error: VALUE of 'POS4': NEXT target is invalid
prog.cob: 12: Error: target must be in FILE SECTION or LINKAGE SECTION or have the EXTERNAL clause
prog.cob: 14: Error: VALUE of 'POS-NEXT': NEXT target is invalid
prog.cob: 14: Error: target must be in FILE SECTION or LINKAGE SECTION or have the EXTERNAL clause
prog.cob: 24: Error: VALUE of 'STRT4': START OF target 'FLD4' is invalid
prog.cob: 24: Error: target must be in FILE SECTION or LINKAGE SECTION or have the EXTERNAL clause
])

AT_CLEANUP

AT_SETUP([01 CONSTANT])
AT_KEYWORDS([CONSTANT])

AT_DATA([prog.cob], [
       IDENTIFICATION DIVISION.
       PROGRAM-ID. prog.
       DATA DIVISION.
       WORKING-STORAGE SECTION.
       01  NUM2      CONSTANT 3.
       01  CON3      CONSTANT ((1 + 2) * NUM2 - 4.
       01  CON4      CONSTANT (1 + 2) * NUM2 - 4).
       01  CON5      CONSTANT (1 + 2) // NUM2.
       01  CON6      CONSTANT (1 + 2 + 3 + (4)) / (NUM2).
       78  CON7      VALUE    (1 + 2 + 3)* (4).
      *
       PROCEDURE DIVISION.
       MAIN.
           STOP RUN.
])

AT_CHECK([cobc -x -std=cobol2002 -w prog.cob ], [1], [],
[prog.cob: 7: Error: missing right parenthesis
prog.cob: 8: Error: missing left parenthesis
prog.cob: 9: Error: '/' operator misplaced
prog.cob: 11: Error: 78 VALUE used
])

AT_CLEANUP

AT_SETUP([78 VALUE])
AT_KEYWORDS([CONSTANT])

AT_DATA([prog.cob], [
       IDENTIFICATION DIVISION.
       PROGRAM-ID. prog.
       DATA DIVISION.
       WORKING-STORAGE SECTION.
       78  NUM2      VALUE   3.
       78  NEG1      VALUE   -1.
       78  CON3      VALUE   ((1 + 2) * NUM2 - 4.
       78  CON4      VALUE   (1 + 2) * NUM2 - 4).
       78  CON5      VALUE   (1 + 2) // NUM2.
       78  CON6      VALUE   (1 + 2 + 3 + (4)) / (NUM2).
       01  CON7      CONSTANT (1 + 2 + 3)* (4).
      *
       PROCEDURE DIVISION.
       MAIN.
           STOP RUN.
])

AT_CHECK([cobc -x -std=mf -w prog.cob ], [1], [],
[prog.cob: 8: Error: missing right parenthesis
prog.cob: 9: Error: missing left parenthesis
prog.cob: 10: Error: '/' operator misplaced
prog.cob: 12: Error: 01 CONSTANT used
])

AT_CLEANUP

AT_SETUP([Invalue Expression])
AT_KEYWORDS([EXPRESSION])

AT_DATA([prog.cob], [
        IDENTIFICATION DIVISION.
        PROGRAM-ID. prog.
        DATA DIVISION.
        WORKING-STORAGE SECTION.
        01 WRKN  PIC S999 VALUE 123.
        01 WRKX  PIC X(8) VALUE 'House'.
        PROCEDURE DIVISION.
        MAIN.
            EVALUATE WRKN
              GREATER ZERO
              < 0
              > 0
            WHEN TRUE
              DISPLAY "WHAT IS IT?"
            END-EVALUATE.
            IF WRKN = 123 EQUAL 456
              DISPLAY "Strange brew! " WRKN
            END-IF.
            IF WRKN NOT EQUAL 123 NOT = 456
              DISPLAY "Strange brew! " WRKN
            END-IF.
            IF WRKN = 123 OR 456
              DISPLAY "Home brew! " WRKN
            END-IF.
            IF WRKX = "Red" OR "White"
              DISPLAY "Home wine! " WRKX
            END-IF.
            IF WRKX <= "Red" = "White"
              DISPLAY "Home wine! " WRKX
            END-IF.
            IF WRKX = "Red" NOT "White"
              DISPLAY "Home wine! " WRKX
            END-IF.
            STOP RUN.
])

AT_CHECK([cobc -x -std=default -w prog.cob ], [1], [],
[prog.cob: In paragraph 'MAIN':
prog.cob: 10: Error: GREATER operator may be misplaced
prog.cob: 17: Error: EQUAL operator may be misplaced
prog.cob: 20: Error: NOT EQUAL operator may be misplaced
prog.cob: 29: Error: LESS OR EQUAL operator may be misplaced
prog.cob: 33: Error: Invalid expression
])

AT_CLEANUP

AT_SETUP([Constant Expressions (1)])
AT_KEYWORDS([Conditions])

AT_DATA([prog.cob], [
       IDENTIFICATION DIVISION.
       PROGRAM-ID. prog.
       DATA  DIVISION.
       WORKING-STORAGE SECTION.
       01  var       PIC X(200).
       01  OTHERvar  PIC X(115).
       01  A         PIC 9 VALUE 1.
       01  B         PIC 9 VALUE 2.
       01  C         PIC 9 VALUE 3.
       78  var-len   value 115.

       PROCEDURE DIVISION.

           IF var-len < 16
               move othervar (1:var-len - 8)
                 to var (17 - var-len:var-len - 8)
           ELSE
               move othervar to var
           END-IF.

           IF (2 = 3)
               move othervar to var
           ELSE
              IF 1 = 1
                 move var to othervar
              ELSE
                 move othervar (1:var-len - 8)
                   to var (17 - var-len:var-len - 8)
                 IF 1 = 1
                    move var to othervar
                 END-IF
              END-IF
              move A to B
              IF 1 = 1
                IF 2 = 1
                 move othervar (1:var-len - 8)
                   to var (17 - var-len:var-len - 8)
           .

           PERFORM WITH TEST BEFORE UNTIL 1 = 3
               move othervar to var
           END-PERFORM.

           PERFORM WITH TEST BEFORE UNTIL 1 = 1
               move othervar (1:var-len - 8)
                 to var (17 - var-len:var-len - 8)
           END-PERFORM.

           PERFORM WITH TEST AFTER UNTIL 1 = 3
               move othervar to var
           END-PERFORM.

           PERFORM WITH TEST AFTER UNTIL 1 = 1
               move othervar to var
           END-PERFORM.

           EVALUATE TRUE
           WHEN  var-len < 16
               move othervar (1:var-len - 8)
                 to var (17 - var-len:var-len - 8)
           WHEN  var-len > 16
               move othervar to var
           WHEN  A = B
               move othervar to var
           WHEN OTHER
               move othervar to var
           END-EVALUATE.

           EVALUATE FALSE
           WHEN  var-len < 16
               move othervar (1:var-len - 9)
                 to var (16 - var-len:var-len - 9)
           WHEN  var-len > 16
               move othervar to var
           WHEN  A = B
               move othervar to var
           WHEN OTHER
               move othervar to var
           END-EVALUATE.

           EVALUATE var-len
           WHEN  15
           WHEN 115
               move A to B
               move B to C
           WHEN  < 16
               move othervar (1:var-len - 8)
                 to var (17 - var-len:var-len - 8)
           WHEN  > 16
               move othervar to var
           WHEN OTHER
               move othervar to var
           END-EVALUATE.


           IF 15 = var-len
           OR var-len = 15
               move othervar to var.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -std=mf prog.cob ], [1], [],
[prog.cob: 15: Warning: Expression '115' LESS THAN '16' is always FALSE
prog.cob: 17: Error (ignored): Offset of 'var' out of bounds: -98
prog.cob: 22: Warning: Expression '2' EQUALS '3' is always FALSE
prog.cob: 25: Warning: Expression '1' EQUALS '1' is always TRUE
prog.cob: 29: Error (ignored): Offset of 'var' out of bounds: -98
prog.cob: 30: Warning: Expression '1' EQUALS '1' is always TRUE
prog.cob: 35: Warning: Expression '1' EQUALS '1' is always TRUE
prog.cob: 36: Warning: Expression '2' EQUALS '1' is always FALSE
prog.cob: 38: Error (ignored): Offset of 'var' out of bounds: -98
prog.cob: 41: Warning: Expression '1' EQUALS '3' is always FALSE
prog.cob: 41: Warning: PERFORM FOREVER since UNTIL is always FALSE
prog.cob: 45: Warning: Expression '1' EQUALS '1' is always TRUE
prog.cob: 45: Warning: PERFORM NEVER since UNTIL is always TRUE
prog.cob: 47: Error (ignored): Offset of 'var' out of bounds: -98
prog.cob: 50: Warning: Expression '1' EQUALS '3' is always FALSE
prog.cob: 50: Warning: PERFORM FOREVER since UNTIL is always FALSE
prog.cob: 54: Warning: Expression '1' EQUALS '1' is always TRUE
prog.cob: 54: Warning: PERFORM ONCE since UNTIL is always TRUE
prog.cob: 59: Warning: Expression '115' LESS THAN '16' is always FALSE
prog.cob: 61: Error (ignored): Offset of 'var' out of bounds: -98
prog.cob: 62: Warning: Expression '115' GREATER THAN '16' is always TRUE
prog.cob: 71: Warning: Expression '115' LESS THAN '16' is always FALSE
prog.cob: 73: Error: Offset of 'var' out of bounds: -99
prog.cob: 74: Warning: Expression '115' GREATER THAN '16' is always TRUE
prog.cob: 74: Warning: Expression is always TRUE
prog.cob: 74: Warning: Expression is always FALSE
prog.cob: 87: Warning: Expression '115' LESS THAN '16' is always FALSE
prog.cob: 89: Error (ignored): Offset of 'var' out of bounds: -98
prog.cob: 90: Warning: Expression '115' GREATER THAN '16' is always TRUE
prog.cob: 89: Warning: Expression '115' EQUALS '15' is always FALSE
prog.cob: 89: Warning: Expression '115' EQUALS '115' is always TRUE
prog.cob: 89: Warning: Expression is always TRUE
prog.cob: 98: Warning: Expression '15' EQUALS '115' is always FALSE
prog.cob: 98: Warning: Expression is always FALSE
])

AT_CLEANUP


AT_SETUP([Constant Expressions (2)])
AT_KEYWORDS([conditions])

AT_DATA([prog.cob], [
       IDENTIFICATION DIVISION.
       PROGRAM-ID. prog.
       DATA  DIVISION.
       WORKING-STORAGE SECTION.
       78  const1    value 115.
       78  const2    value 112.

       PROCEDURE DIVISION.

           IF const1 = const2
           OR const2 = const1
              DISPLAY 'no way' END-DISPLAY
           END-IF
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [0], [],
[prog.cob: 12: Warning: Expression '115' EQUALS '112' is always FALSE
prog.cob: 12: Warning: Expression is always FALSE
])

AT_CLEANUP


AT_SETUP([CONSTANT LENGTH])
AT_KEYWORDS([LENGTH])

AT_DATA([prog.cob], [
       identification division.  
       program-id. r_test recursive.
       environment division.  
       
       data division.  
       working-storage section. 
       
       01  item-01.
           05  item-05-a       pointer.
           05  item-05-b       pic x(01).
       
       01 myk-01 constant global as length of item-01.
       01 myk-02 constant global as length of item-05-a.
       01 myk-03 constant global as length of pointer.
       
       procedure division. 
       main-00. 
           goback.
       end program r_test.
])

AT_CHECK([cobc -x -std=default -w prog.cob ], [0], [],
[])

AT_CLEANUP

