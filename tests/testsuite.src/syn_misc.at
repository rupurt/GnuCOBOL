## Copyright (C) 2007-2012 Roger While
## Copyright (C) 2014 Simon Sobisch
##
## This file is part of GNU Cobol.
##
## The GNU Cobol compiler is free software: you can redistribute it
## and/or modify it under the terms of the GNU General Public License
## as published by the Free Software Foundation, either version 3 of the
## License, or (at your option) any later version.
##
## GNU Cobol is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
## GNU General Public License for more details.
##
## You should have received a copy of the GNU General Public License
## along with GNU Cobol.  If not, see <http://www.gnu.org/licenses/>.

### GNU Cobol Test Suite


AT_SETUP([Ambiguous AND/OR])
AT_KEYWORDS([misc expression])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       PROCEDURE        DIVISION.
           IF 3 = 1 AND 2 OR 3
               DISPLAY "OK"
               END-DISPLAY
           END-IF.
           IF 3 = 1 OR 2 AND 3
               DISPLAY "NO"
               END-DISPLAY
           END-IF.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [0], [],
[prog.cob: 6: Warning: Suggest parentheses around AND within OR
prog.cob: 10: Warning: Suggest parentheses around AND within OR
])

AT_CLEANUP


AT_SETUP([Invalid expression])
AT_KEYWORDS([misc])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01  CON          CONSTANT 10.
       01  V            PIC 9.
       78  C78          VALUE 'A'.
       PROCEDURE        DIVISION.
           IF FUNCTION TRIM (' ')
              CONTINUE
              CONTINUE
           END-IF.
           IF CON
              CONTINUE
              CONTINUE
           END-IF.
           IF V
              CONTINUE
              CONTINUE
           END-IF.
           IF C78
              CONTINUE
              CONTINUE
           END-IF.
           IF '2'
              CONTINUE
              CONTINUE
           END-IF.
           EVALUATE TRUE
              WHEN FUNCTION TRIM (' ')
                 CONTINUE
                 CONTINUE
              WHEN CON
                 CONTINUE
                 CONTINUE
              WHEN V
                 CONTINUE
                 CONTINUE
              WHEN C78
                 CONTINUE
                 CONTINUE
              WHEN '2'
                 CONTINUE
              WHEN OTHER
                 CONTINUE
           END-EVALUATE.
           PERFORM VARYING V
                   FROM 1 BY 1
                   UNTIL FUNCTION TRIM (' ')
              CONTINUE
              CONTINUE
           END-PERFORM.
           PERFORM VARYING V
                   FROM 1 BY 1
                   UNTIL V
              CONTINUE
              CONTINUE
           END-PERFORM.
           PERFORM VARYING V
                   FROM 1 BY 1
                   UNTIL C78
              CONTINUE
              CONTINUE
           END-PERFORM.
           PERFORM VARYING V
                   FROM 1 BY 1
                   UNTIL '2'
              CONTINUE
              CONTINUE
           END-PERFORM.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 10: Error: Invalid expression
prog.cob: 14: Error: Invalid expression
prog.cob: 18: Error: Invalid expression
prog.cob: 22: Error: Invalid expression
prog.cob: 26: Error: Invalid expression
prog.cob: 31: Error: Invalid expression
prog.cob: 34: Error: Invalid expression
prog.cob: 37: Error: Invalid expression
prog.cob: 40: Error: Invalid expression
prog.cob: 43: Error: Invalid expression
prog.cob: 50: Error: Invalid expression
prog.cob: 56: Error: Invalid expression
prog.cob: 62: Error: Invalid expression
prog.cob: 68: Error: Invalid expression
])

AT_CLEANUP


AT_SETUP([Missing headers])
AT_KEYWORDS([misc])

AT_DATA([prog.cob], [
       SOURCE-COMPUTER. LINUX.
       SPECIAL-NAMES.
            SYMBOLIC NL IS 101
                     NL2   102
            NUMERIC SIGN TRAILING SEPARATE
            DECIMAL-POINT IS COMMA
            .

            SELECT PRINT-FILE ASSIGN "EXTRXW"
            ORGANIZATION LINE SEQUENTIAL
            .
       DATA DIVISION.
       FD  PRINT-FILE EXTERNAL.
       01  PRINT-REC          PIC X(64).

           DISPLAY "X"
           END-DISPLAY
           ACCEPT OMITTED
           END-ACCEPT
           GOBACK
           .
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 2: Error: PROGRAM-ID header missing
prog.cob: 2: Error: ENVIRONMENT DIVISION header missing
prog.cob: 2: Error: CONFIGURATION SECTION header missing
prog.cob: 10: Error: INPUT-OUTPUT SECTION header missing
prog.cob: 10: Error: FILE-CONTROL header missing
prog.cob: 14: Error: FILE SECTION header missing
prog.cob: 17: Error: PROCEDURE DIVISION header missing
])

AT_CLEANUP

AT_SETUP([INITIALIZE constant])
AT_KEYWORDS([misc])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01  CON          CONSTANT 10.
       01  V            PIC 9.
       78  C78          VALUE 'A'.
       PROCEDURE DIVISION.
           INITIALIZE CON.
           INITIALIZE V.
           INITIALIZE V, 9.
           INITIALIZE C78, V.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 10: Error: Invalid INITIALIZE statement
prog.cob: 12: Error: Invalid INITIALIZE statement
prog.cob: 13: Error: Invalid INITIALIZE statement
])

AT_CLEANUP


AT_SETUP([CLASS duplicate values])
AT_KEYWORDS([misc])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT      DIVISION.
       CONFIGURATION    SECTION.
       SPECIAL-NAMES.
            SYMBOLIC NL IS 101
                     NL2   102
            CLASS    CHECK-VALID    'a' THRU 'z'
                                    'A' THRU 'Z'
                                    'cdef'
            NUMERIC SIGN TRAILING SEPARATE
            DECIMAL-POINT IS COMMA
            .
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 X             PIC X(8).
       PROCEDURE        DIVISION.
           IF X         IS CHECK-VALID
              DISPLAY "OK"
              END-DISPLAY
           END-IF.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 9: Error: Duplicate values in class 'CHECK-VALID'
])

AT_CLEANUP


AT_SETUP([INSPECT invalid size])
AT_KEYWORDS([misc])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 X             PIC X(8).
       PROCEDURE        DIVISION.
           INSPECT X REPLACING ALL SPACES BY "AA".
           INSPECT X REPLACING ALL "ABC"  BY "AA".
           INSPECT X REPLACING ALL "DEF"  BY SPACES.
           INSPECT X CONVERTING SPACES TO "AA".
           INSPECT X CONVERTING "ABC"  TO "AA".
           INSPECT X CONVERTING "DEF"  TO SPACES.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 8: Error: REPLACING operands differ in size
prog.cob: 9: Error: REPLACING operands differ in size
prog.cob: 11: Error: CONVERTING operands differ in size
prog.cob: 12: Error: CONVERTING operands differ in size
])

AT_CLEANUP


AT_SETUP([INSPECT invalid target])
AT_KEYWORDS([misc])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 X             PIC X(8).
       PROCEDURE        DIVISION.
           INSPECT FUNCTION TRIM(X) REPLACING ALL "ABC" BY "DEF".
           INSPECT FUNCTION TRIM(X) CONVERTING "ABC" TO "AAA".
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 8: Error: Invalid target for REPLACING
prog.cob: 9: Error: Invalid target for CONVERTING
])

AT_CLEANUP


AT_SETUP([INSPECT missing keyword])
AT_KEYWORDS([misc])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 X             PIC X(8).
       PROCEDURE        DIVISION.
           INSPECT X REPLACING "AB" BY "CD".
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 8: Error: INSPECT missing a keyword
])

AT_CLEANUP


AT_SETUP([Maximum data size])
AT_KEYWORDS([misc])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 SINGLE-ITEM   PIC X(999999999).
       01 GROUP-ITEM1.
          05 FILLER     PIC X(999999999).
       01 GROUP-ITEM2.
          05 FILLER     PIC X(199999999).
          05 FILLER     PIC X(199999999).
       PROCEDURE        DIVISION.
           STOP RUN.

])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 6: Error: 'SINGLE-ITEM' cannot be larger than 268435456 bytes
prog.cob: 8: Error: 'FILLER 1' cannot be larger than 268435456 bytes
prog.cob: 7: Error: 'GROUP-ITEM1' cannot be larger than 268435456 bytes
prog.cob: 9: Error: 'GROUP-ITEM2' cannot be larger than 268435456 bytes
])

AT_CLEANUP


AT_SETUP([Unreachable statement])
AT_KEYWORDS([misc extensions])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT f ASSIGN TO 'f' LINE SEQUENTIAL.
       DATA DIVISION.
       FILE SECTION.
       FD  f.
       01  f-rec PIC X.
       WORKING-STORAGE  SECTION.
       PROCEDURE        DIVISION.
       DECLARATIVES.
       f-error SECTION.
           USE AFTER ERROR ON f.
           GOBACK
           .
       END DECLARATIVES.

           DISPLAY "VALID"
           END-DISPLAY.

       P01.
           GO TO P02.
           DISPLAY "INVALID"
           END-DISPLAY.
       P02.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -Wunreachable prog.cob], [0], ,
[prog.cob: In paragraph 'P01':
prog.cob: 26: Warning: Unreachable statement 'DISPLAY'
])

AT_CLEANUP


AT_SETUP([CRT STATUS])
AT_KEYWORDS([SPECIAL-NAMES misc])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SPECIAL-NAMES.
           CRT STATUS IS MY-CRT-STATUS.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 X             PIC X.
       PROCEDURE        DIVISION.
           ACCEPT X END-ACCEPT.
           STOP RUN.
])

AT_DATA([prog2.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog2.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SPECIAL-NAMES.
           CRT STATUS IS MY-CRT-STATUS.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 X             PIC X.
       77 MY-CRT-STATUS PIC 9(04).
       PROCEDURE        DIVISION.
           ACCEPT X END-ACCEPT.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 7: Error: 'MY-CRT-STATUS' is not defined
])
AT_CHECK([$COMPILE_ONLY prog2.cob], [0])

AT_CLEANUP


AT_SETUP([SWITCHES])
AT_KEYWORDS([runmisc extensions])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SPECIAL-NAMES.
           SW1
             ON  IS SWIT1-ON
             OFF IS SWIT1-OFF
           .
           SWITCH B IS SWITCH-B
             ON  IS SWIT2-ON
             OFF IS SWIT2-OFF
           .
           SWITCH-25
             ON  IS SWIT25-ON
             OFF IS SWIT25-OFF
           .
           SWITCH-25
             ON  IS SWIT25-IS-ON
             OFF IS SWIT25-IS-OFF
           .
           SWITCH 25
             ON  IS SWIT25-SP-ON
             OFF IS SWIT25-SP-OFF
           .
           SWITCH Y
             ON  IS SWIT25-Y-ON
             OFF IS SWIT25-Y-OFF
           .
           SWITCH Z
             ON  IS SWIT26-ON
             ON  IS SWIT26-OFF
           .
           SWITCH-32
             ON  IS SWIT32-ON
           .
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01  SWITCH       PIC 99 VALUE 12.
       PROCEDURE        DIVISION.
           ADD SWITCH 1 GIVING SWITCH
           END-ADD.
           IF SWITCH NOT = 13
              DISPLAY "SWITCH (variable) WRONG: "
                      SWITCH
              END-DISPLAY
           END-IF.
           IF SWIT1-ON
              DISPLAY "ON" NO ADVANCING
              END-DISPLAY
           ELSE
              DISPLAY "OFF" NO ADVANCING
              END-DISPLAY
           END-IF.
           IF SWIT2-ON
              DISPLAY " ON" NO ADVANCING
              END-DISPLAY
           ELSE
              DISPLAY " OFF" NO ADVANCING
              END-DISPLAY
           END-IF.
           SET SWITCH-B TO OFF
           IF SWIT2-ON
              CONTINUE
           END-IF.
           IF SWIT25-ON
              CONTINUE
           END-IF.
           IF SWIT26-ON
              CONTINUE
           END-IF.
           IF SWIT32-ON
              CONTINUE
           END-IF.
           IF SWIT32-OFF
              CONTINUE
           END-IF.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 7: Error: Invalid system-name 'SW1'
prog.cob: 8: Error: ON/OFF usage requires a SWITCH name
prog.cob: 9: Error: ON/OFF usage requires a SWITCH name
prog.cob: 11: Error: Invalid system-name 'SWITCH B'
prog.cob: 12: Error: ON/OFF usage requires a SWITCH name
prog.cob: 13: Error: ON/OFF usage requires a SWITCH name
prog.cob: 23: Error: Invalid system-name 'SWITCH 25'
prog.cob: 24: Error: ON/OFF usage requires a SWITCH name
prog.cob: 25: Error: ON/OFF usage requires a SWITCH name
prog.cob: 27: Error: Invalid system-name 'SWITCH Y'
prog.cob: 28: Error: ON/OFF usage requires a SWITCH name
prog.cob: 29: Error: ON/OFF usage requires a SWITCH name
prog.cob: 31: Error: Invalid system-name 'SWITCH Z'
prog.cob: 32: Error: ON/OFF usage requires a SWITCH name
prog.cob: 33: Error: ON/OFF usage requires a SWITCH name
prog.cob: 49: Error: 'SWIT1-ON' is not defined
prog.cob: 56: Error: 'SWIT2-ON' is not defined
prog.cob: 63: Error: 'SWITCH-B' is not defined
prog.cob: 63: Error: syntax error, unexpected OFF
prog.cob: 64: Error: syntax error, unexpected Identifier
prog.cob: 66: Error: syntax error, unexpected END-IF
prog.cob: 70: Error: 'SWIT26-ON' is not defined
prog.cob: 76: Error: 'SWIT32-OFF' is not defined
])
# There should be an additional
#prog.cob: 19: Error: duplicate definition of 'SWITCH-25'
#prog.cob: 15: Error: 'SWITCH-25' previously defined here
#
AT_CHECK([$COMPILE_ONLY -fsyntax-extension prog.cob], [1], [],
[prog.cob: 33: Error: Duplicate ON clause
prog.cob: 76: Error: 'SWIT32-OFF' is not defined
])
# There should be an additional
#prog.cob: 19: Error: duplicate definition of 'SWITCH-25'
#prog.cob: 15: Error: 'SWITCH-25' previously defined here
#prog.cob: 23: Error: duplicate definition of 'SWITCH 25'
#prog.cob: 15: Error: 'SWITCH-25' previously defined here
#prog.cob: 27: Error: duplicate definition of 'SWITCH Y'
#prog.cob: 15: Error: 'SWITCH-25' previously defined here

AT_CLEANUP


AT_SETUP([ACCEPT WITH ( NO ) UPDATE / DEFAULT])
AT_KEYWORDS([misc extensions])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 X             PIC X.
       PROCEDURE        DIVISION.
           ACCEPT X                 END-ACCEPT.
           ACCEPT X WITH    UPDATE  END-ACCEPT.
           ACCEPT X WITH    DEFAULT END-ACCEPT.
           ACCEPT X WITH NO UPDATE  END-ACCEPT.
           ACCEPT X WITH NO DEFAULT END-ACCEPT.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -cb_conf=accept-update:yes prog.cob], [0], [], [])

AT_CLEANUP


AT_SETUP([ACCEPT WITH AUTO / TAB])
AT_KEYWORDS([AUTO-SKIP AUTOTERMINATE misc extensions])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 X             PIC X.
       PROCEDURE        DIVISION.
           ACCEPT X                       END-ACCEPT.
           ACCEPT X WITH    AUTO          END-ACCEPT.
           ACCEPT X WITH    AUTO-SKIP     END-ACCEPT.
           ACCEPT X WITH    AUTOTERMINATE END-ACCEPT.
           ACCEPT X WITH    TAB           END-ACCEPT.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -cb_conf=accept-auto:yes prog.cob], [0], [], [])

AT_CLEANUP


AT_SETUP([ACCEPT WITH SIZE])
AT_KEYWORDS([PROTECTED SIZE misc extensions])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 X             PIC X(05).
       01 Y             PIC 9(04) BINARY VALUE 4.
       PROCEDURE        DIVISION.
           ACCEPT X WITH           SIZE    0 END-ACCEPT.
           ACCEPT X WITH           SIZE IS 1 END-ACCEPT.
           ACCEPT X WITH PROTECTED SIZE    2 END-ACCEPT.
           ACCEPT X WITH PROTECTED SIZE IS 3 END-ACCEPT.
           ACCEPT X WITH           SIZE    Y END-ACCEPT.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [0], [], [])

AT_CLEANUP


AT_SETUP([DISPLAY WITH SIZE])
AT_KEYWORDS([SIZE misc extensions])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 X             PIC X(05).
       01 Y             PIC 9(04) BINARY VALUE 7.
       PROCEDURE        DIVISION.
           DISPLAY X WITH SIZE    5 END-DISPLAY.
           DISPLAY X WITH SIZE IS 6 END-DISPLAY.
           DISPLAY X WITH SIZE IS Y END-DISPLAY.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [0], [], [])

AT_CLEANUP


AT_SETUP([Source text after column 72 in Fixed-form])
AT_KEYWORDS([misc fixed])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       PROCEDURE        DIVISION.                                       COMMENT
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -W prog.cob], [0], [],
[prog.cob: 8: Warning: Source text after column 72
])

AT_CLEANUP


AT_SETUP([Line overflow in Fixed-form / Free-form])
AT_KEYWORDS([misc])

# We're testing trailing tabs and whitespace (should not lead to warning)
# along with comments after boundaries (col 72 / col 512)

# AT_DATA removes trailing spaces, workaround: add "_" and
# remove it later via sed

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.                                           																																																																																																																																		_
       DATA             DIVISION.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  _
       WORKING-STORAGE  SECTION.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   *> This is a real comment
       PROCEDURE        DIVISION.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  This is commentary only
           CONTINUE.                                              *> comment after column 72
      *    This is a very long comment that exceeds column 72 but doesn't exceed 512 bytes, therefore not leading to a line overflow. As it is a comment line there is no "Source text after column 72" warning
           CONTINUE.                                                    CONTINUE.
           CONTINUE.                                                                        _
           STOP RUN.
])

# AT_DATA workaround via sed:
AT_CHECK([sed -i -e 's/_$//' prog.cob], [0])

AT_CHECK([$COMPILE_ONLY -fixed -W prog.cob], [0], [],
[prog.cob: 7: Warning: Source text exceeds 512 bytes, will be truncated
prog.cob: 8: Warning: Source text exceeds 512 bytes, will be truncated
prog.cob: 11: Warning: Source text after column 72
])

AT_CHECK([$COMPILE_ONLY -free -W prog.cob], [1], [],
[prog.cob: 7: Warning: Source text exceeds 512 bytes, will be truncated
prog.cob: 8: Warning: Source text exceeds 512 bytes, will be truncated
prog.cob: 8: Error: Unknown statement 'This'
])

AT_CLEANUP


AT_SETUP([Continuation Indicator - Literal too long])
AT_KEYWORDS([misc fixed])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       PROCEDURE        DIVISION.
           DISPLAY '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    ' ' END-DISPLAY.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -std=default prog.cob], [1], [],
[prog.cob: 538: Error: Buffer overrun - Too much continuation lines
])

AT_CLEANUP


AT_SETUP([Literal too long])
AT_KEYWORDS([misc])

# Currently not checked, see Feature Request #43
AT_SKIP_IF(true)

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       PROCEDURE        DIVISION.
           DISPLAY '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    '
      -    ' ' END-DISPLAY.
           STOP RUN.
])

AT_DATA([prog2.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog2.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       PROCEDURE        DIVISION.
           DISPLAY '    '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           '                                                                                                                                                                                                                                             '-
           ' ' END-DISPLAY.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -std=default -fixed prog.cob], [1], [],
[prog.cob: 148: Error: Literal too long, exceeds 8191 alphanumeric character positions.
])

AT_CHECK([$COMPILE_ONLY -std=default -free prog2.cob], [1], [],
[prog.cob: 45: Error: Literal too long, exceeds 8191 alphanumeric character positions.
])

AT_CLEANUP


AT_SETUP([word length])
AT_KEYWORDS([misc])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01  FILLER        PIC 9(01) VALUE 0.
           88 SOME-SPECIAL-VAL-WITH-LENGTH30    VALUE 0.
           88 SOME-SPECIAL-VAL-WITH-LENGTH-31   VALUE 1.
           88 SOME-SPECIAL-VAL-WITH-LENGTH-32C  VALUE 1.
           88 SOME-SPECIAL-VAL-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES      VALUE 3.
           88 SOME-SPECIAL-VAL-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE VALUE 4.
       PROCEDURE        DIVISION.
       SOME-SPECIAL-PAR-WITH-LENGTH30.
           SET  SOME-SPECIAL-VAL-WITH-LENGTH30   TO TRUE.
       SOME-SPECIAL-PAR-WITH-LENGTH-31.
           SET  SOME-SPECIAL-VAL-WITH-LENGTH-31  TO TRUE.
       SOME-SPECIAL-PAR-WITH-LENGTH-32C.
           SET  SOME-SPECIAL-VAL-WITH-LENGTH-32C TO TRUE.
       SOME-SPECIAL-PAR-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES.
           SET  SOME-SPECIAL-VAL-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES TO TRUE.
       SOME-SPECIAL-PAR-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE.
           SET  SOME-SPECIAL-VAL-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE TO TRUE.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -free -W prog.cob], [1], [],
[prog.cob: 11: Error: Word length exceeds 31 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-32C'
prog.cob: 12: Error: Word length exceeds 31 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES'
prog.cob: 13: Error: Word length exceeds maximum of 61 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE'
prog.cob: In paragraph 'SOME-SPECIAL-PAR-WITH-LENGTH-31':
prog.cob: 19: Error: Word length exceeds 31 characters - 'SOME-SPECIAL-PAR-WITH-LENGTH-32C'
prog.cob: In paragraph 'SOME-SPECIAL-PAR-WITH-LENGTH-32C':
prog.cob: 20: Error: Word length exceeds 31 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-32C'
prog.cob: 21: Error: Word length exceeds 31 characters - 'SOME-SPECIAL-PAR-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES'
prog.cob: In paragraph 'SOME-SPECIAL-PAR-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES':
prog.cob: 22: Error: Word length exceeds 31 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES'
prog.cob: 23: Error: Word length exceeds maximum of 61 characters - 'SOME-SPECIAL-PAR-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE'
prog.cob: In paragraph 'SOME-SPECIAL-PAR-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE':
prog.cob: 24: Error: Word length exceeds maximum of 61 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE'
])

AT_CHECK([$COMPILE_ONLY -free -W -cb_conf=word-length:45 prog.cob], [1], [],
[prog.cob: 12: Error: Word length exceeds 45 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES'
prog.cob: 13: Error: Word length exceeds maximum of 61 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE'
prog.cob: In paragraph 'SOME-SPECIAL-PAR-WITH-LENGTH-32C':
prog.cob: 21: Error: Word length exceeds 45 characters - 'SOME-SPECIAL-PAR-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES'
prog.cob: In paragraph 'SOME-SPECIAL-PAR-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES':
prog.cob: 22: Error: Word length exceeds 45 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES'
prog.cob: 23: Error: Word length exceeds maximum of 61 characters - 'SOME-SPECIAL-PAR-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE'
prog.cob: In paragraph 'SOME-SPECIAL-PAR-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE':
prog.cob: 24: Error: Word length exceeds maximum of 61 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE'
])

AT_CHECK([$COMPILE_ONLY -free -W -cb_conf=word-length:60 prog.cob], [1], [],
[prog.cob: 13: Error: Word length exceeds maximum of 61 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE'
prog.cob: In paragraph 'SOME-SPECIAL-PAR-WITH-LENGTH-58C-WHO-NEEDS-THAT-LONG-NAMES':
prog.cob: 23: Error: Word length exceeds maximum of 61 characters - 'SOME-SPECIAL-PAR-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE'
prog.cob: In paragraph 'SOME-SPECIAL-PAR-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE':
prog.cob: 24: Error: Word length exceeds maximum of 61 characters - 'SOME-SPECIAL-VAL-WITH-LENGTH-90-CHARS-WHO-NEEDS-THAT-LONG-NAMES-I-CANNOT-THINK-OF-SOMEONE'
])

AT_CLEANUP


AT_SETUP([Line and floating comments])
AT_KEYWORDS([misc extensions])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       PROCEDURE        DIVISION.
      *    DISPLAY 'COMMENT'             END-DISPLAY
      /    DISPLAY 'COMMENTSLASH'        END-DISPLAY
*          DISPLAY 'MFCOMMENTASTERISK'   END-DISPLAY
/          DISPLAY 'MFCOMMENTSLASH'      END-DISPLAY
 *         DISPLAY 'NOMFCOMMENTASTERISK' END-DISPLAY
 /         DISPLAY 'NOMFCOMMENTSLASH'    END-DISPLAY
        *> DISPLAY 'FLOATING'            END-DISPLAY
 *>        DISPLAY 'NOFLOATING'          END-DISPLAY
           STOP RUN.
])

AT_DATA([prog2.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog2.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       PROCEDURE        DIVISION.
      *    DISPLAY 'COMMENT'             END-DISPLAY
      /    DISPLAY 'COMMENTSLASH'        END-DISPLAY
      $    DISPLAY 'COMMENTDOLLAR'       END-DISPLAY
*          DISPLAY 'MFCOMMENTASTERISK'   END-DISPLAY
/          DISPLAY 'MFCOMMENTSLASH'      END-DISPLAY
 *         DISPLAY 'NOMFCOMMENTASTERISK' END-DISPLAY
 /         DISPLAY 'NOMFCOMMENTSLASH'    END-DISPLAY
        *> DISPLAY 'FLOATING'            END-DISPLAY
        |  DISPLAY 'ACUFLOATING'         END-DISPLAY
 |         DISPLAY 'NOACUFLOATING'       END-DISPLAY
 *>        DISPLAY 'NOFLOATING'          END-DISPLAY
           STOP RUN.
])

AT_DATA([prog3.cob], [
IDENTIFICATION   DIVISION.
PROGRAM-ID.      prog3.
ENVIRONMENT DIVISION.
CONFIGURATION SECTION.
DATA             DIVISION.
WORKING-STORAGE  SECTION.
PROCEDURE        DIVISION.
      * DISPLAY 'NOCOMMENT'           END-DISPLAY
      / DISPLAY 'NOCOMMENTSLASH'      END-DISPLAY
      $ DISPLAY 'NOCOMMENTDOLLAR'     END-DISPLAY
*       DISPLAY 'NOMFCOMMENTASTERISK' END-DISPLAY
/       DISPLAY 'NOMFCOMMENTSLASH'    END-DISPLAY
 |      DISPLAY 'ACUFLOATING'         END-DISPLAY
 *>     DISPLAY 'FLOATING'            END-DISPLAY
        STOP RUN.
])

AT_CHECK([$COMPILE prog.cob], [0], [], [])

AT_CHECK([./prog], [0],
[MFCOMMENTASTERISK
MFCOMMENTSLASH
NOMFCOMMENTASTERISK
NOMFCOMMENTSLASH
NOFLOATING
], [])

AT_CHECK([$COMPILE_ONLY prog2.cob], [1], [],
[prog2.cob: 11: Error: Invalid indicator '$' at column 7
])


AT_CHECK([$COMPILE -fmfcomment prog.cob], [0], [],
[])

AT_CHECK([./prog], [0],
[NOMFCOMMENTASTERISK
NOMFCOMMENTSLASH
NOFLOATING
], [])

AT_CHECK([$COMPILE_ONLY -fmfcomment prog2.cob], [1], [],
[prog2.cob: 11: Error: Invalid indicator '$' at column 7
])


AT_CHECK([$COMPILE -facucomment prog.cob], [0], [], [])

AT_CHECK([./prog], [0],
[MFCOMMENTASTERISK
MFCOMMENTSLASH
NOMFCOMMENTASTERISK
NOMFCOMMENTSLASH
NOFLOATING
], [])

AT_CHECK([$COMPILE -facucomment prog2.cob], [0], [], [])

AT_CHECK([./prog2], [0],
[MFCOMMENTASTERISK
MFCOMMENTSLASH
NOMFCOMMENTASTERISK
NOMFCOMMENTSLASH
NOACUFLOATING
NOFLOATING
], [])


AT_CHECK([$COMPILE_ONLY -free prog3.cob], [1], [],
[prog3.cob: 11: Warning: Spurious '$' detected - ignoring
prog3.cob: 9: Error: syntax error, unexpected *
prog3.cob: 9: Error: syntax error, unexpected Literal
prog3.cob: 10: Error: syntax error, unexpected /
prog3.cob: 10: Error: syntax error, unexpected Literal
prog3.cob: 12: Error: syntax error, unexpected *
prog3.cob: 12: Error: syntax error, unexpected Literal
prog3.cob: 13: Error: syntax error, unexpected /
prog3.cob: 13: Error: syntax error, unexpected Literal
prog3.cob: 14: Error: Invalid symbol: | - Skipping word
])
AT_CHECK([$COMPILE_ONLY -free -fmfcomment prog3.cob], [1], [],
[prog3.cob: 11: Warning: Spurious '$' detected - ignoring
prog3.cob: 9: Error: syntax error, unexpected *
prog3.cob: 9: Error: syntax error, unexpected Literal
prog3.cob: 10: Error: syntax error, unexpected /
prog3.cob: 10: Error: syntax error, unexpected Literal
prog3.cob: 12: Error: syntax error, unexpected *
prog3.cob: 12: Error: syntax error, unexpected Literal
prog3.cob: 13: Error: syntax error, unexpected /
prog3.cob: 13: Error: syntax error, unexpected Literal
prog3.cob: 14: Error: Invalid symbol: | - Skipping word
])
AT_CHECK([$COMPILE_ONLY -free -facucomment prog3.cob], [1], [],
[prog3.cob: 11: Warning: Spurious '$' detected - ignoring
prog3.cob: 9: Error: syntax error, unexpected *
prog3.cob: 9: Error: syntax error, unexpected Literal
prog3.cob: 10: Error: syntax error, unexpected /
prog3.cob: 10: Error: syntax error, unexpected Literal
prog3.cob: 12: Error: syntax error, unexpected *
prog3.cob: 12: Error: syntax error, unexpected Literal
prog3.cob: 13: Error: syntax error, unexpected /
prog3.cob: 13: Error: syntax error, unexpected Literal
])

AT_CLEANUP

AT_SETUP([Continuation Indicator - No literal to continue])
AT_KEYWORDS([misc fixed])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       PROCEDURE        DIVISION.
           DISPLAY "Hello,"
      -        " world!"
           END-DISPLAY
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 6: Error: Invalid continuation: no literal/word needs to be continued
])
AT_CLEANUP

AT_SETUP([Floating-point literals])
AT_KEYWORDS([misc])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       PROCEDURE        DIVISION.
           *> Refer to Section 8.3.1.2.2.2 of the COBOL 2010 FCD.
           *> Valid literals
           DISPLAY 1.0E76, +1.0E+3, +1.0E-0078,
               +.0000000000000000000000000000000000E+0000
           END-DISPLAY

           *> Invalid literals
           DISPLAY 1.0D3 END-DISPLAY
           DISPLAY 1E3 END-DISPLAY
           DISPLAY 1.0E3BLAH END-DISPLAY
           DISPLAY 1.0E3.0 END-DISPLAY
           DISPLAY -0.0E-0 END-DISPLAY
           DISPLAY 1.0E00003 END-DISPLAY
           DISPLAY .00000000000000000000000000000000000E0 END-DISPLAY
           DISPLAY 0.0E3 END-DISPLAY

           *> Implementor-defined invalid literals
           DISPLAY 1.0E77 END-DISPLAY
           DISPLAY 1.0E-79 END-DISPLAY

           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 12: Error: 'D3' is not defined
prog.cob: 13: Error: '1E3' is not defined
prog.cob: 14: Error: 'BLAH' is not defined
prog.cob: 15: Error: Exponent has decimal point
prog.cob: 16: Error: Significand of 0 is negative
prog.cob: 16: Error: Exponent of 0 is negative
prog.cob: 17: Error: Exponent has more than 4 digits
prog.cob: 18: Error: Significand has more than 34 digits
prog.cob: 19: Error: Exponent of 0 is not 0
prog.cob: 22: Error: Exponent not between -78 and 76
prog.cob: 23: Error: Exponent not between -78 and 76
])
AT_CLEANUP

AT_SETUP([X literals])
AT_KEYWORDS([misc])

AT_DATA([prog.cob], [
       IDENTIFICATION DIVISION.
       PROGRAM-ID.    prog.
       PROCEDURE      DIVISION.
           *> Valid form
           DISPLAY X"0123456789ABCDEF"

           *> Invalid form
           DISPLAY X"GH" X"1"
           .
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 9: Error: X literal contains invalid character 'G'
prog.cob: 9: Error: X literal contains invalid character 'H'
prog.cob: 9: Error: X literal does not have an even number of digits
])
AT_CLEANUP

AT_SETUP([Binary literals])
AT_KEYWORDS([misc extensions])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       PROCEDURE        DIVISION.
           DISPLAY B"101010" END-DISPLAY
           DISPLAY B"111111111111111111111111111111111111111111111111111
      -             "1111111111111" *> " Syntax highlighting hack

           DISPLAY B"23" END-DISPLAY
           DISPLAY B"111111111111111111111111111111111111111111111111111
      -             "111111111111111111111111111111111111111111111111111
      -             "11111111111111111111111111111111111111111111111111"
           END-DISPLAY
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -std=mf prog.cob], [1], [],
[prog.cob: 9: Error: B literal contains invalid character '2'
prog.cob: 9: Error: B literal contains invalid character '3'
prog.cob: 10: Error: B literal too long; 64 bits max
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 5: Error: Numeric boolean literal does not conform to COBOL 2002
prog.cob: 6: Error: Numeric boolean literal does not conform to COBOL 2002
prog.cob: 9: Error: Numeric boolean literal does not conform to COBOL 2002
prog.cob: 9: Error: B literal contains invalid character '2'
prog.cob: 9: Error: B literal contains invalid character '3'
prog.cob: 10: Error: Numeric boolean literal does not conform to COBOL 2002
prog.cob: 10: Error: B literal too long; 64 bits max
])

AT_CLEANUP

AT_SETUP([ACUCOBOL literals])
AT_KEYWORDS([misc extensions])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       PROCEDURE        DIVISION.
           *> Valid forms
           DISPLAY B#10 O#12345670123 X#12345678 H#90aBcDeF
           END-DISPLAY

           *> Invalid forms
       >>SOURCE FREE
           DISPLAY B#11111111111111111111111111111111111111111111111111111111111111111
               O#11111111111111111111111 X#11111111111111111 H#11111111111111111
       >>SOURCE FIXED
           DISPLAY B#23 O#89 X#GG H#GG
       
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -std=acu prog.cob], [1], [],
[prog.cob: 11: Error: B literal too long; 64 bits max
prog.cob: 12: Error: O literal too long; 22 digits max
prog.cob: 12: Error: Hexadecimal literal is longer than 16 digits
prog.cob: 12: Error: Hexadecimal literal is longer than 16 digits
prog.cob: 14: Error: B literal contains invalid character '2'
prog.cob: 14: Error: B literal contains invalid character '3'
prog.cob: 14: Error: O literal contains invalid character '8'
prog.cob: 14: Error: O literal contains invalid character '9'
prog.cob: 14: Error: Hexadecimal literal contains invalid character 'G'
prog.cob: 14: Error: Hexadecimal literal contains invalid character 'G'
prog.cob: 14: Error: Hexadecimal literal contains invalid character 'G'
prog.cob: 14: Error: Hexadecimal literal contains invalid character 'G'
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 6: Error: ACUCOBOL numeric literal does not conform to COBOL 2002
prog.cob: 6: Error: ACUCOBOL numeric literal does not conform to COBOL 2002
prog.cob: 6: Error: ACUCOBOL numeric literal does not conform to COBOL 2002
prog.cob: 6: Error: ACUCOBOL numeric literal does not conform to COBOL 2002
prog.cob: 11: Error: ACUCOBOL numeric literal does not conform to COBOL 2002
prog.cob: 11: Error: B literal too long; 64 bits max
prog.cob: 12: Error: ACUCOBOL numeric literal does not conform to COBOL 2002
prog.cob: 12: Error: O literal too long; 22 digits max
prog.cob: 12: Error: ACUCOBOL numeric literal does not conform to COBOL 2002
prog.cob: 12: Error: Hexadecimal literal is longer than 16 digits
prog.cob: 12: Error: ACUCOBOL numeric literal does not conform to COBOL 2002
prog.cob: 12: Error: Hexadecimal literal is longer than 16 digits
prog.cob: 14: Error: ACUCOBOL numeric literal does not conform to COBOL 2002
prog.cob: 14: Error: B literal contains invalid character '2'
prog.cob: 14: Error: B literal contains invalid character '3'
prog.cob: 14: Error: ACUCOBOL numeric literal does not conform to COBOL 2002
prog.cob: 14: Error: O literal contains invalid character '8'
prog.cob: 14: Error: O literal contains invalid character '9'
prog.cob: 14: Error: ACUCOBOL numeric literal does not conform to COBOL 2002
prog.cob: 14: Error: Hexadecimal literal contains invalid character 'G'
prog.cob: 14: Error: Hexadecimal literal contains invalid character 'G'
prog.cob: 14: Error: ACUCOBOL numeric literal does not conform to COBOL 2002
prog.cob: 14: Error: Hexadecimal literal contains invalid character 'G'
prog.cob: 14: Error: Hexadecimal literal contains invalid character 'G'
])

AT_CLEANUP

AT_SETUP([AT clause numbers])
AT_KEYWORDS([misc])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       *> Note the number of digits in the value clause. This checks that the
       *> compiler only warns on invalid PICTURE lengths, not the literals in
       *> the VALUE clauses.
       01  valid-1      PIC 9(3) VALUE 1.
       01  valid-2      PIC 9(4) VALUE 00001.
       01  valid-3      PIC 9(6) VALUE 0000001.

       01  invalid-1    PIC 9(5) VALUE 1.
       01  invalid-2    PIC 9(7) VALUE 1.
       
       PROCEDURE        DIVISION.
           *> Valid values
           DISPLAY SPACE AT 001 END-DISPLAY
           DISPLAY SPACE AT 0101 END-DISPLAY
           DISPLAY SPACE AT 001001 END-DISPLAY
           DISPLAY SPACE AT valid-1 END-DISPLAY
           DISPLAY SPACE AT valid-2 END-DISPLAY
           DISPLAY SPACE AT valid-3 END-DISPLAY

           *> Invalid values
           DISPLAY SPACE AT 12345 END-DISPLAY
           DISPLAY SPACE AT 1234567 END-DISPLAY
           DISPLAY SPACE AT invalid-1 END-DISPLAY
           DISPLAY SPACE AT invalid-2 END-DISPLAY
           
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY prog.cob], [1], [],
[prog.cob: 26: Error: Value in AT clause may not have 5 digits
prog.cob: 27: Error: Value in AT clause may not be longer than 6 digits
prog.cob: 28: Error: Value in AT clause may not have 5 digits
prog.cob: 29: Error: Value in AT clause may not be longer than 6 digits
])
AT_CLEANUP
