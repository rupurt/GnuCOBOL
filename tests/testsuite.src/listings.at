## Copyright (C) 2015-2016 Free Software Foundation, Inc.
## Written by Dave Pitts, Simon Sobisch
## 
## This file is part of GnuCOBOL.
## 
## The GnuCOBOL compiler is free software: you can redistribute it
## and/or modify it under the terms of the GNU General Public License
## as published by the Free Software Foundation, either version 3 of the
## License, or (at your option) any later version.
## 
## GnuCOBOL is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
## GNU General Public License for more details.
## 
## You should have received a copy of the GNU General Public License
## along with GnuCOBOL.  If not, see <http://www.gnu.org/licenses/>.

### GnuCOBOL Test Suite

AT_SETUP([COPY within comment])
AT_KEYWORDS([listing])

AT_CAPTURE_FILE([prog.lst])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
      *COPY "copy.inc".
       PROCEDURE        DIVISION.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [], [])

AT_DATA([prog1.lst],
[GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006        *COPY "copy.inc".
000007         PROCEDURE        DIVISION.
000008             STOP RUN.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog1.lst prog.lis], [0], [], [])

AT_DATA([prog2.cob], [
  IDENTIFICATION   DIVISION.
  PROGRAM-ID.      prog2.
  DATA             DIVISION.
  WORKING-STORAGE  SECTION.
  *> COPY "copy.inc".
  PROCEDURE        DIVISION.
  STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -t prog.lst -free prog2.cob], [0], [], [])

AT_DATA([prog2.lst],
[GnuCOBOL V.R.P          prog2.cob            DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    .....................SOURCE.............................................

000001
000002    IDENTIFICATION   DIVISION.
000003    PROGRAM-ID.      prog2.
000004    DATA             DIVISION.
000005    WORKING-STORAGE  SECTION.
000006    *> COPY "copy.inc".
000007    PROCEDURE        DIVISION.
000008    STOP RUN.
GnuCOBOL V.R.P          prog2.cob            DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog2.lst prog.lis], [0], [], [])

AT_CLEANUP


AT_SETUP([COPY replacement order])
AT_KEYWORDS([listing])

AT_CAPTURE_FILE([prog.lst])

AT_DATA([copy.inc], [
       01 TEST-VAR PIC X(2) VALUE "OK".
])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       COPY "copy.inc"
          REPLACING ==TEST-VAR== BY ==FIRST-MATCH==
                    ==TEST-VAR== BY ==SECOND-MATCH==.
       PROCEDURE        DIVISION.
           DISPLAY FIRST-MATCH NO ADVANCING
           END-DISPLAY.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [], [])

AT_DATA([prog3.lst],
[GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         COPY "copy.inc"
000007            REPLACING ==TEST-VAR== BY ==FIRST-MATCH==
000008                      ==TEST-VAR== BY ==SECOND-MATCH==.
000001C
000002C        01 FIRST-MATCH PIC X(2) VALUE "OK".
000009         PROCEDURE        DIVISION.
000010             DISPLAY FIRST-MATCH NO ADVANCING
000011             END-DISPLAY.
000012             STOP RUN.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0002 ALPHANUMERIC   01   FIRST-MATCH                    X(2)

0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog3.lst prog.lis], [0], [], [])

AT_CHECK([$COBC $FLAGS -t prep.lst -E prog.cob && $COMPILE_ONLY -t prog.lst prog.i], [0], [], [])

AT_DATA([prog4.lst],
[GnuCOBOL V.R.P          prog.i               DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001  #line 1 "prog.cob"
000001
000002   IDENTIFICATION   DIVISION.
000003   PROGRAM-ID. prog.
000004   DATA DIVISION.
000005   WORKING-STORAGE SECTION.
000006
000007
000008
000001  #line 1 "copy.inc"
000001
000002   01 FIRST-MATCH PIC X(2) VALUE "OK".
000008  #line 8 "prog.cob"
000008
000009   PROCEDURE DIVISION.
000010   DISPLAY FIRST-MATCH NO ADVANCING
000011   END-DISPLAY.
000012   STOP RUN.
GnuCOBOL V.R.P          prog.i               DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0002 ALPHANUMERIC   01   FIRST-MATCH                    X(2)

0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog4.lst prog.lis], [0], [], [])

AT_CLEANUP


AT_SETUP([COPY separators])
AT_KEYWORDS([listing])

AT_CAPTURE_FILE([prog.lst])

AT_DATA([copy.inc], [
       01 TEST-VAR PIC X(2) VALUE "OK".                                  COPY001
])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.                                        PROG001
       PROGRAM-ID.      prog.                                            PROG002
       DATA             DIVISION.                                        PROG003
       WORKING-STORAGE  SECTION.                                         PROG004
       COPY "copy.inc"                                                   PROG005
          REPLACING ==TEST-VAR==, BY ==FIRST-MATCH==,                    PROG006
                 ,  ==TEST-VAR==; BY ==SECOND-MATCH==;                   PROG007
                 ;  ==TEST-VAR== , BY ==THIRD-MATCH==                    PROG008
                    ==TEST-VAR== ; BY ==FOURTH-MATCH==.                  PROG009
       PROCEDURE        DIVISION.                                        PROG010
           DISPLAY FIRST-MATCH NO ADVANCING                              PROG011
           END-DISPLAY.                                                  PROG012
           STOP RUN.                                                     PROG013
])

AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [], [])

AT_DATA([prog4.lst],
[GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         COPY "copy.inc"
000007            REPLACING ==TEST-VAR==, BY ==FIRST-MATCH==,
000008                   ,  ==TEST-VAR==; BY ==SECOND-MATCH==;
000009                   ;  ==TEST-VAR== , BY ==THIRD-MATCH==
000010                      ==TEST-VAR== ; BY ==FOURTH-MATCH==.
000001C
000002C        01 FIRST-MATCH PIC X(2) VALUE "OK".
000011         PROCEDURE        DIVISION.
000012             DISPLAY FIRST-MATCH NO ADVANCING
000013             END-DISPLAY.
000014             STOP RUN.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0002 ALPHANUMERIC   01   FIRST-MATCH                    X(2)

0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog4.lst prog.lis], [0], [], [])

AT_CLEANUP


AT_SETUP([COPY partial replacement])
AT_KEYWORDS([listing])

AT_CAPTURE_FILE([prog.lst])

AT_DATA([copy.inc], [
       01 :TEST:-VAR PIC X(2) VALUE "OK".
       01 (TEST)-VAR PIC X(2) VALUE "OK".
])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       COPY "copy.inc"
          REPLACING ==:TEST:== BY ==COLON==
                    ==(TEST)== BY ==PAREN==.
       PROCEDURE        DIVISION.
           DISPLAY COLON-VAR NO ADVANCING
           END-DISPLAY.
           DISPLAY PAREN-VAR NO ADVANCING
           END-DISPLAY.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [], [])

AT_DATA([prog5.lst],
[GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         COPY "copy.inc"
000007            REPLACING ==:TEST:== BY ==COLON==
000008                      ==(TEST)== BY ==PAREN==.
000001C
000002C        01 COLON PIC X(2) VALUE "OK".
000003C        01 PAREN PIC X(2) VALUE "OK".
000009         PROCEDURE        DIVISION.
000010             DISPLAY COLON-VAR NO ADVANCING
000011             END-DISPLAY.
000012             DISPLAY PAREN-VAR NO ADVANCING
000013             END-DISPLAY.
000014             STOP RUN.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0002 ALPHANUMERIC   01   COLON-VAR                      X(2)

0002 ALPHANUMERIC   01   PAREN-VAR                      X(2)

0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog5.lst prog.lis], [0], [], [])

AT_CLEANUP


AT_SETUP([COPY LEADING replacement])
AT_KEYWORDS([listing])

AT_CAPTURE_FILE([prog.lst])

AT_DATA([copy.inc], [
       01  TEST-VAR PIC X(2) VALUE "OK".
       01  NORM-VAR PIC X(2) VALUE "OK".
])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       COPY "copy.inc"
            REPLACING LEADING ==TEST== BY ==FIRST==
                      LEADING ==NORM== BY ==SECOND==.
       PROCEDURE        DIVISION.
           DISPLAY FIRST-VAR NO ADVANCING
           END-DISPLAY.
           DISPLAY SECOND-VAR NO ADVANCING
           END-DISPLAY.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [], [])

AT_DATA([progl.lst],
[GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         COPY "copy.inc"
000007              REPLACING LEADING ==TEST== BY ==FIRST==
000008                        LEADING ==NORM== BY ==SECOND==.
000001C
000002C        01 FIRST-VAR PIC X(2) VALUE "OK".
000003C        01 SECOND-VAR PIC X(2) VALUE "OK".
000009         PROCEDURE        DIVISION.
000010             DISPLAY FIRST-VAR NO ADVANCING
000011             END-DISPLAY.
000012             DISPLAY SECOND-VAR NO ADVANCING
000013             END-DISPLAY.
000014             STOP RUN.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0002 ALPHANUMERIC   01   FIRST-VAR                      X(2)

0002 ALPHANUMERIC   01   SECOND-VAR                     X(2)

0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff progl.lst prog.lis], [0], [], [])

AT_CLEANUP


AT_SETUP([COPY TRAILING replacement])
AT_KEYWORDS([listing])

AT_CAPTURE_FILE([prog.lst])

AT_DATA([copy.inc], [
       01  TEST-FIRST  PIC X(2) VALUE "OK".
       01  TEST-SECOND PIC X(2) VALUE "OK".
])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       COPY "copy.inc"
            REPLACING TRAILING ==FIRST== BY ==VAR1==
                      TRAILING ==SECOND== BY ==VAR2==.
       PROCEDURE        DIVISION.
           DISPLAY TEST-VAR1 NO ADVANCING
           END-DISPLAY.
           DISPLAY TEST-VAR2 NO ADVANCING
           END-DISPLAY.
           STOP RUN.
])


AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [], [])

AT_DATA([progr.lst],
[GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         COPY "copy.inc"
000007              REPLACING TRAILING ==FIRST== BY ==VAR1==
000008                        TRAILING ==SECOND== BY ==VAR2==.
000001C
000002C        01 TEST-VAR1 PIC X(2) VALUE "OK".
000003C        01 TEST-VAR2 PIC X(2) VALUE "OK".
000009         PROCEDURE        DIVISION.
000010             DISPLAY TEST-VAR1 NO ADVANCING
000011             END-DISPLAY.
000012             DISPLAY TEST-VAR2 NO ADVANCING
000013             END-DISPLAY.
000014             STOP RUN.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0002 ALPHANUMERIC   01   TEST-VAR1                      X(2)

0002 ALPHANUMERIC   01   TEST-VAR2                      X(2)

0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff progr.lst prog.lis], [0], [], [])

AT_CLEANUP


AT_SETUP([COPY recursive replacement])
AT_KEYWORDS([listing])

AT_CAPTURE_FILE([prog.lst])

AT_DATA([copy-2.inc], [
       01 TEST-VAR PIC X(2) VALUE "OK".
])

AT_DATA([copy-1.inc], [
       COPY "copy-2.inc".
])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       COPY "copy-1.inc"
           REPLACING ==TEST-VAR== BY ==COPY-VAR==.
       PROCEDURE        DIVISION.
           DISPLAY COPY-VAR NO ADVANCING
           END-DISPLAY.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [], [])

AT_DATA([prog6.lst],
[GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         COPY "copy-1.inc"
000007             REPLACING ==TEST-VAR== BY ==COPY-VAR==.
000001C
000002C        COPY "copy-2.inc".
000001C
000002C        01 COPY-VAR PIC X(2) VALUE "OK".
000008         PROCEDURE        DIVISION.
000009             DISPLAY COPY-VAR NO ADVANCING
000010             END-DISPLAY.
000011             STOP RUN.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0002 ALPHANUMERIC   01   COPY-VAR                       X(2)

0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog6.lst prog.lis], [0], [], [])

AT_CLEANUP


AT_SETUP([Eject page])
AT_KEYWORDS([listing])

AT_CAPTURE_FILE([prog.lst])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
      /
       PROCEDURE        DIVISION.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [], [])

AT_DATA([prog7.lst],
[GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0002

LINE    PG/LN  A...B............................................................

000006        /
000007         PROCEDURE        DIVISION.
000008             STOP RUN.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0003

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog7.lst prog.lis], [0], [], [])

AT_DATA([prog2.cob], [
  IDENTIFICATION   DIVISION.
  PROGRAM-ID.      prog2.
  DATA             DIVISION.
  WORKING-STORAGE  SECTION.
>>PAGE
  PROCEDURE        DIVISION.
  STOP RUN.
])


AT_CHECK([$COMPILE_ONLY -t prog.lst -free prog2.cob], [0], [], [])

AT_DATA([prog8.lst],
[GnuCOBOL V.R.P          prog2.cob            DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    .....................SOURCE.............................................

000001
000002    IDENTIFICATION   DIVISION.
000003    PROGRAM-ID.      prog2.
000004    DATA             DIVISION.
000005    WORKING-STORAGE  SECTION.
GnuCOBOL V.R.P          prog2.cob            DDD MMM dd HH:MM:SS YYYY  Page 0002

LINE    .....................SOURCE.............................................

000006  >>PAGE
000007    PROCEDURE        DIVISION.
000008    STOP RUN.
GnuCOBOL V.R.P          prog2.cob            DDD MMM dd HH:MM:SS YYYY  Page 0003

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog8.lst prog.lis], [0], [], [])

AT_DATA([prog3.cob], [
       IDENTIFICATION   DIVISION.
       
       PROGRAM-ID.      prog3.
       
       
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       77 WS-VAR PIC X(2).
      /
       77 WS-VA2 PIC X(2).
       
       
       LOCAL-STORAGE  SECTION.
       77 LS-VAR PIC 9(2).
       
       
       PROCEDURE        DIVISION.
       
           DISPLAY WS-VAR
           MOVE 99 TO LS-VAR
           
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -t prog.lst -tlines=0 prog3.cob], [0], [], [])

AT_DATA([prog9.lst],
[GnuCOBOL V.R.P          prog3.cob            DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003
000004         PROGRAM-ID.      prog3.
000005
000006
000007         DATA             DIVISION.
000008         WORKING-STORAGE  SECTION.
000009         77 WS-VAR PIC X(2).
GnuCOBOL V.R.P          prog3.cob            DDD MMM dd HH:MM:SS YYYY  Page 0002

LINE    PG/LN  A...B............................................................

000010        /
000011         77 WS-VA2 PIC X(2).
000012
000013
000014         LOCAL-STORAGE  SECTION.
000015         77 LS-VAR PIC 9(2).
000016
000017
000018         PROCEDURE        DIVISION.
000019
000020             DISPLAY WS-VAR
000021             MOVE 99 TO LS-VAR
000022
000023             STOP RUN.
GnuCOBOL V.R.P          prog3.cob            DDD MMM dd HH:MM:SS YYYY  Page 0003

SIZE TYPE           LVL  NAME                           PICTURE

0002 ALPHANUMERIC   77   WS-VAR                         X(2)
0002 ALPHANUMERIC   77   WS-VA2                         X(2)

0002 NUMERIC        77   LS-VAR                         9(2)

0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog9.lst prog.lis], [0], [], [])

AT_CHECK([$COMPILE_ONLY -t prog.lst -tlines=5 prog3.cob], [0], [], [])

AT_DATA([prog10.lst],
[GnuCOBOL V.R.P          prog3.cob            DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003
000004         PROGRAM-ID.      prog3.
000005
GnuCOBOL V.R.P          prog3.cob            DDD MMM dd HH:MM:SS YYYY  Page 0002

LINE    PG/LN  A...B............................................................

000006
000007         DATA             DIVISION.
000008         WORKING-STORAGE  SECTION.
000009         77 WS-VAR PIC X(2).
GnuCOBOL V.R.P          prog3.cob            DDD MMM dd HH:MM:SS YYYY  Page 0003

LINE    PG/LN  A...B............................................................

000010        /
000011         77 WS-VA2 PIC X(2).
000012
000013
000014         LOCAL-STORAGE  SECTION.
GnuCOBOL V.R.P          prog3.cob            DDD MMM dd HH:MM:SS YYYY  Page 0004

LINE    PG/LN  A...B............................................................

000015         77 LS-VAR PIC 9(2).
000016
000017
000018         PROCEDURE        DIVISION.
000019
GnuCOBOL V.R.P          prog3.cob            DDD MMM dd HH:MM:SS YYYY  Page 0005

LINE    PG/LN  A...B............................................................

000020             DISPLAY WS-VAR
000021             MOVE 99 TO LS-VAR
000022
000023             STOP RUN.
GnuCOBOL V.R.P          prog3.cob            DDD MMM dd HH:MM:SS YYYY  Page 0006

SIZE TYPE           LVL  NAME                           PICTURE

0002 ALPHANUMERIC   77   WS-VAR                         X(2)
0002 ALPHANUMERIC   77   WS-VA2                         X(2)

0002 NUMERIC        77   LS-VAR                         9(2)
GnuCOBOL V.R.P          prog3.cob            DDD MMM dd HH:MM:SS YYYY  Page 0007

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog10.lst prog.lis], [0], [], [])

AT_CLEANUP


AT_SETUP([Wide listing])
AT_KEYWORDS([listing])

AT_CAPTURE_FILE([prog.lst])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.                                        PROG001
       PROGRAM-ID.      prog.                                            PROG002
       DATA             DIVISION.                                        PROG003
       WORKING-STORAGE  SECTION.                                         PROG004
      /                                                                  PROG005
       PROCEDURE        DIVISION.                                        PROG006
           STOP RUN.                                                     PROG007
])

AT_CHECK([$COMPILE_ONLY -T prog.lst prog.cob], [0], [], [])

AT_DATA([prog9.lst],
[GnuCOBOL V.R.P          prog.cob                                                     DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................SEQUENCE

000001
000002         IDENTIFICATION   DIVISION.                                        PROG001
000003         PROGRAM-ID.      prog.                                            PROG002
000004         DATA             DIVISION.                                        PROG003
000005         WORKING-STORAGE  SECTION.                                         PROG004
GnuCOBOL V.R.P          prog.cob                                                     DDD MMM dd HH:MM:SS YYYY  Page 0002

LINE    PG/LN  A...B............................................................SEQUENCE

000006        /                                                                  PROG005
000007         PROCEDURE        DIVISION.                                        PROG006
000008             STOP RUN.                                                     PROG007
GnuCOBOL V.R.P          prog.cob                                                     DDD MMM dd HH:MM:SS YYYY  Page 0003

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog9.lst prog.lis], [0], [], [])

AT_DATA([prog2.cob], [
  IDENTIFICATION   DIVISION.
  PROGRAM-ID.      prog2.
  DATA             DIVISION.
  WORKING-STORAGE  SECTION.
  >>PAGE
  PROCEDURE        DIVISION.
  STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -T prog.lst -free prog2.cob], [0], [], [])

AT_DATA([prog10.lst],
[GnuCOBOL V.R.P          prog2.cob                                                    DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    .....................................................SOURCE.....................................................

000001
000002    IDENTIFICATION   DIVISION.
000003    PROGRAM-ID.      prog2.
000004    DATA             DIVISION.
000005    WORKING-STORAGE  SECTION.
GnuCOBOL V.R.P          prog2.cob                                                    DDD MMM dd HH:MM:SS YYYY  Page 0002

LINE    .....................................................SOURCE.....................................................

000006    >>PAGE
000007    PROCEDURE        DIVISION.
000008    STOP RUN.
GnuCOBOL V.R.P          prog2.cob                                                    DDD MMM dd HH:MM:SS YYYY  Page 0003

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog10.lst prog.lis], [0], [], [])

AT_CLEANUP


AT_SETUP([Two source files])
AT_KEYWORDS([listing])

AT_CAPTURE_FILE([prog.lst])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
      *COPY "copy.inc".
       PROCEDURE        DIVISION.
           STOP RUN.
])

AT_DATA([prog1.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
      *COPY "copy.inc".
       PROCEDURE        DIVISION.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob prog1.cob], [0], [], [])

AT_DATA([prog11.lst],
[GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006        *COPY "copy.inc".
000007         PROCEDURE        DIVISION.
000008             STOP RUN.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
0 Errors in program
GnuCOBOL V.R.P          prog1.cob            DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006        *COPY "copy.inc".
000007         PROCEDURE        DIVISION.
000008             STOP RUN.
GnuCOBOL V.R.P          prog1.cob            DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog11.lst prog.lis], [0], [], [])

AT_CLEANUP


AT_SETUP([Error/Warning messages])
AT_KEYWORDS([listing])

AT_CAPTURE_FILE([prog.lst])

AT_DATA([copy.inc], [
       01 TEST-VAR PIC X(2) VULUE "OK".
])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       COPY "copy.inc".
       PROCEDURE        DIVISION.
           DISPLAY FIRST-MATCH NO ADVANCING
           END-DISPLAY.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [1], [],
[copy.inc: 2: error: syntax error, unexpected Identifier, expecting EXTERNAL or GLOBAL
prog.cob: 8: error: 'FIRST-MATCH' is not defined
])

AT_DATA([prog12.lst],
[GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         COPY "copy.inc".
000001C
000002C        01 TEST-VAR PIC X(2) VULUE "OK".
error: syntax error, unexpected Identifier, expecting EXTERNAL or GLOBAL
000007         PROCEDURE        DIVISION.
000008             DISPLAY FIRST-MATCH NO ADVANCING
error: 'FIRST-MATCH' is not defined
000009             END-DISPLAY.
000010             STOP RUN.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
2 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog12.lst prog.lis], [0], [], [])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 TEST-VAR PIC X(2) VULUE "OK".
       PROCEDURE        DIVISION.
           DISPLAY FIRST-MATCH NO ADVANCING
           END-DISPLAY.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [1], [],
[prog.cob: 6: error: syntax error, unexpected Identifier, expecting EXTERNAL or GLOBAL
prog.cob: 8: error: 'FIRST-MATCH' is not defined
])

AT_DATA([prog13.lst],
[GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         01 TEST-VAR PIC X(2) VULUE "OK".
error: syntax error, unexpected Identifier, expecting EXTERNAL or GLOBAL
000007         PROCEDURE        DIVISION.
000008             DISPLAY FIRST-MATCH NO ADVANCING
error: 'FIRST-MATCH' is not defined
000009             END-DISPLAY.
000010             STOP RUN.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
2 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog13.lst prog.lis], [0], [], [])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 TEST-VAR PIC 9(2) VALUE 'F1F2'.
       PROCEDURE        DIVISION.
           DISPLAY TEST-VAR NO ADVANCING
           END-DISPLAY.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [],
[prog.cob: 6: warning: numeric value is expected
])

AT_DATA([prog14.lst],
[GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         01 TEST-VAR PIC 9(2) VALUE 'F1F2'.
warning: numeric value is expected
000007         PROCEDURE        DIVISION.
000008             DISPLAY TEST-VAR NO ADVANCING
000009             END-DISPLAY.
000010             STOP RUN.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0002 NUMERIC        01   TEST-VAR                       9(2)

1 Warning in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog14.lst prog.lis], [0], [], [])


AT_CHECK([$COMPILE_ONLY -t prog.lst crud.cob], [1], [],
[cobc: crud.cob: No such file or directory
])

AT_DATA([prog15.lst],
[GnuCOBOL V.R.P          crud.cob             DDD MMM dd HH:MM:SS YYYY  Page 0001
  
  
  
cobc: crud.cob: No such file or directory

0 Warnings in program
1 Error in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog15.lst prog.lis], [0], [], [])

AT_DATA([prog.cpy], [
       78  I   VALUE 20.
       78  J   VALUE 5000.
       78  M   VALUE 5.
])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 TEST-VAR PIC 9(2) VALUE 12.
       COPY 'prog.cpy'.
       PROCEDURE        DIVISION.
           DISPLAY TEST-VAR NO ADVANCING
           END-DISPLAY
           MOVE 'AA' TO TEST-VAR
           DISPLAY TEST-VAR NO ADVANCING
           END-DISPLAY
           STOP RUN.
])

AT_CHECK([$COBC $FLAGS -E prog.cob && $COMPILE_ONLY -t prog.lst prog.i], [0], [],
[prog.cob: 11: warning: numeric value is expected
prog.cob: 6: warning: 'TEST-VAR' defined here as PIC 9(2)
])

AT_DATA([prog17.lst],
[GnuCOBOL V.R.P          prog.i               DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001  #line 1 "prog.cob"
000001
000002   IDENTIFICATION   DIVISION.
000003   PROGRAM-ID. prog.
000004   DATA DIVISION.
000005   WORKING-STORAGE SECTION.
000006   01 TEST-VAR PIC 9(2) VALUE 12.
000007
000001  #line 1 "prog.cpy"
000001
000002   78 I VALUE 20.
000003   78 J VALUE 5000.
000004   78 M VALUE 5.
000007  #line 7 "prog.cob"
000007
000008   PROCEDURE DIVISION.
000009   DISPLAY TEST-VAR NO ADVANCING
000010   END-DISPLAY
000011   MOVE 'AA' TO TEST-VAR
warning: numeric value is expected
000012   DISPLAY TEST-VAR NO ADVANCING
000013   END-DISPLAY
000014   STOP RUN.
GnuCOBOL V.R.P          prog.i               DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0002 NUMERIC        01   TEST-VAR                       9(2)

1 Warning in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog17.lst prog.lis], [0], [], [])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 TEST-VAR PIC 9(2) VALUE 12.
       COPY 'CRUD.CPY'.
       PROCEDURE        DIVISION.
           DISPLAY TEST-VAR NO ADVANCING
           END-DISPLAY
           MOVE 'AA' TO TEST-VAR
           DISPLAY TEST-VAR NO ADVANCING
           END-DISPLAY
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [1], [],
[prog.cob: 7: error: CRUD.CPY: No such file or directory
prog.cob: 11: warning: numeric value is expected
prog.cob: 6: warning: 'TEST-VAR' defined here as PIC 9(2)
])

AT_DATA([prog16.lst],
[GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         01 TEST-VAR PIC 9(2) VALUE 12.
000007         COPY 'CRUD.CPY'.
error: CRUD.CPY: No such file or directory
000008         PROCEDURE        DIVISION.
000009             DISPLAY TEST-VAR NO ADVANCING
000010             END-DISPLAY
000011             MOVE 'AA' TO TEST-VAR
warning: numeric value is expected
000012             DISPLAY TEST-VAR NO ADVANCING
000013             END-DISPLAY
000014             STOP RUN.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0002 NUMERIC        01   TEST-VAR                       9(2)

1 Warning in program
1 Error in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog16.lst prog.lis], [0], [], [])

AT_CLEANUP


AT_SETUP([Symbols: simple])
AT_KEYWORDS([listing COMP])

AT_CAPTURE_FILE([prog.lst])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 WS-ONE    PIC 9(4) VALUE 37.
       01 WS-TWO    PIC A(4) VALUE 'HIGH'.
       01 WS-THREE  PIC X(4) VALUE 'BAR'.
       01 WS-FOUR            COMP-1 VALUE 37.
       01 WS-FIVE            COMP-2 VALUE 37.
       01 WS-SIX    PIC S999 COMP-3 VALUE -37.
       01 WS-SEVEN  PIC $$,$$$,$$9.99 VALUE ZERO.
       PROCEDURE        DIVISION.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [], [])

AT_DATA([prog15.lst],
[GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         01 WS-ONE    PIC 9(4) VALUE 37.
000007         01 WS-TWO    PIC A(4) VALUE 'HIGH'.
000008         01 WS-THREE  PIC X(4) VALUE 'BAR'.
000009         01 WS-FOUR            COMP-1 VALUE 37.
000010         01 WS-FIVE            COMP-2 VALUE 37.
000011         01 WS-SIX    PIC S999 COMP-3 VALUE -37.
000012         01 WS-SEVEN  PIC $$,$$$,$$9.99 VALUE ZERO.
000013         PROCEDURE        DIVISION.
000014             STOP RUN.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0004 NUMERIC        01   WS-ONE                         9(4)

0004 ALPHABETIC     01   WS-TWO                         A(4)

0004 ALPHANUMERIC   01   WS-THREE                       X(4)

0004 NUMERIC        01   WS-FOUR                        S9(7)V9(8) COMP-1

0008 NUMERIC        01   WS-FIVE                        S9(17)V9(17) COMP-2

0002 NUMERIC        01   WS-SIX                         S999 COMP-3

0013 NUMERIC        01   WS-SEVEN                       $$,$$$,$$9.99

0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog15.lst prog.lis], [0], [], [])

AT_DATA([prog2.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       LINKAGE          SECTION.
       01 WS-ONE    PIC 9(4).
       01 WS-TWO    PIC A(4).
       01 WS-THREE  PIC X(4).
       PROCEDURE        DIVISION.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -t prog.lst prog2.cob], [0], [], [])

AT_DATA([prog16.lst],
[GnuCOBOL V.R.P          prog2.cob            DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         LINKAGE          SECTION.
000006         01 WS-ONE    PIC 9(4).
000007         01 WS-TWO    PIC A(4).
000008         01 WS-THREE  PIC X(4).
000009         PROCEDURE        DIVISION.
000010             STOP RUN.
GnuCOBOL V.R.P          prog2.cob            DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE


0004 ALPHANUMERIC   01   WS-ONE                         9(4)

0004 ALPHANUMERIC   01   WS-TWO                         A(4)

0004 ALPHANUMERIC   01   WS-THREE                       X(4)

0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog16.lst prog.lis], [0], [], [])

AT_DATA([prog-1.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 WS-ONE    PIC 9(4) VALUE 37.
       01 WS-TWO    PIC A(4) VALUE 'HIGH'.
       01 WS-THREE  PIC X(4) VALUE 'BAR'.
       01 WS-FOUR            COMP-1 VALUE 37.
       01 WS-FIVE            COMP-2 VALUE 37.
       01 WS-SIX    PIC S999 COMP-3 VALUE -37.
       01 WS-SEVEN  PIC $$,$$$,$$9.99 VALUE ZERO.
       PROCEDURE        DIVISION.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY --no-symbols -t prog.lst prog-1.cob], [0], [], [])

AT_DATA([prog15-1.lst],
[GnuCOBOL V.R.P          prog-1.cob           DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         01 WS-ONE    PIC 9(4) VALUE 37.
000007         01 WS-TWO    PIC A(4) VALUE 'HIGH'.
000008         01 WS-THREE  PIC X(4) VALUE 'BAR'.
000009         01 WS-FOUR            COMP-1 VALUE 37.
000010         01 WS-FIVE            COMP-2 VALUE 37.
000011         01 WS-SIX    PIC S999 COMP-3 VALUE -37.
000012         01 WS-SEVEN  PIC $$,$$$,$$9.99 VALUE ZERO.
000013         PROCEDURE        DIVISION.
000014             STOP RUN.

0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog15-1.lst prog.lis], [0], [], [])

AT_CLEANUP


AT_SETUP([Symbols: pointer])
AT_KEYWORDS([listing])

AT_CAPTURE_FILE([prog.lst])

# Check for 32/64bit first
AT_DATA([P64.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      P64.
       DATA             DIVISION.
       PROCEDURE        DIVISION.
       >>IF P64 SET
           DISPLAY '64' WITH NO ADVANCING
           END-DISPLAY.
       >>END-IF
           STOP RUN.
])

AT_CHECK([$COMPILE P64.cob], [0], [], [])

AT_DATA([prog3.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       77  WS-Where           pic x(512).

       01  ws-mysql.
           02  ws-mysql-cid                        usage pointer.
           02  ws-mysql-result                     usage pointer.
           02  ws-mysql-result-2                   usage pointer.
           02  ws-mysql-result-3                   usage pointer.
           02  ws-mysql-count-rows                 pic s9(9) comp.
           02  ws-mysql-error-number               pic x(4).
           02  ws-mysql-error-message              pic x(80).
           02  ws-mysql-host-name                  pic x(64).
           02  ws-mysql-implementation             pic x(64).
           02  ws-mysql-password                   pic x(64).
           02  ws-mysql-base-name                  pic x(64).
           02  ws-mysql-port-number                pic x(4).
           02  ws-mysql-socket                     pic x(64).
           02  ws-mysql-command                    pic x(4096).

       01  ws-No-Paragraph pic 9(4).

       01  subscripts usage comp-5.
           12 J                    pic s9(4).
           12 K                    pic s9(4).
           12 L                    pic s9(4).

       SCREEN           SECTION.
       01  Display-Message-1 foreground-color 2.
           03  value "WS-Where=" line 23 col  1.
           03  from WS-Where (1:J) pic x(69) col 10.
       01  Display-Message-2 foreground-color 2.
           03  value "ST004 SQL Err No.=" line 4 col  1. 
           03  using ws-mysql-error-number pic x(4) col 19.
           03  value " Para=" col 23.
           03  using WS-No-Paragraph pic 9(3) col 29.
           03  value " SQL Cmd=" col 32.
           03  using ws-mysql-command pic x(199) col 41.
           03  value "SQL Err Msg=" line 7 col  1.   
           03  using ws-mysql-error-message pic x(67) col 13.
       PROCEDURE        DIVISION.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -t prog.lst prog3.cob], [0], [], [])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])

AT_CHECK([./P64], [0], [64], [],

# Previous test "failed" --> P64 did not show '64' --> 32 bit

AT_DATA([prog17-32.lst],
[GnuCOBOL V.R.P          prog3.cob            DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         77  WS-Where           pic x(512).
000007
000008         01  ws-mysql.
000009             02  ws-mysql-cid                        usage pointer.
000010             02  ws-mysql-result                     usage pointer.
000011             02  ws-mysql-result-2                   usage pointer.
000012             02  ws-mysql-result-3                   usage pointer.
000013             02  ws-mysql-count-rows                 pic s9(9) comp.
000014             02  ws-mysql-error-number               pic x(4).
000015             02  ws-mysql-error-message              pic x(80).
000016             02  ws-mysql-host-name                  pic x(64).
000017             02  ws-mysql-implementation             pic x(64).
000018             02  ws-mysql-password                   pic x(64).
000019             02  ws-mysql-base-name                  pic x(64).
000020             02  ws-mysql-port-number                pic x(4).
000021             02  ws-mysql-socket                     pic x(64).
000022             02  ws-mysql-command                    pic x(4096).
000023
000024         01  ws-No-Paragraph pic 9(4).
000025
000026         01  subscripts usage comp-5.
000027             12 J                    pic s9(4).
000028             12 K                    pic s9(4).
000029             12 L                    pic s9(4).
000030
000031         SCREEN           SECTION.
000032         01  Display-Message-1 foreground-color 2.
000033             03  value "WS-Where=" line 23 col  1.
000034             03  from WS-Where (1:J) pic x(69) col 10.
000035         01  Display-Message-2 foreground-color 2.
000036             03  value "ST004 SQL Err No.=" line 4 col  1.
000037             03  using ws-mysql-error-number pic x(4) col 19.
000038             03  value " Para=" col 23.
000039             03  using WS-No-Paragraph pic 9(3) col 29.
000040             03  value " SQL Cmd=" col 32.
000041             03  using ws-mysql-command pic x(199) col 41.
000042             03  value "SQL Err Msg=" line 7 col  1.
000043             03  using ws-mysql-error-message pic x(67) col 13.
000044         PROCEDURE        DIVISION.
000045             STOP RUN.
GnuCOBOL V.R.P          prog3.cob            DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0512 ALPHANUMERIC   77   WS-Where                       X(512)

4524 GROUP          01   ws-mysql
0004 POINTER        02     ws-mysql-cid
0004 POINTER        02     ws-mysql-result
0004 POINTER        02     ws-mysql-result-2
0004 POINTER        02     ws-mysql-result-3
0004 NUMERIC        02     ws-mysql-count-rows          S9(9) COMP
0004 ALPHANUMERIC   02     ws-mysql-error-number        X(4)
0080 ALPHANUMERIC   02     ws-mysql-error-message       X(80)
0064 ALPHANUMERIC   02     ws-mysql-host-name           X(64)
0064 ALPHANUMERIC   02     ws-mysql-implementation      X(64)
0064 ALPHANUMERIC   02     ws-mysql-password            X(64)
0064 ALPHANUMERIC   02     ws-mysql-base-name           X(64)
0004 ALPHANUMERIC   02     ws-mysql-port-number         X(4)
0064 ALPHANUMERIC   02     ws-mysql-socket              X(64)
4096 ALPHANUMERIC   02     ws-mysql-command             X(4096)

0004 ALPHANUMERIC   01   ws-No-Paragraph                9(4)

0006 GROUP          01   subscripts
0002 NUMERIC        12     J                            S9(4) COMP-5
0002 NUMERIC        12     K                            S9(4) COMP-5
0002 NUMERIC        12     L                            S9(4) COMP-5

0078 GROUP          01   Display-Message-1
0009 ALPHANUMERIC   03     FILLER                       X(9)
0069 ALPHANUMERIC   03     FILLER                       X(69)

0318 GROUP          01   Display-Message-2
0018 ALPHANUMERIC   03     FILLER                       X(18)
0004 ALPHANUMERIC   03     FILLER                       X(4)
0006 ALPHANUMERIC   03     FILLER                       X(6)
0003 ALPHANUMERIC   03     FILLER                       9(3)
0009 ALPHANUMERIC   03     FILLER                       X(9)
0199 ALPHANUMERIC   03     FILLER                       X(199)
0012 ALPHANUMERIC   03     FILLER                       X(12)
0067 ALPHANUMERIC   03     FILLER                       X(67)

0 Warnings in program
0 Errors in program
])

[AT_CHECK([diff prog17-32.lst prog.lis], [0], [], [])]

,

# Previous test "passed" --> P64 showed '64' --> 64 bit

AT_DATA([prog17-64.lst],
[GnuCOBOL V.R.P          prog3.cob            DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         77  WS-Where           pic x(512).
000007
000008         01  ws-mysql.
000009             02  ws-mysql-cid                        usage pointer.
000010             02  ws-mysql-result                     usage pointer.
000011             02  ws-mysql-result-2                   usage pointer.
000012             02  ws-mysql-result-3                   usage pointer.
000013             02  ws-mysql-count-rows                 pic s9(9) comp.
000014             02  ws-mysql-error-number               pic x(4).
000015             02  ws-mysql-error-message              pic x(80).
000016             02  ws-mysql-host-name                  pic x(64).
000017             02  ws-mysql-implementation             pic x(64).
000018             02  ws-mysql-password                   pic x(64).
000019             02  ws-mysql-base-name                  pic x(64).
000020             02  ws-mysql-port-number                pic x(4).
000021             02  ws-mysql-socket                     pic x(64).
000022             02  ws-mysql-command                    pic x(4096).
000023
000024         01  ws-No-Paragraph pic 9(4).
000025
000026         01  subscripts usage comp-5.
000027             12 J                    pic s9(4).
000028             12 K                    pic s9(4).
000029             12 L                    pic s9(4).
000030
000031         SCREEN           SECTION.
000032         01  Display-Message-1 foreground-color 2.
000033             03  value "WS-Where=" line 23 col  1.
000034             03  from WS-Where (1:J) pic x(69) col 10.
000035         01  Display-Message-2 foreground-color 2.
000036             03  value "ST004 SQL Err No.=" line 4 col  1.
000037             03  using ws-mysql-error-number pic x(4) col 19.
000038             03  value " Para=" col 23.
000039             03  using WS-No-Paragraph pic 9(3) col 29.
000040             03  value " SQL Cmd=" col 32.
000041             03  using ws-mysql-command pic x(199) col 41.
000042             03  value "SQL Err Msg=" line 7 col  1.
000043             03  using ws-mysql-error-message pic x(67) col 13.
000044         PROCEDURE        DIVISION.
000045             STOP RUN.
GnuCOBOL V.R.P          prog3.cob            DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0512 ALPHANUMERIC   77   WS-Where                       X(512)

4540 GROUP          01   ws-mysql
0008 POINTER        02     ws-mysql-cid
0008 POINTER        02     ws-mysql-result
0008 POINTER        02     ws-mysql-result-2
0008 POINTER        02     ws-mysql-result-3
0004 NUMERIC        02     ws-mysql-count-rows          S9(9) COMP
0004 ALPHANUMERIC   02     ws-mysql-error-number        X(4)
0080 ALPHANUMERIC   02     ws-mysql-error-message       X(80)
0064 ALPHANUMERIC   02     ws-mysql-host-name           X(64)
0064 ALPHANUMERIC   02     ws-mysql-implementation      X(64)
0064 ALPHANUMERIC   02     ws-mysql-password            X(64)
0064 ALPHANUMERIC   02     ws-mysql-base-name           X(64)
0004 ALPHANUMERIC   02     ws-mysql-port-number         X(4)
0064 ALPHANUMERIC   02     ws-mysql-socket              X(64)
4096 ALPHANUMERIC   02     ws-mysql-command             X(4096)

0004 ALPHANUMERIC   01   ws-No-Paragraph                9(4)

0006 GROUP          01   subscripts
0002 NUMERIC        12     J                            S9(4) COMP-5
0002 NUMERIC        12     K                            S9(4) COMP-5
0002 NUMERIC        12     L                            S9(4) COMP-5

0078 GROUP          01   Display-Message-1
0009 ALPHANUMERIC   03     FILLER                       X(9)
0069 ALPHANUMERIC   03     FILLER                       X(69)

0318 GROUP          01   Display-Message-2
0018 ALPHANUMERIC   03     FILLER                       X(18)
0004 ALPHANUMERIC   03     FILLER                       X(4)
0006 ALPHANUMERIC   03     FILLER                       X(6)
0003 ALPHANUMERIC   03     FILLER                       9(3)
0009 ALPHANUMERIC   03     FILLER                       X(9)
0199 ALPHANUMERIC   03     FILLER                       X(199)
0012 ALPHANUMERIC   03     FILLER                       X(12)
0067 ALPHANUMERIC   03     FILLER                       X(67)

0 Warnings in program
0 Errors in program
])

[AT_CHECK([diff prog17-64.lst prog.lis], [0], [], [])]

)


AT_CLEANUP


AT_SETUP([Symbols: mutliple programs/functions])
AT_KEYWORDS([listing program function])

AT_CAPTURE_FILE([prog.lst])

AT_DATA([prog4.cob], [
       IDENTIFICATION   DIVISION.
       FUNCTION-ID.     WITHPAR.
       DATA             DIVISION.
       LINKAGE          SECTION.
       01 PAR-IN        PIC 9.
       01 PAR-OUT       PIC 9.
       PROCEDURE DIVISION USING PAR-IN RETURNING PAR-OUT.
           ADD 1 TO PAR-IN GIVING PAR-OUT END-ADD.
           GOBACK.
       END FUNCTION WITHPAR.

       IDENTIFICATION   DIVISION.
       FUNCTION-ID.     WITHOUTPAR.
       DATA             DIVISION.
       LINKAGE          SECTION.
       01 PAR           PIC 9.
       PROCEDURE DIVISION RETURNING PAR.
           MOVE 1 TO PAR.
           GOBACK.
       END FUNCTION WITHOUTPAR.

       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT      DIVISION.
       CONFIGURATION    SECTION.
       REPOSITORY.
           FUNCTION     WITHPAR
           FUNCTION     WITHOUTPAR.
       PROCEDURE        DIVISION.
           IF WITHPAR(1) NOT = 2
              DISPLAY WITHPAR(1)
              END-DISPLAY
           END-IF.
           IF WITHOUTPAR NOT = 1
              DISPLAY WITHOUTPAR
              END-DISPLAY
           END-IF.
           STOP RUN.
       END PROGRAM prog.
])

AT_CHECK([$COMPILE_ONLY -t prog.lst prog4.cob], [0], [], [])

AT_DATA([prog18.lst],
[GnuCOBOL V.R.P          prog4.cob            DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         FUNCTION-ID.     WITHPAR.
000004         DATA             DIVISION.
000005         LINKAGE          SECTION.
000006         01 PAR-IN        PIC 9.
000007         01 PAR-OUT       PIC 9.
000008         PROCEDURE DIVISION USING PAR-IN RETURNING PAR-OUT.
000009             ADD 1 TO PAR-IN GIVING PAR-OUT END-ADD.
000010             GOBACK.
000011         END FUNCTION WITHPAR.
000012
000013         IDENTIFICATION   DIVISION.
000014         FUNCTION-ID.     WITHOUTPAR.
000015         DATA             DIVISION.
000016         LINKAGE          SECTION.
000017         01 PAR           PIC 9.
000018         PROCEDURE DIVISION RETURNING PAR.
000019             MOVE 1 TO PAR.
000020             GOBACK.
000021         END FUNCTION WITHOUTPAR.
000022
000023         IDENTIFICATION   DIVISION.
000024         PROGRAM-ID.      prog.
000025         ENVIRONMENT      DIVISION.
000026         CONFIGURATION    SECTION.
000027         REPOSITORY.
000028             FUNCTION     WITHPAR
000029             FUNCTION     WITHOUTPAR.
000030         PROCEDURE        DIVISION.
000031             IF WITHPAR(1) NOT = 2
000032                DISPLAY WITHPAR(1)
000033                END-DISPLAY
000034             END-IF.
000035             IF WITHOUTPAR NOT = 1
000036                DISPLAY WITHOUTPAR
000037                END-DISPLAY
000038             END-IF.
000039             STOP RUN.
000040         END PROGRAM prog.
GnuCOBOL V.R.P          prog4.cob            DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

     PROGRAM             prog

     FUNCTION            WITHOUTPAR

0001 NUMERIC        01   PAR                            9

     FUNCTION            WITHPAR

0001 NUMERIC        01   PAR-IN                         9

0001 NUMERIC        01   PAR-OUT                        9

0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog18.lst prog.lis], [0], [], [])

AT_CLEANUP


AT_SETUP([Symbols: OCCURS/REDEFINES])
AT_KEYWORDS([listing])

AT_CAPTURE_FILE([prog.lst])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       78  I   VALUE 20.
       78  J   VALUE 5000.
       78  M   VALUE 5.
       01  SETUP-REC.
           05  FL1       PIC X(04).
           05  FL2       PIC ZZZZZ.
           05  FL3       PIC 9(04).
           05  FL4       PIC 9(08) COMP.
           05  FL5       PIC 9(04) COMP-4.
           05  FL6       PIC Z,ZZZ.99.
           05  FL7       PIC S9(05) SIGN LEADING SEPARATE.
           05  FL8       PIC X(04).
           05  FL9 REDEFINES FL8 PIC 9(04).
           05  FLA.
               10  FLB OCCURS I TIMES.
                   15  FLC PIC X(02).
               10  FLD   PIC X(20).
           05  FLD1      PIC X(100).
           05  FLD2 OCCURS M TO J TIMES DEPENDING ON FL5.
               10  FILLER PIC X(01).
           05  FLD3      PIC X(3).
           05  FLD4      PIC X(4).
       PROCEDURE        DIVISION.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -std=mf -t prog.lst prog.cob], [0], [], [])

AT_DATA([prog19.lst],
[GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         ENVIRONMENT DIVISION.
000005         CONFIGURATION SECTION.
000006         DATA             DIVISION.
000007         WORKING-STORAGE  SECTION.
000008         78  I   VALUE 20.
000009         78  J   VALUE 5000.
000010         78  M   VALUE 5.
000011         01  SETUP-REC.
000012             05  FL1       PIC X(04).
000013             05  FL2       PIC ZZZZZ.
000014             05  FL3       PIC 9(04).
000015             05  FL4       PIC 9(08) COMP.
000016             05  FL5       PIC 9(04) COMP-4.
000017             05  FL6       PIC Z,ZZZ.99.
000018             05  FL7       PIC S9(05) SIGN LEADING SEPARATE.
000019             05  FL8       PIC X(04).
000020             05  FL9 REDEFINES FL8 PIC 9(04).
000021             05  FLA.
000022                 10  FLB OCCURS I TIMES.
000023                     15  FLC PIC X(02).
000024                 10  FLD   PIC X(20).
000025             05  FLD1      PIC X(100).
000026             05  FLD2 OCCURS M TO J TIMES DEPENDING ON FL5.
000027                 10  FILLER PIC X(01).
000028             05  FLD3      PIC X(3).
000029             05  FLD4      PIC X(4).
000030         PROCEDURE        DIVISION.
000031             STOP RUN.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

5204 GROUP          01   SETUP-REC
0004 ALPHANUMERIC   05     FL1                          X(04)
0005 ALPHANUMERIC   05     FL2                          ZZZZZ
0004 ALPHANUMERIC   05     FL3                          9(04)
0004 NUMERIC        05     FL4                          9(08) COMP
0002 NUMERIC        05     FL5                          9(04) COMP
0008 ALPHANUMERIC   05     FL6                          Z,ZZZ.99
0006 ALPHANUMERIC   05     FL7                          S9(05)
0004 ALPHANUMERIC   05     FL8                          X(04)
0004 ALPHANUMERIC-R 05     FL9                          9(04)
0060 ALPHANUMERIC   05     FLA
0040 ALPHANUMERIC   10       FLB                        OCCURS 20
0002 ALPHANUMERIC   15         FLC                      X(02)
0020 ALPHANUMERIC   10       FLD                        X(20)
0100 ALPHANUMERIC   05     FLD1                         X(100)
5000 ALPHANUMERIC   05     FLD2                         OCCURS 5 TO 5000
0001 ALPHANUMERIC   10       FILLER                     X(01)
0003 ALPHANUMERIC   05     FLD3                         X(3)
0004 ALPHANUMERIC   05     FLD4                         X(4)

0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog19.lst prog.lis], [0], [], [])

AT_CLEANUP


AT_SETUP([Conditional compilation])
AT_KEYWORDS([listing])

AT_CAPTURE_FILE([prog.lst])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       PROCEDURE        DIVISION.
       >>IF ACTIVATE DEFINED
           DISPLAY "NOTOK" NO ADVANCING
           END-DISPLAY
       >>ELIF ACTIVATE2 DEFINED
           DISPLAY "OK" NO ADVANCING
           END-DISPLAY
       >>ELSE
           DISPLAY "NOTOK" NO ADVANCING
           END-DISPLAY
       >>END-IF
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -DACTIVATE2 -t prog.lst prog.cob], [0], [], [])

AT_DATA([prog16.lst],
[GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         PROCEDURE        DIVISION.
000007         >>IF ACTIVATE DEFINED
000008X            DISPLAY "NOTOK" NO ADVANCING
000009X            END-DISPLAY
000010         >>ELIF ACTIVATE2 DEFINED
000011             DISPLAY "OK" NO ADVANCING
000012             END-DISPLAY
000013         >>ELSE
000014X            DISPLAY "NOTOK" NO ADVANCING
000015X            END-DISPLAY
000016         >>END-IF
000017             STOP RUN.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog16.lst prog.lis], [0], [], [])

AT_CLEANUP


AT_SETUP([LISTING ON/OFF])
AT_KEYWORDS([listing])

AT_CAPTURE_FILE([prog.lst])

AT_DATA([copy.inc], [
       >>LISTING OFF
       01 TEST1-VAR PIC X(2) VALUE "OK".
       01 TEST2-VAR PIC X(2) VALUE "OK".
       01 TEST3-VAR PIC X(2) VALUE "OK".
       01 TEST4-VAR PIC X(2) VALUE "OK".
       >>LISTING ON
       01 TEST5-VAR PIC X(2) VALUE "OK".
       01 TEST6-VAR PIC X(2) VALUE "OK".
       01 TEST7-VAR PIC X(2) VALUE "OK".
       01 TEST8-VAR PIC X(2) VALUE "OK".
])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       COPY "copy.inc".
       PROCEDURE        DIVISION.
           DISPLAY TEST1-VAR NO ADVANCING
           END-DISPLAY.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [], [])

AT_DATA([prog17.lst],
[GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         COPY "copy.inc".
000001C
000002C        >>LISTING OFF
000007C        >>LISTING ON
000008C        01 TEST5-VAR PIC X(2) VALUE "OK".
000009C        01 TEST6-VAR PIC X(2) VALUE "OK".
000010C        01 TEST7-VAR PIC X(2) VALUE "OK".
000011C        01 TEST8-VAR PIC X(2) VALUE "OK".
000007         PROCEDURE        DIVISION.
000008             DISPLAY TEST1-VAR NO ADVANCING
000009             END-DISPLAY.
000010             STOP RUN.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0002 ALPHANUMERIC   01   TEST1-VAR                      X(2)

0002 ALPHANUMERIC   01   TEST2-VAR                      X(2)

0002 ALPHANUMERIC   01   TEST3-VAR                      X(2)

0002 ALPHANUMERIC   01   TEST4-VAR                      X(2)

0002 ALPHANUMERIC   01   TEST5-VAR                      X(2)

0002 ALPHANUMERIC   01   TEST6-VAR                      X(2)

0002 ALPHANUMERIC   01   TEST7-VAR                      X(2)

0002 ALPHANUMERIC   01   TEST8-VAR                      X(2)

0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog17.lst prog.lis], [0], [], [])

AT_CLEANUP


AT_SETUP([File descriptions])
AT_KEYWORDS([listing])

AT_CAPTURE_FILE([prog.lst])

AT_DATA([prog.cob], [
       IDENTIFICATION DIVISION.
       PROGRAM-ID. prog.
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT OLD-VERSION  ASSIGN TO "SYSUT1"
                               ORGANIZATION LINE SEQUENTIAL.
           SELECT NEW-VERSION  ASSIGN TO "SYSUT2"
                               ORGANIZATION LINE SEQUENTIAL.
           SELECT PRT-VERSION  ASSIGN TO "SYSUT2"
                               ORGANIZATION LINE SEQUENTIAL.
           SELECT MODIFICATION ASSIGN TO "SYSIN1"
                               ORGANIZATION LINE SEQUENTIAL.
           SELECT COMMENTARY   ASSIGN TO "SYSOU1"
                               ORGANIZATION LINE SEQUENTIAL.
       DATA DIVISION.
       FILE SECTION.

       FD  OLD-VERSION
           LABEL RECORDS ARE STANDARD
           BLOCK CONTAINS 80 CHARACTERS
           DATA RECORD IS OLD-RECORD.

       01  OLD-RECORD.
           02 OLD-STATEMENT       PICTURE X(75).
           02 OLD-NUMBER          PICTURE X(5).

       FD  NEW-VERSION
           LABEL RECORDS ARE STANDARD
           BLOCK CONTAINS 80 CHARACTERS
           DATA RECORD IS NEW-RECORD.

       01  NEW-RECORD.
           02 NEW-STATEMENT       PICTURE X(75).
           02 NEW-NUMBER          PICTURE X(5).

       FD  MODIFICATION
           LABEL RECORDS ARE OMITTED
           BLOCK CONTAINS 80 CHARACTERS
           DATA RECORD IS UPDATE-ORDER.

       01  UPDATE-ORDER.
           02 INSERTION.
              03 COMMAND          PICTURE X(6).
                 88 ENDJOB        VALUE "ENDJOB".
                 88 ENDSET        VALUE "ENDSET".
                 88 REMOVE        VALUE "REMOVE".
                 88 ADDNEW        VALUE "INSERT".
                 88 CHANGE        VALUE "CHANGE".
                 88 DISPLY        VALUE "DISPLY".
              03 FILLER           PICTURE X.
              03 A-FIELD          PICTURE 9(5).
              03 A-ALPHA REDEFINES A-FIELD    PICTURE X(5).
                 88 A-BLANK       VALUE SPACES.
              03 FILLER           PICTURE X(4).
              03 B-FIELD          PICTURE 9(5).
              03 B-ALPHA REDEFINES B-FIELD    PICTURE X(5).
                 88 B-BLANK       VALUE SPACES.
              03 FILLER           PICTURE X(54).
           02 FILLER              PICTURE X(5).

       FD  COMMENTARY
           LABEL RECORDS ARE OMITTED
           BLOCK CONTAINS 82 CHARACTERS
           DATA RECORD IS COMMENT-LINE.

       01  COMMENT-LINE.
           02 FILLER              PICTURE X(82).

       WORKING-STORAGE  SECTION.

       01  HEADINGS-LINE.
           02 FILLER              PICTURE X(15) VALUE "EDITOR VERSION".
           02 FILLER              PICTURE X(20) VALUE "1.1 - 206/72".
           02 PHASE               PICTURE X(17) VALUE "UPDATING AS OF".
           02 MONTH-RUN           PICTURE XX.
           02 FILLER              PICTURE X VALUE "/".
           02 DAY-RUN             PICTURE XX.
           02 FILLER              PICTURE X VALUE "/".
           02 YEAR-RUN            PICTURE XX.
           02 FILLER              PICTURE X(8) VALUE SPACES.
           02 FILLER              PICTURE X(8) VALUE "  PAGE: ".
           02 PAGE-NUMBER         PICTURE 9(4) VALUE 0.

       01  COMMAND-LISTING.
           02 FILLER              PICTURE X(2) VALUE SPACES.
           02 COMMAND-IMAGE       PICTURE X(80).

       01  ACTIVITIES-LISTING.
           02 DISPOSITION         PICTURE X(2).
           02 ACTIVE-IMAGE        PICTURE X(80).

       01  UPSI-BYTE.
           02 UPSI-BIT OCCURS 8 TIMES  PICTURE X.

       01  MESSAGE-LOG.
           02 FILLER              PICTURE X(2) VALUE SPACES.
           02 MESSAGE-TEXT        PICTURE X(80).

       01  DISPLAY-MESSAGE.
           02 FILLER              PICTURE X(2) VALUE SPACES.
           02 DISPLAY-TEMP        PICTURE X(6).
           02 FILLER              PICTURE X(2) VALUE SPACES.
           02 DISPLAY-TEXT        PICTURE X(60).

       PROCEDURE DIVISION.
           OPEN INPUT OLD-VERSION, MODIFICATION,
                OUTPUT NEW-VERSION, COMMENTARY.
           CLOSE OLD-VERSION, NEW-VERSION, MODIFICATION, COMMENTARY.
           STOP RUN.
])

AT_CHECK([$COMPILE_ONLY -t prog.lst -tlines=0 prog.cob], [0], [],
[prog.cob: 21: warning: LABEL RECORDS is obsolete in GnuCOBOL
prog.cob: 23: warning: DATA RECORDS is obsolete in GnuCOBOL
prog.cob: 30: warning: LABEL RECORDS is obsolete in GnuCOBOL
prog.cob: 32: warning: DATA RECORDS is obsolete in GnuCOBOL
prog.cob: 39: warning: LABEL RECORDS is obsolete in GnuCOBOL
prog.cob: 41: warning: DATA RECORDS is obsolete in GnuCOBOL
prog.cob: 64: warning: LABEL RECORDS is obsolete in GnuCOBOL
prog.cob: 66: warning: DATA RECORDS is obsolete in GnuCOBOL
])


AT_DATA([prog18.lst],
[GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION DIVISION.
000003         PROGRAM-ID. prog.
000004         ENVIRONMENT DIVISION.
000005         INPUT-OUTPUT SECTION.
000006         FILE-CONTROL.
000007             SELECT OLD-VERSION  ASSIGN TO "SYSUT1"
000008                                 ORGANIZATION LINE SEQUENTIAL.
000009             SELECT NEW-VERSION  ASSIGN TO "SYSUT2"
000010                                 ORGANIZATION LINE SEQUENTIAL.
000011             SELECT PRT-VERSION  ASSIGN TO "SYSUT2"
000012                                 ORGANIZATION LINE SEQUENTIAL.
000013             SELECT MODIFICATION ASSIGN TO "SYSIN1"
000014                                 ORGANIZATION LINE SEQUENTIAL.
000015             SELECT COMMENTARY   ASSIGN TO "SYSOU1"
000016                                 ORGANIZATION LINE SEQUENTIAL.
000017         DATA DIVISION.
000018         FILE SECTION.
000019
000020         FD  OLD-VERSION
000021             LABEL RECORDS ARE STANDARD
warning: LABEL RECORDS is obsolete in GnuCOBOL
000022             BLOCK CONTAINS 80 CHARACTERS
000023             DATA RECORD IS OLD-RECORD.
warning: DATA RECORDS is obsolete in GnuCOBOL
000024
000025         01  OLD-RECORD.
000026             02 OLD-STATEMENT       PICTURE X(75).
000027             02 OLD-NUMBER          PICTURE X(5).
000028
000029         FD  NEW-VERSION
000030             LABEL RECORDS ARE STANDARD
warning: LABEL RECORDS is obsolete in GnuCOBOL
000031             BLOCK CONTAINS 80 CHARACTERS
000032             DATA RECORD IS NEW-RECORD.
warning: DATA RECORDS is obsolete in GnuCOBOL
000033
000034         01  NEW-RECORD.
000035             02 NEW-STATEMENT       PICTURE X(75).
000036             02 NEW-NUMBER          PICTURE X(5).
000037
000038         FD  MODIFICATION
000039             LABEL RECORDS ARE OMITTED
warning: LABEL RECORDS is obsolete in GnuCOBOL
000040             BLOCK CONTAINS 80 CHARACTERS
000041             DATA RECORD IS UPDATE-ORDER.
warning: DATA RECORDS is obsolete in GnuCOBOL
000042
000043         01  UPDATE-ORDER.
000044             02 INSERTION.
000045                03 COMMAND          PICTURE X(6).
000046                   88 ENDJOB        VALUE "ENDJOB".
000047                   88 ENDSET        VALUE "ENDSET".
000048                   88 REMOVE        VALUE "REMOVE".
000049                   88 ADDNEW        VALUE "INSERT".
000050                   88 CHANGE        VALUE "CHANGE".
000051                   88 DISPLY        VALUE "DISPLY".
000052                03 FILLER           PICTURE X.
000053                03 A-FIELD          PICTURE 9(5).
000054                03 A-ALPHA REDEFINES A-FIELD    PICTURE X(5).
000055                   88 A-BLANK       VALUE SPACES.
000056                03 FILLER           PICTURE X(4).
000057                03 B-FIELD          PICTURE 9(5).
000058                03 B-ALPHA REDEFINES B-FIELD    PICTURE X(5).
000059                   88 B-BLANK       VALUE SPACES.
000060                03 FILLER           PICTURE X(54).
000061             02 FILLER              PICTURE X(5).
000062
000063         FD  COMMENTARY
000064             LABEL RECORDS ARE OMITTED
warning: LABEL RECORDS is obsolete in GnuCOBOL
000065             BLOCK CONTAINS 82 CHARACTERS
000066             DATA RECORD IS COMMENT-LINE.
warning: DATA RECORDS is obsolete in GnuCOBOL
000067
000068         01  COMMENT-LINE.
000069             02 FILLER              PICTURE X(82).
000070
000071         WORKING-STORAGE  SECTION.
000072
000073         01  HEADINGS-LINE.
000074             02 FILLER              PICTURE X(15) VALUE "EDITOR VERSION".
000075             02 FILLER              PICTURE X(20) VALUE "1.1 - 206/72".
000076             02 PHASE               PICTURE X(17) VALUE "UPDATING AS OF".
000077             02 MONTH-RUN           PICTURE XX.
000078             02 FILLER              PICTURE X VALUE "/".
000079             02 DAY-RUN             PICTURE XX.
000080             02 FILLER              PICTURE X VALUE "/".
000081             02 YEAR-RUN            PICTURE XX.
000082             02 FILLER              PICTURE X(8) VALUE SPACES.
000083             02 FILLER              PICTURE X(8) VALUE "  PAGE: ".
000084             02 PAGE-NUMBER         PICTURE 9(4) VALUE 0.
000085
000086         01  COMMAND-LISTING.
000087             02 FILLER              PICTURE X(2) VALUE SPACES.
000088             02 COMMAND-IMAGE       PICTURE X(80).
000089
000090         01  ACTIVITIES-LISTING.
000091             02 DISPOSITION         PICTURE X(2).
000092             02 ACTIVE-IMAGE        PICTURE X(80).
000093
000094         01  UPSI-BYTE.
000095             02 UPSI-BIT OCCURS 8 TIMES  PICTURE X.
000096
000097         01  MESSAGE-LOG.
000098             02 FILLER              PICTURE X(2) VALUE SPACES.
000099             02 MESSAGE-TEXT        PICTURE X(80).
000100
000101         01  DISPLAY-MESSAGE.
000102             02 FILLER              PICTURE X(2) VALUE SPACES.
000103             02 DISPLAY-TEMP        PICTURE X(6).
000104             02 FILLER              PICTURE X(2) VALUE SPACES.
000105             02 DISPLAY-TEXT        PICTURE X(60).
000106
000107         PROCEDURE DIVISION.
000108             OPEN INPUT OLD-VERSION, MODIFICATION,
000109                  OUTPUT NEW-VERSION, COMMENTARY.
000110             CLOSE OLD-VERSION, NEW-VERSION, MODIFICATION, COMMENTARY.
000111             STOP RUN.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0080 FILE                OLD-VERSION
0080 GROUP          01   OLD-RECORD
0075 ALPHANUMERIC   02     OLD-STATEMENT                X(75)
0005 ALPHANUMERIC   02     OLD-NUMBER                   X(5)

0080 FILE                NEW-VERSION
0080 GROUP          01   NEW-RECORD
0075 ALPHANUMERIC   02     NEW-STATEMENT                X(75)
0005 ALPHANUMERIC   02     NEW-NUMBER                   X(5)

0032 FILE                PRT-VERSION

0080 FILE                MODIFICATION
0080 GROUP          01   UPDATE-ORDER
0075 ALPHANUMERIC   02     INSERTION
0006 ALPHANUMERIC   03       COMMAND                    X(6)
     CONDITIONAL    88         ENDJOB
     CONDITIONAL    88         ENDSET
     CONDITIONAL    88         REMOVE
     CONDITIONAL    88         ADDNEW
     CONDITIONAL    88         CHANGE
     CONDITIONAL    88         DISPLY
0001 ALPHANUMERIC   03       FILLER                     X
0005 ALPHANUMERIC   03       A-FIELD                    9(5)
0005 ALPHANUMERIC-R 03       A-ALPHA                    X(5)
     CONDITIONAL    88         A-BLANK
0004 ALPHANUMERIC   03       FILLER                     X(4)
0005 ALPHANUMERIC   03       B-FIELD                    9(5)
0005 ALPHANUMERIC-R 03       B-ALPHA                    X(5)
     CONDITIONAL    88         B-BLANK
0054 ALPHANUMERIC   03       FILLER                     X(54)
0005 ALPHANUMERIC   02     FILLER                       X(5)

0082 FILE                COMMENTARY
0082 GROUP          01   COMMENT-LINE
0082 ALPHANUMERIC   02     FILLER                       X(82)

0080 GROUP          01   HEADINGS-LINE
0015 ALPHANUMERIC   02     FILLER                       X(15)
0020 ALPHANUMERIC   02     FILLER                       X(20)
0017 ALPHANUMERIC   02     PHASE                        X(17)
0002 ALPHANUMERIC   02     MONTH-RUN                    XX
0001 ALPHANUMERIC   02     FILLER                       X
0002 ALPHANUMERIC   02     DAY-RUN                      XX
0001 ALPHANUMERIC   02     FILLER                       X
0002 ALPHANUMERIC   02     YEAR-RUN                     XX
0008 ALPHANUMERIC   02     FILLER                       X(8)
0008 ALPHANUMERIC   02     FILLER                       X(8)
0004 NUMERIC        02     PAGE-NUMBER                  9(4)

0082 GROUP          01   COMMAND-LISTING
0002 ALPHANUMERIC   02     FILLER                       X(2)
0080 ALPHANUMERIC   02     COMMAND-IMAGE                X(80)

0082 GROUP          01   ACTIVITIES-LISTING
0002 ALPHANUMERIC   02     DISPOSITION                  X(2)
0080 ALPHANUMERIC   02     ACTIVE-IMAGE                 X(80)

0008 GROUP          01   UPSI-BYTE
0001 ALPHANUMERIC   02     UPSI-BIT                     X

0082 GROUP          01   MESSAGE-LOG
0002 ALPHANUMERIC   02     FILLER                       X(2)
0080 ALPHANUMERIC   02     MESSAGE-TEXT                 X(80)

0070 GROUP          01   DISPLAY-MESSAGE
0002 ALPHANUMERIC   02     FILLER                       X(2)
0006 ALPHANUMERIC   02     DISPLAY-TEMP                 X(6)
0002 ALPHANUMERIC   02     FILLER                       X(2)
0060 ALPHANUMERIC   02     DISPLAY-TEXT                 X(60)

8 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog18.lst prog.lis], [0], [], [])

AT_CLEANUP


AT_SETUP([Invalid PICTURE strings])
AT_KEYWORDS([listing])

AT_CAPTURE_FILE([prog.lst])

AT_DATA([prog.cob], [
       IDENTIFICATION DIVISION.
       PROGRAM-ID. prog.

       DATA DIVISION.
       WORKING-STORAGE SECTION.
       01  empty-pic PIC.
       01  too-long-pic PIC XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
      -XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX.
       01  too-long-pic2 PIC XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
      -XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
      -XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
      -XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
      -XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX.
       01  mutiple-symbols.
           03  PIC 9CRCR.
           03  PIC SS99S.
           03  PIC $+99$-.
       01  non-symbols.
           03  PIC 9K.
       01  too-many-digits PIC 9(50).
       01  too-long-number-in-parens PIC 9(11111111111111).
       01  nested-parens PIC 9((100)).
       01  unbalanced-parens PIC 9(.
       01  multiple-pairs-of-parens PIC 9(5)(3).
       01  no-digit-in-parens PIC 9().
       01  mutually-exclusive-symbols.
           03  PIC 9V.9.
           03  PIC Z*.
           03  PIC +(5)--.
           03  PIC AN.
           03  PIC SA.
           03  PIC +++9+.
           03  PIC +9(5)CR.
       01 non-rightmost-leftmost-symbols.
           03  PIC BBB+BB99.
           03  PIC 99-B.
           03  PIC 9CRB.
           03  PIC DB9(5).
           03  PIC 99$$$.
           03  PIC 99$B.
           03  PIC 0$99.
           03  PIC PPPVP9.
       01  missing-symbols.
           03  PIC B(5).
       01  valid-pics.
           03  PIC VP9B.
           03  PIC B9P(3).
           03  PIC B$$$.
           03  PIC 0000+B0+++0B,+.
           03  PIC +(5)P(3).
           03  PIC ++.++.
])

AT_CHECK([$COMPILE_ONLY -t prog.lst -tlines=0 prog.cob], [1], [],
[prog.cob: 9: warning: continuation of COBOL words used
prog.cob: 11: warning: continuation of COBOL words used
prog.cob: 12: warning: continuation of COBOL words used
prog.cob: 13: warning: continuation of COBOL words used
prog.cob: 14: warning: continuation of COBOL words used
prog.cob: 7: error: missing PICTURE string
prog.cob: 10: error: PICTURE string may not contain more than 255 characters; contains 301 characters
prog.cob: 16: error: CR or DB may only occur once in a PICTURE string
prog.cob: 17: error: S may only occur once in a PICTURE string
prog.cob: 17: error: S must be at start of PICTURE string
prog.cob: 18: error: a leading +/- sign cannot follow a leading currency symbol
prog.cob: 18: error: a trailing currency symbol cannot follow a leading currency symbol
prog.cob: 18: error: a trailing +/- sign cannot follow a leading +/- sign
prog.cob: 20: error: invalid PICTURE character 'K'
prog.cob: 21: error: numeric field cannot be larger than 38 digits
prog.cob: 22: error: only up to 9 significant digits are permitted within parentheses
prog.cob: 23: error: '(100' is not defined
prog.cob: 23: error: invalid PICTURE character ')'
prog.cob: 24: error: unbalanced parentheses
prog.cob: 25: error: only one set of parentheses is permitted
prog.cob: 26: error: parentheses must contain (a constant-name defined as) a positive integer
prog.cob: 28: error: . cannot follow V
prog.cob: 29: error: cannot have both Z and * in PICTURE string
prog.cob: 30: error: a trailing +/- sign cannot follow a floating +/- string which is before the decimal point
prog.cob: 30: error: a trailing +/- sign may only occur once in a PICTURE string
prog.cob: 31: warning: handling of USAGE NATIONAL is unfinished; implementation is likely to be changed
prog.cob: 31: error: N cannot follow A or X
prog.cob: 32: error: A or X cannot follow S
prog.cob: 33: error: a trailing +/- sign cannot follow a floating +/- string which is before the decimal point
prog.cob: 34: error: CR or DB cannot follow a leading +/- sign
prog.cob: 36: error: a leading +/- sign cannot follow B, 0 or /
prog.cob: 37: error: a leading +/- sign cannot follow 9
prog.cob: 38: error: B, 0 or / cannot follow CR or DB
prog.cob: 39: error: 9 cannot follow CR or DB
prog.cob: 40: error: a floating currency symbol string which is before the decimal point cannot follow 9
prog.cob: 41: error: a leading currency symbol cannot follow 9
prog.cob: 42: error: a leading currency symbol cannot follow B, 0 or /
prog.cob: 43: error: P must be at start or end of PICTURE string
prog.cob: 43: error: V cannot follow a P which is after the decimal point
prog.cob: 45: error: PICTURE string must contain at least one of the set A, N, X, Z, 1, 9 and *; or at least two of the set +, - and the currency symbol
])

AT_DATA([prog19.lst],
[GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION DIVISION.
000003         PROGRAM-ID. prog.
000004
000005         DATA DIVISION.
000006         WORKING-STORAGE SECTION.
000007         01  empty-pic PIC.
error: missing PICTURE string
000008         01  too-long-pic PIC XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
000009        -XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX.
warning: continuation of COBOL words used
000010         01  too-long-pic2 PIC XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
error: PICTURE string may not contain more than 255 characters; contains 301 characters
000011        -XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
warning: continuation of COBOL words used
000012        -XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
warning: continuation of COBOL words used
000013        -XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
warning: continuation of COBOL words used
000014        -XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX.
warning: continuation of COBOL words used
000015         01  mutiple-symbols.
000016             03  PIC 9CRCR.
error: CR or DB may only occur once in a PICTURE string
000017             03  PIC SS99S.
error: S may only occur once in a PICTURE string
error: S must be at start of PICTURE string
000018             03  PIC $+99$-.
error: a leading +/- sign cannot follow a leading currency symbol
error: a trailing currency symbol cannot follow a leading currency symbol
error: a trailing +/- sign cannot follow a leading +/- sign
000019         01  non-symbols.
000020             03  PIC 9K.
error: invalid PICTURE character 'K'
000021         01  too-many-digits PIC 9(50).
error: numeric field cannot be larger than 38 digits
000022         01  too-long-number-in-parens PIC 9(11111111111111).
error: only up to 9 significant digits are permitted within parentheses
000023         01  nested-parens PIC 9((100)).
error: '(100' is not defined
error: invalid PICTURE character ')'
000024         01  unbalanced-parens PIC 9(.
error: unbalanced parentheses
000025         01  multiple-pairs-of-parens PIC 9(5)(3).
error: only one set of parentheses is permitted
000026         01  no-digit-in-parens PIC 9().
error: parentheses must contain (a constant-name defined as) a positive integer
000027         01  mutually-exclusive-symbols.
000028             03  PIC 9V.9.
error: . cannot follow V
000029             03  PIC Z*.
error: cannot have both Z and * in PICTURE string
000030             03  PIC +(5)--.
error: a trailing +/- sign cannot follow a floating +/- string which is before the decimal point
error: a trailing +/- sign may only occur once in a PICTURE string
000031             03  PIC AN.
warning: handling of USAGE NATIONAL is unfinished; implementation is likely to be changed
error: N cannot follow A or X
000032             03  PIC SA.
error: A or X cannot follow S
000033             03  PIC +++9+.
error: a trailing +/- sign cannot follow a floating +/- string which is before the decimal point
000034             03  PIC +9(5)CR.
error: CR or DB cannot follow a leading +/- sign
000035         01 non-rightmost-leftmost-symbols.
000036             03  PIC BBB+BB99.
error: a leading +/- sign cannot follow B, 0 or /
000037             03  PIC 99-B.
error: a leading +/- sign cannot follow 9
000038             03  PIC 9CRB.
error: B, 0 or / cannot follow CR or DB
000039             03  PIC DB9(5).
error: 9 cannot follow CR or DB
000040             03  PIC 99$$$.
error: a floating currency symbol string which is before the decimal point cannot follow 9
000041             03  PIC 99$B.
error: a leading currency symbol cannot follow 9
000042             03  PIC 0$99.
error: a leading currency symbol cannot follow B, 0 or /
000043             03  PIC PPPVP9.
error: P must be at start or end of PICTURE string
error: V cannot follow a P which is after the decimal point
000044         01  missing-symbols.
000045             03  PIC B(5).
error: PICTURE string must contain at least one of the set A, N, X, Z, 1, 9 and *; or at least two of the set +, - and the currency symbol
000046         01  valid-pics.
000047             03  PIC VP9B.
000048             03  PIC B9P(3).
000049             03  PIC B$$$.
000050             03  PIC 0000+B0+++0B,+.
000051             03  PIC +(5)P(3).
000052             03  PIC ++.++.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0000 ALPHANUMERIC   01   empty-pic                      INVALID

0077 ALPHANUMERIC   01   too-long-pic                   XXXXXXXXXXXXXXXXXXXXXXXX

0000 ALPHANUMERIC   01   too-long-pic2                  INVALID

0000 GROUP          01   mutiple-symbols
0000 ALPHANUMERIC   03     FILLER                       INVALID
0000 ALPHANUMERIC   03     FILLER                       INVALID
0000 ALPHANUMERIC   03     FILLER                       INVALID

0000 GROUP          01   non-symbols
0000 ALPHANUMERIC   03     FILLER                       INVALID

0050 ALPHANUMERIC   01   too-many-digits                9(50)

0000 ALPHANUMERIC   01   too-long-number-in-parens      INVALID

0000 ALPHANUMERIC   01   nested-parens                  INVALID

0000 ALPHANUMERIC   01   unbalanced-parens              INVALID

0000 ALPHANUMERIC   01   multiple-pairs-of-parens       INVALID

0000 ALPHANUMERIC   01   no-digit-in-parens             INVALID

0000 GROUP          01   mutually-exclusive-symbols
0000 ALPHANUMERIC   03     FILLER                       INVALID
0000 ALPHANUMERIC   03     FILLER                       INVALID
0000 ALPHANUMERIC   03     FILLER                       INVALID
0000 ALPHANUMERIC   03     FILLER                       INVALID
0000 ALPHANUMERIC   03     FILLER                       INVALID
0000 ALPHANUMERIC   03     FILLER                       INVALID
0000 ALPHANUMERIC   03     FILLER                       INVALID

0000 GROUP          01   non-rightmost-leftmost-symbols
0000 ALPHANUMERIC   03     FILLER                       INVALID
0000 ALPHANUMERIC   03     FILLER                       INVALID
0000 ALPHANUMERIC   03     FILLER                       INVALID
0000 ALPHANUMERIC   03     FILLER                       INVALID
0000 ALPHANUMERIC   03     FILLER                       INVALID
0000 ALPHANUMERIC   03     FILLER                       INVALID
0000 ALPHANUMERIC   03     FILLER                       INVALID
0000 ALPHANUMERIC   03     FILLER                       INVALID

0000 GROUP          01   missing-symbols
0000 ALPHANUMERIC   03     FILLER                       INVALID

0032 GROUP          01   valid-pics
0002 ALPHANUMERIC   03     FILLER                       VP9B
0002 ALPHANUMERIC   03     FILLER                       B9P(3)
0004 ALPHANUMERIC   03     FILLER                       B$$$
0014 ALPHANUMERIC   03     FILLER                       0000+B0+++0B,+
0005 ALPHANUMERIC   03     FILLER                       +(5)P(3)
0005 ALPHANUMERIC   03     FILLER                       ++.++

6 Warnings in program
34 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog19.lst prog.lis], [0], [], [])

AT_CLEANUP


AT_SETUP([Variable format])
AT_KEYWORDS([COBOL2002 listing])

AT_CAPTURE_FILE([prog.lst])

AT_DATA([prog.cob],
[000001 $SET SOURCEFORMAT "VARIABLE"
000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. prog.
000030* blah blah blah
000040 PROCEDURE DIVISION.
000050                                                                  DISPLAY "Hello!"
000060     .
000070 END PROGRAM prog.
])

AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [], [])

AT_DATA([prog20.lst],
[GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001  000001 $SET SOURCEFORMAT "VARIABLE"
000002  000010 IDENTIFICATION DIVISION.
000003  000020 PROGRAM-ID. prog.
000004  000030* blah blah blah
000005  000040 PROCEDURE DIVISION.
000006  000050
000006+ DISPLAY "Hello!"
000007  000060     .
000008  000070 END PROGRAM prog.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog20.lst prog.lis], [0], [], [])

AT_CLEANUP

AT_SETUP([Cross reference])
AT_KEYWORDS([listing])

AT_CAPTURE_FILE([prog.lst])

AT_DATA([prog.cob], [
       IDENTIFICATION DIVISION.                                         EDIT0001
       PROGRAM-ID.                                                      EDIT0002
           EDITOR.                                                      EDIT0003
       AUTHOR.                                                          EDIT0004
           J H FORTNER.                                                 EDIT0005
       DATE-WRITTEN.                                                    EDIT0006
           07/23/72.                                                    EDIT0007
                                                                        EDIT0008
      *NOTE.                                                            EDIT0009
      *    THIS VERSION OF EDITOR 1 COMPRISES AN ENTIRE RE_WRITE        EDIT0010
      *    OF THE BASIC EDITOR WITH ONLY ONE CHANGE IN THE COMMAND      EDIT0011
      *    STRUCTURE, THAT BEING THE ADDITION OF A "CHANGE" COMMAND     EDIT0012
      *    TO SERVE IN PLACE OF THE INSERT-DELETE COMBINATION WHICH     EDIT0013
      *    WAS REQUIRED IN PREVIOUS VERSIONS. RECORD NUMBER FIELDS      EDIT0014
      *    HAVE ALSO BEEN REDUCED FROM 5 DIGITS TO 4.                   EDIT0015
      *    CHANGE 1.                                                    EDIT0016
      *       MODIFY TO RUN ON TI-990.                                  EDIT0017
      *    CHANGE 2.                                                    EDIT0018
      *       MODIFY TO RUN ON GNUCOBOL.                                EDIT0019
                                                                        EDIT0020
       ENVIRONMENT DIVISION.                                            EDIT0021
       CONFIGURATION SECTION.                                           EDIT0022
       SOURCE-COMPUTER.                                                 EDIT0023
           IBM-360.                                                     EDIT0024
       OBJECT-COMPUTER.                                                 EDIT0025
           IBM-360.                                                     EDIT0026
       INPUT-OUTPUT SECTION.                                            EDIT0027
       FILE-CONTROL.                                                    EDIT0028
           SELECT OLD-VERSION  ASSIGN TO "SYSUT1"                       EDIT0029
                               ORGANIZATION LINE SEQUENTIAL.            EDIT0030
           SELECT NEW-VERSION  ASSIGN TO "SYSUT2"                       EDIT0031
                               ORGANIZATION LINE SEQUENTIAL.            EDIT0032
           SELECT PRT-VERSION  ASSIGN TO "SYSUT2"                       EDIT0033
                               ORGANIZATION LINE SEQUENTIAL.            EDIT0034
           SELECT MODIFICATION ASSIGN TO "SYSIN1"                       EDIT0035
                               ORGANIZATION LINE SEQUENTIAL.            EDIT0036
           SELECT COMMENTARY   ASSIGN TO "SYSOU1"                       EDIT0037
                               ORGANIZATION LINE SEQUENTIAL.            EDIT0038
                                                                        EDIT0039
       DATA DIVISION.                                                   EDIT0040
                                                                        EDIT0041
       FILE SECTION.                                                    EDIT0042
                                                                        EDIT0043
       FD  OLD-VERSION                                                  EDIT0044
           LABEL RECORDS ARE STANDARD                                   EDIT0045
           BLOCK CONTAINS 80 CHARACTERS                                 EDIT0046
           DATA RECORD IS OLD-RECORD.                                   EDIT0047
                                                                        EDIT0048
       01  OLD-RECORD.                                                  EDIT0049
           02 OLD-STATEMENT       PICTURE X(75).                        EDIT0050
           02 OLD-NUMBER          PICTURE X(5).                         EDIT0051
                                                                        EDIT0052
       FD  NEW-VERSION                                                  EDIT0053
           LABEL RECORDS ARE STANDARD                                   EDIT0054
           BLOCK CONTAINS 80 CHARACTERS                                 EDIT0055
           DATA RECORD IS NEW-RECORD.                                   EDIT0056
                                                                        EDIT0057
       01  NEW-RECORD.                                                  EDIT0058
           02 NEW-STATEMENT       PICTURE X(75).                        EDIT0059
           02 NEW-NUMBER          PICTURE X(5).                         EDIT0060
                                                                        EDIT0061
       FD  MODIFICATION                                                 EDIT0062
           LABEL RECORDS ARE OMITTED                                    EDIT0063
           BLOCK CONTAINS 80 CHARACTERS                                 EDIT0064
           DATA RECORD IS UPDATE-ORDER.                                 EDIT0065
                                                                        EDIT0066
       01  UPDATE-ORDER.                                                EDIT0067
           02 INSERTION.                                                EDIT0068
              03 COMMAND          PICTURE X(6).                         EDIT0069
                 88 ENDJOB        VALUE "ENDJOB".                       EDIT0070
                 88 ENDSET        VALUE "ENDSET".                       EDIT0071
                 88 REMOVE        VALUE "REMOVE".                       EDIT0072
                 88 ADDNEW        VALUE "INSERT".                       EDIT0073
                 88 CHANGE        VALUE "CHANGE".                       EDIT0074
                 88 DISPLY        VALUE "DISPLY".                       EDIT0075
              03 FILLER           PICTURE X.                            EDIT0076
              03 A-FIELD          PICTURE 9(5).                         EDIT0077
              03 A-ALPHA REDEFINES A-FIELD    PICTURE X(5).             EDIT0078
                 88 A-BLANK       VALUE SPACES.                         EDIT0079
              03 FILLER           PICTURE X(4).                         EDIT0080
              03 B-FIELD          PICTURE 9(5).                         EDIT0081
              03 B-ALPHA REDEFINES B-FIELD    PICTURE X(5).             EDIT0082
                 88 B-BLANK       VALUE SPACES.                         EDIT0083
              03 FILLER           PICTURE X(54).                        EDIT0084
           02 FILLER              PICTURE X(5).                         EDIT0085
                                                                        EDIT0086
       FD  COMMENTARY                                                   EDIT0087
           LABEL RECORDS ARE OMITTED                                    EDIT0088
           BLOCK CONTAINS 82 CHARACTERS                                 EDIT0089
           DATA RECORD IS COMMENT-LINE.                                 EDIT0090
                                                                        EDIT0091
       01  COMMENT-LINE.                                                EDIT0092
           02 FILLER              PICTURE X(82).                        EDIT0093
                                                                        EDIT0094
       WORKING-STORAGE SECTION.                                         EDIT0095
                                                                        EDIT0096
       77  COMMAND-ADDITIONS      PICTURE 9(3) COMPUTATIONAL VALUE 0.   EDIT0097
       77  COMMAND-SUBTRACTIONS   PICTURE 9(3) COMPUTATIONAL VALUE 0.   EDIT0098
       77  TOTAL-INSERTED         PICTURE 9(3) COMPUTATIONAL VALUE 0.   EDIT0099
       77  TOTAL-DELETED          PICTURE 9(3) COMPUTATIONAL VALUE 0.   EDIT0100
       77  OUTPUT-COUNT           PICTURE 9(5) COMPUTATIONAL VALUE 0.   EDIT0101
       77  LINE-COUNT             PICTURE 9(2) COMPUTATIONAL VALUE 0.   EDIT0102
       77  FIELDA                 PICTURE 9(5) VALUE 0.                 EDIT0103
       77  FIELDB                 PICTURE 9(5) VALUE 0.                 EDIT0104
       77  BLANK-LINE             PICTURE X(82) VALUE SPACES.           EDIT0105
                                                                        EDIT0106
       01  DATE-FROM-SYS.                                               EDIT0107
           02 DFSYS OCCURS 3 TIMES PICTURE 99.                          EDIT0108
                                                                        EDIT0109
       01  HEADINGS-LINE.                                               EDIT0110
           02 FILLER              PICTURE X(15) VALUE "EDITOR VERSION". EDIT0111
           02 FILLER              PICTURE X(20) VALUE "1.1 - 206/72".   EDIT0112
           02 PHASE               PICTURE X(17) VALUE "UPDATING AS OF". EDIT0113
           02 MONTH-RUN           PICTURE XX.                           EDIT0114
           02 FILLER              PICTURE X VALUE "/".                  EDIT0115
           02 DAY-RUN             PICTURE XX.                           EDIT0116
           02 FILLER              PICTURE X VALUE "/".                  EDIT0117
           02 YEAR-RUN            PICTURE XX.                           EDIT0118
           02 FILLER              PICTURE X(8) VALUE SPACES.            EDIT0119
           02 FILLER              PICTURE X(8) VALUE "  PAGE: ".        EDIT0120
           02 PAGE-NUMBER         PICTURE 9(4) VALUE 0.                 EDIT0121
                                                                        EDIT0122
       01  COMMAND-LISTING.                                             EDIT0123
           02 FILLER              PICTURE X(2) VALUE SPACES.            EDIT0124
           02 COMMAND-IMAGE       PICTURE X(80).                        EDIT0125
                                                                        EDIT0126
       01  ACTIVITIES-LISTING.                                          EDIT0127
           02 DISPOSITION         PICTURE X(2).                         EDIT0128
           02 ACTIVE-IMAGE        PICTURE X(80).                        EDIT0129
                                                                        EDIT0130
       01  UPSI-BYTE.                                                   EDIT0131
           02 UPSI-BIT OCCURS 8 TIMES  PICTURE X.                       EDIT0132
                                                                        EDIT0133
       01  MESSAGE-LOG.                                                 EDIT0134
           02 FILLER              PICTURE X(2) VALUE SPACES.            EDIT0135
           02 MESSAGE-TEXT        PICTURE X(80).                        EDIT0136
                                                                        EDIT0137
       01  DISPLAY-MESSAGE.                                             EDIT0138
           02 FILLER              PICTURE X(2) VALUE SPACES.            EDIT0139
           02 DISPLAY-TEMP        PICTURE X(6).                         EDIT0140
           02 FILLER              PICTURE X(2) VALUE SPACES.            EDIT0141
           02 DISPLAY-TEXT        PICTURE X(60).                        EDIT0142
                                                                        EDIT0143
       77  END-JOB-PROCESS        PICTURE 9 VALUE 0.                    EDIT0144
       77  DELETE-PROCESS         PICTURE 9 VALUE 1.                    EDIT0145
       77  INSERT-PROCESS         PICTURE 9 VALUE 2.                    EDIT0146
       77  WRITE-PROCESS          PICTURE 9 VALUE 3.                    EDIT0147
                                                                        EDIT0148
       01  SELECTORS.                                                   EDIT0149
           02 RETURN-SELECT       PICTURE 9 VALUE 0.                    EDIT0150
           02 NEXT-JOB-SELECT     PICTURE 9 VALUE 0.                    EDIT0151
                                                                        EDIT0152
       PROCEDURE DIVISION.                                              EDIT0153
                                                                        EDIT0154
       START-SECTION.                                                   EDIT0155
           OPEN INPUT OLD-VERSION, MODIFICATION,                        EDIT0156
                OUTPUT NEW-VERSION, COMMENTARY.                         EDIT0157
           MOVE "F" TO UPSI-BIT (1), UPSI-BIT (2).                      EDIT0158
           ACCEPT DATE-FROM-SYS FROM DATE.                              EDIT0159
           MOVE DFSYS (1) TO YEAR-RUN.                                  EDIT0160
           MOVE DFSYS (2) TO MONTH-RUN.                                 EDIT0161
           MOVE DFSYS (3) TO DAY-RUN.                                   EDIT0162
           READ OLD-VERSION AT END                                      EDIT0163
              MOVE "NO OLD VERSION FOUND" TO MESSAGE-TEXT               EDIT0164
              WRITE COMMENT-LINE FROM MESSAGE-LOG                       EDIT0165
              GO TO END-JOB.                                            EDIT0166
           MOVE OLD-STATEMENT TO NEW-STATEMENT.                         EDIT0167
           PERFORM OUTPUT-A-RECORD.                                     EDIT0168
                                                                        EDIT0169
       TOP-OF-PAGE-ROUTINE.                                             EDIT0170
           ADD 1 TO PAGE-NUMBER.                                        EDIT0171
           MOVE ZERO TO LINE-COUNT.                                     EDIT0172
           WRITE COMMENT-LINE FROM HEADINGS-LINE AFTER PAGE.            EDIT0173
           WRITE COMMENT-LINE FROM BLANK-LINE.                          EDIT0174
                                                                        EDIT0175
       READ-A-COMMAND.                                                  EDIT0176
           READ MODIFICATION AT END                                     EDIT0177
              MOVE "MODIFICATION FILE ENDED " TO MESSAGE-TEXT           EDIT0178
              WRITE COMMENT-LINE FROM MESSAGE-LOG                       EDIT0179
              GO TO FINISH-JOB.                                         EDIT0180
           MOVE UPDATE-ORDER TO COMMAND-IMAGE.                          EDIT0181
           WRITE COMMENT-LINE FROM COMMAND-LISTING.                     EDIT0182
           ADD 2 TO LINE-COUNT.                                         EDIT0183
           IF A-BLANK MOVE ZEROES TO A-FIELD.                           EDIT0184
           IF B-BLANK MOVE ZEROES TO B-FIELD.                           EDIT0185
           MOVE A-FIELD TO FIELDA.                                      EDIT0186
           MOVE B-FIELD TO FIELDB.                                      EDIT0187
                                                                        EDIT0188
       TEST-COMMAND-TYPE.                                               EDIT0189
           IF CHANGE GO TO CHANGE-A-RECORD.                             EDIT0190
           IF REMOVE GO TO DELETE-A-RECORD.                             EDIT0191
           IF DISPLY MOVE "T" TO UPSI-BIT (2)                           EDIT0192
              GO TO FINISH-JOB.                                         EDIT0193
           IF ENDJOB GO TO FINISH-JOB.                                  EDIT0194
           IF ADDNEW GO TO INSERT-A-RECORD.                             EDIT0195
           MOVE "INVALID COMMAND IGNORED." TO MESSAGE-TEXT.             EDIT0196
           WRITE COMMENT-LINE FROM MESSAGE-LOG.                         EDIT0197
           GO TO READ-A-COMMAND.                                        EDIT0198
                                                                        EDIT0199
       CHANGE-A-RECORD.                                                 EDIT0200
           ALTER RETURN-TO-USER TO PROCEED TO INSERTION-PROCESS.        EDIT0201
           ALTER NEXT-JOB-STEP TO PROCEED TO DELETION-PROCESS.          EDIT0202
                                                                        EDIT0205
       FIND-FIELDA.                                                     EDIT0206
           IF OLD-NUMBER IS GREATER THAN FIELDA                         EDIT0207
              MOVE "RECORD ALREADY PASSED" TO MESSAGE-TEXT              EDIT0208
              WRITE COMMENT-LINE FROM MESSAGE-LOG                       EDIT0209
              GO TO READ-A-COMMAND.                                     EDIT0210
           READ OLD-VERSION AT END                                      EDIT0211
              MOVE "NOT FOUND IN OLD VERSION" TO DISPLAY-TEXT           EDIT0212
              MOVE FIELDA TO DISPLAY-TEMP                               EDIT0213
              WRITE COMMENT-LINE FROM DISPLAY-MESSAGE                   EDIT0214
              GO TO END-JOB.                                            EDIT0215
           IF OLD-NUMBER IS LESS THAN FIELDA                            EDIT0216
              MOVE OLD-STATEMENT TO NEW-STATEMENT                       EDIT0217
              PERFORM OUTPUT-A-RECORD                                   EDIT0218
              GO TO FIND-FIELDA.                                        EDIT0219
                                                                        EDIT0220
       RETURN-TO-USER.                                                  EDIT0221
           GO TO END-JOB.                                               EDIT0223
                                                                        EDIT0228
       INSERT-A-RECORD.                                                 EDIT0229
           ALTER RETURN-TO-USER TO PROCEED TO INSERTION-PROCESS.        EDIT0230
           ALTER NEXT-JOB-STEP TO PROCEED TO FORCED-WRITE.              EDIT0231
           GO TO FIND-FIELDA.                                           EDIT0234
                                                                        EDIT0235
       INSERTION-PROCESS.                                               EDIT0236
           READ MODIFICATION AT END                                     EDIT0237
              MOVE "NO ENDSET FOUND" TO MESSAGE-TEXT                    EDIT0238
              WRITE COMMENT-LINE FROM MESSAGE-LOG                       EDIT0239
              GO TO END-JOB.                                            EDIT0240
           IF ENDSET                                                    EDIT0241
              MOVE COMMAND-ADDITIONS TO DISPLAY-TEMP                    EDIT0242
              MOVE "RECORDS INSERTED." TO DISPLAY-TEXT                  EDIT0243
              WRITE COMMENT-LINE FROM DISPLAY-MESSAGE                   EDIT0244
              ADD COMMAND-ADDITIONS TO TOTAL-INSERTED                   EDIT0245
              MOVE ZEROES TO COMMAND-ADDITIONS                          EDIT0246
              GO TO NEXT-JOB-STEP.                                      EDIT0247
           MOVE INSERTION TO NEW-STATEMENT, ACTIVE-IMAGE.               EDIT0248
           MOVE "I " TO DISPOSITION.                                    EDIT0249
           PERFORM OUTPUT-A-RECORD.                                     EDIT0250
           WRITE COMMENT-LINE FROM ACTIVITIES-LISTING.                  EDIT0251
           ADD 1 TO COMMAND-ADDITIONS.                                  EDIT0252
           ADD 1 TO LINE-COUNT.                                         EDIT0253
           IF LINE-COUNT EQUAL 56 PERFORM TOP-OF-PAGE-ROUTINE.          EDIT0254
           GO TO INSERTION-PROCESS.                                     EDIT0255
                                                                        EDIT0256
       NEXT-JOB-STEP.                                                   EDIT0257
           GO TO END-JOB.                                               EDIT0259
                                                                        EDIT0264
       FORCED-WRITE.                                                    EDIT0265
           MOVE OLD-STATEMENT TO NEW-STATEMENT.                         EDIT0266
           PERFORM OUTPUT-A-RECORD.                                     EDIT0267
           GO TO READ-A-COMMAND.                                        EDIT0268
                                                                        EDIT0269
       DELETE-A-RECORD.                                                 EDIT0270
           ALTER RETURN-TO-USER TO PROCEED TO DELETION-PROCESS.         EDIT0271
           GO TO FIND-FIELDA.                                           EDIT0273
                                                                        EDIT0274
       DELETION-PROCESS.                                                EDIT0275
           MOVE OLD-RECORD TO ACTIVE-IMAGE.                             EDIT0276
           MOVE "D " TO DISPOSITION.                                    EDIT0277
           WRITE COMMENT-LINE FROM ACTIVITIES-LISTING.                  EDIT0278
           ADD 1 TO LINE-COUNT.                                         EDIT0279
           IF LINE-COUNT EQUAL 56 PERFORM TOP-OF-PAGE-ROUTINE.          EDIT0280
           ADD 1 TO COMMAND-SUBTRACTIONS.                               EDIT0281
           IF OLD-NUMBER IS NOT LESS THAN FIELDB                        EDIT0282
              MOVE COMMAND-SUBTRACTIONS TO DISPLAY-TEMP                 EDIT0283
              MOVE "RECORDS DELETED." TO DISPLAY-TEXT                   EDIT0284
              WRITE COMMENT-LINE FROM DISPLAY-MESSAGE                   EDIT0285
              ADD COMMAND-SUBTRACTIONS TO TOTAL-DELETED                 EDIT0286
              MOVE OLD-STATEMENT TO NEW-STATEMENT                       EDIT0287
              MOVE ZEROES TO COMMAND-SUBTRACTIONS                       EDIT0288
              GO TO READ-A-COMMAND.                                     EDIT0289
           READ OLD-VERSION AT END                                      EDIT0290
              MOVE "NOT FOUND IN OLD VERSION DOING DELETE"              EDIT0291
                    TO DISPLAY-TEXT                                     EDIT0292
              WRITE COMMENT-LINE FROM DISPLAY-MESSAGE                   EDIT0293
              GO TO END-JOB.                                            EDIT0294
           GO TO DELETION-PROCESS.                                      EDIT0295
                                                                        EDIT0296
       OUTPUT-A-RECORD.                                                 EDIT0297
           ADD 1 TO OUTPUT-COUNT.                                       EDIT0298
           MOVE OUTPUT-COUNT TO NEW-NUMBER.                             EDIT0299
           WRITE NEW-RECORD.                                            EDIT0300
                                                                        EDIT0301
       FINISH-JOB.                                                      EDIT0302
           READ OLD-VERSION AT END GO TO TEST-FOR-LISTING.              EDIT0303
           MOVE OLD-STATEMENT TO NEW-STATEMENT.                         EDIT0304
           GO TO OUTPUT-A-RECORD.                                       EDIT0305
                                                                        EDIT0306
       TEST-FOR-LISTING.                                                EDIT0307
           PERFORM TOP-OF-PAGE-ROUTINE.                                 EDIT0308
           MOVE OLD-NUMBER TO DISPLAY-TEMP.                             EDIT0309
           MOVE "RECORDS READ." TO DISPLAY-TEXT.                        EDIT0310
           WRITE COMMENT-LINE FROM DISPLAY-MESSAGE.                     EDIT0311
           MOVE TOTAL-INSERTED TO DISPLAY-TEMP.                         EDIT0312
           MOVE "RECORDS ADDED." TO DISPLAY-TEXT.                       EDIT0313
           WRITE COMMENT-LINE FROM DISPLAY-MESSAGE.                     EDIT0314
           MOVE TOTAL-DELETED TO DISPLAY-TEMP.                          EDIT0315
           MOVE "RECORDS DROPPED." TO DISPLAY-TEXT.                     EDIT0316
           WRITE COMMENT-LINE FROM DISPLAY-MESSAGE.                     EDIT0317
           MOVE OUTPUT-COUNT TO DISPLAY-TEMP.                           EDIT0318
           MOVE "RECORDS IN NEW FILE." TO DISPLAY-TEXT.                 EDIT0319
           WRITE COMMENT-LINE FROM DISPLAY-MESSAGE.                     EDIT0320
           IF UPSI-BIT (2) EQUAL "F" GO TO END-JOB.                     EDIT0321
           CLOSE NEW-VERSION.                                           EDIT0322
           OPEN INPUT NEW-VERSION.                                      EDIT0323
           MOVE "UPDATED LISTING" TO PHASE.                             EDIT0324
           MOVE ZEROES TO PAGE-NUMBER.                                  EDIT0325
           PERFORM TOP-OF-PAGE-ROUTINE.                                 EDIT0326
           MOVE SPACES TO DISPOSITION.                                  EDIT0327
                                                                        EDIT0328
       LISTING-LOOP.                                                    EDIT0329
           READ NEW-VERSION AT END GO TO END-JOB.                       EDIT0330
           MOVE NEW-RECORD TO ACTIVE-IMAGE.                             EDIT0331
           WRITE COMMENT-LINE FROM ACTIVITIES-LISTING.                  EDIT0332
           ADD 1 TO LINE-COUNT.                                         EDIT0333
           IF LINE-COUNT EQUAL 56 PERFORM TOP-OF-PAGE-ROUTINE.          EDIT0334
           GO TO LISTING-LOOP.                                          EDIT0335
                                                                        EDIT0336
       END-JOB.                                                         EDIT0337
           MOVE "PROGRAM TERMINATION" TO MESSAGE-TEXT.                  EDIT0338
           WRITE COMMENT-LINE FROM MESSAGE-LOG.                         EDIT0339
           CLOSE OLD-VERSION, NEW-VERSION, MODIFICATION, COMMENTARY.    EDIT0340
           STOP RUN.                                                    EDIT0341
                                                                        EDIT0342
       END PROGRAM EDITOR.                                              EDIT0343
])

AT_CHECK([$COMPILE_ONLY -Xref -t prog.lst prog.cob], [0], [],
[prog.cob: 5: warning: AUTHOR is obsolete in GnuCOBOL
prog.cob: 7: warning: DATE-WRITTEN is obsolete in GnuCOBOL
prog.cob: 46: warning: LABEL RECORDS is obsolete in GnuCOBOL
prog.cob: 48: warning: DATA RECORDS is obsolete in GnuCOBOL
prog.cob: 55: warning: LABEL RECORDS is obsolete in GnuCOBOL
prog.cob: 57: warning: DATA RECORDS is obsolete in GnuCOBOL
prog.cob: 64: warning: LABEL RECORDS is obsolete in GnuCOBOL
prog.cob: 66: warning: DATA RECORDS is obsolete in GnuCOBOL
prog.cob: 89: warning: LABEL RECORDS is obsolete in GnuCOBOL
prog.cob: 91: warning: DATA RECORDS is obsolete in GnuCOBOL
prog.cob: in paragraph 'CHANGE-A-RECORD':
prog.cob: 202: warning: ALTER is obsolete in GnuCOBOL
prog.cob: 203: warning: ALTER is obsolete in GnuCOBOL
prog.cob: in paragraph 'INSERT-A-RECORD':
prog.cob: 224: warning: ALTER is obsolete in GnuCOBOL
prog.cob: 225: warning: ALTER is obsolete in GnuCOBOL
prog.cob: in paragraph 'DELETE-A-RECORD':
prog.cob: 258: warning: ALTER is obsolete in GnuCOBOL
])


AT_DATA([prog18.lst],
[GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION DIVISION.
000003         PROGRAM-ID.
000004             EDITOR.
000005         AUTHOR.
warning: AUTHOR is obsolete in GnuCOBOL
000006             J H FORTNER.
000007         DATE-WRITTEN.
warning: DATE-WRITTEN is obsolete in GnuCOBOL
000008             07/23/72.
000009
000010        *NOTE.
000011        *    THIS VERSION OF EDITOR 1 COMPRISES AN ENTIRE RE_WRITE
000012        *    OF THE BASIC EDITOR WITH ONLY ONE CHANGE IN THE COMMAND
000013        *    STRUCTURE, THAT BEING THE ADDITION OF A "CHANGE" COMMAND
000014        *    TO SERVE IN PLACE OF THE INSERT-DELETE COMBINATION WHICH
000015        *    WAS REQUIRED IN PREVIOUS VERSIONS. RECORD NUMBER FIELDS
000016        *    HAVE ALSO BEEN REDUCED FROM 5 DIGITS TO 4.
000017        *    CHANGE 1.
000018        *       MODIFY TO RUN ON TI-990.
000019        *    CHANGE 2.
000020        *       MODIFY TO RUN ON GNUCOBOL.
000021
000022         ENVIRONMENT DIVISION.
000023         CONFIGURATION SECTION.
000024         SOURCE-COMPUTER.
000025             IBM-360.
000026         OBJECT-COMPUTER.
000027             IBM-360.
000028         INPUT-OUTPUT SECTION.
000029         FILE-CONTROL.
000030             SELECT OLD-VERSION  ASSIGN TO "SYSUT1"
000031                                 ORGANIZATION LINE SEQUENTIAL.
000032             SELECT NEW-VERSION  ASSIGN TO "SYSUT2"
000033                                 ORGANIZATION LINE SEQUENTIAL.
000034             SELECT PRT-VERSION  ASSIGN TO "SYSUT2"
000035                                 ORGANIZATION LINE SEQUENTIAL.
000036             SELECT MODIFICATION ASSIGN TO "SYSIN1"
000037                                 ORGANIZATION LINE SEQUENTIAL.
000038             SELECT COMMENTARY   ASSIGN TO "SYSOU1"
000039                                 ORGANIZATION LINE SEQUENTIAL.
000040
000041         DATA DIVISION.
000042
000043         FILE SECTION.
000044
000045         FD  OLD-VERSION
000046             LABEL RECORDS ARE STANDARD
warning: LABEL RECORDS is obsolete in GnuCOBOL
000047             BLOCK CONTAINS 80 CHARACTERS
000048             DATA RECORD IS OLD-RECORD.
warning: DATA RECORDS is obsolete in GnuCOBOL
000049
000050         01  OLD-RECORD.
000051             02 OLD-STATEMENT       PICTURE X(75).
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0002

LINE    PG/LN  A...B............................................................

000052             02 OLD-NUMBER          PICTURE X(5).
000053
000054         FD  NEW-VERSION
000055             LABEL RECORDS ARE STANDARD
warning: LABEL RECORDS is obsolete in GnuCOBOL
000056             BLOCK CONTAINS 80 CHARACTERS
000057             DATA RECORD IS NEW-RECORD.
warning: DATA RECORDS is obsolete in GnuCOBOL
000058
000059         01  NEW-RECORD.
000060             02 NEW-STATEMENT       PICTURE X(75).
000061             02 NEW-NUMBER          PICTURE X(5).
000062
000063         FD  MODIFICATION
000064             LABEL RECORDS ARE OMITTED
warning: LABEL RECORDS is obsolete in GnuCOBOL
000065             BLOCK CONTAINS 80 CHARACTERS
000066             DATA RECORD IS UPDATE-ORDER.
warning: DATA RECORDS is obsolete in GnuCOBOL
000067
000068         01  UPDATE-ORDER.
000069             02 INSERTION.
000070                03 COMMAND          PICTURE X(6).
000071                   88 ENDJOB        VALUE "ENDJOB".
000072                   88 ENDSET        VALUE "ENDSET".
000073                   88 REMOVE        VALUE "REMOVE".
000074                   88 ADDNEW        VALUE "INSERT".
000075                   88 CHANGE        VALUE "CHANGE".
000076                   88 DISPLY        VALUE "DISPLY".
000077                03 FILLER           PICTURE X.
000078                03 A-FIELD          PICTURE 9(5).
000079                03 A-ALPHA REDEFINES A-FIELD    PICTURE X(5).
000080                   88 A-BLANK       VALUE SPACES.
000081                03 FILLER           PICTURE X(4).
000082                03 B-FIELD          PICTURE 9(5).
000083                03 B-ALPHA REDEFINES B-FIELD    PICTURE X(5).
000084                   88 B-BLANK       VALUE SPACES.
000085                03 FILLER           PICTURE X(54).
000086             02 FILLER              PICTURE X(5).
000087
000088         FD  COMMENTARY
000089             LABEL RECORDS ARE OMITTED
warning: LABEL RECORDS is obsolete in GnuCOBOL
000090             BLOCK CONTAINS 82 CHARACTERS
000091             DATA RECORD IS COMMENT-LINE.
warning: DATA RECORDS is obsolete in GnuCOBOL
000092
000093         01  COMMENT-LINE.
000094             02 FILLER              PICTURE X(82).
000095
000096         WORKING-STORAGE SECTION.
000097
000098         77  COMMAND-ADDITIONS      PICTURE 9(3) COMPUTATIONAL VALUE 0.
000099         77  COMMAND-SUBTRACTIONS   PICTURE 9(3) COMPUTATIONAL VALUE 0.
000100         77  TOTAL-INSERTED         PICTURE 9(3) COMPUTATIONAL VALUE 0.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0003

LINE    PG/LN  A...B............................................................

000101         77  TOTAL-DELETED          PICTURE 9(3) COMPUTATIONAL VALUE 0.
000102         77  OUTPUT-COUNT           PICTURE 9(5) COMPUTATIONAL VALUE 0.
000103         77  LINE-COUNT             PICTURE 9(2) COMPUTATIONAL VALUE 0.
000104         77  FIELDA                 PICTURE 9(5) VALUE 0.
000105         77  FIELDB                 PICTURE 9(5) VALUE 0.
000106         77  BLANK-LINE             PICTURE X(82) VALUE SPACES.
000107
000108         01  DATE-FROM-SYS.
000109             02 DFSYS OCCURS 3 TIMES PICTURE 99.
000110
000111         01  HEADINGS-LINE.
000112             02 FILLER              PICTURE X(15) VALUE "EDITOR VERSION".
000113             02 FILLER              PICTURE X(20) VALUE "1.1 - 206/72".
000114             02 PHASE               PICTURE X(17) VALUE "UPDATING AS OF".
000115             02 MONTH-RUN           PICTURE XX.
000116             02 FILLER              PICTURE X VALUE "/".
000117             02 DAY-RUN             PICTURE XX.
000118             02 FILLER              PICTURE X VALUE "/".
000119             02 YEAR-RUN            PICTURE XX.
000120             02 FILLER              PICTURE X(8) VALUE SPACES.
000121             02 FILLER              PICTURE X(8) VALUE "  PAGE: ".
000122             02 PAGE-NUMBER         PICTURE 9(4) VALUE 0.
000123
000124         01  COMMAND-LISTING.
000125             02 FILLER              PICTURE X(2) VALUE SPACES.
000126             02 COMMAND-IMAGE       PICTURE X(80).
000127
000128         01  ACTIVITIES-LISTING.
000129             02 DISPOSITION         PICTURE X(2).
000130             02 ACTIVE-IMAGE        PICTURE X(80).
000131
000132         01  UPSI-BYTE.
000133             02 UPSI-BIT OCCURS 8 TIMES  PICTURE X.
000134
000135         01  MESSAGE-LOG.
000136             02 FILLER              PICTURE X(2) VALUE SPACES.
000137             02 MESSAGE-TEXT        PICTURE X(80).
000138
000139         01  DISPLAY-MESSAGE.
000140             02 FILLER              PICTURE X(2) VALUE SPACES.
000141             02 DISPLAY-TEMP        PICTURE X(6).
000142             02 FILLER              PICTURE X(2) VALUE SPACES.
000143             02 DISPLAY-TEXT        PICTURE X(60).
000144
000145         77  END-JOB-PROCESS        PICTURE 9 VALUE 0.
000146         77  DELETE-PROCESS         PICTURE 9 VALUE 1.
000147         77  INSERT-PROCESS         PICTURE 9 VALUE 2.
000148         77  WRITE-PROCESS          PICTURE 9 VALUE 3.
000149
000150         01  SELECTORS.
000151             02 RETURN-SELECT       PICTURE 9 VALUE 0.
000152             02 NEXT-JOB-SELECT     PICTURE 9 VALUE 0.
000153
000154         PROCEDURE DIVISION.
000155
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0004

LINE    PG/LN  A...B............................................................

000156         START-SECTION.
000157             OPEN INPUT OLD-VERSION, MODIFICATION,
000158                  OUTPUT NEW-VERSION, COMMENTARY.
000159             MOVE "F" TO UPSI-BIT (1), UPSI-BIT (2).
000160             ACCEPT DATE-FROM-SYS FROM DATE.
000161             MOVE DFSYS (1) TO YEAR-RUN.
000162             MOVE DFSYS (2) TO MONTH-RUN.
000163             MOVE DFSYS (3) TO DAY-RUN.
000164             READ OLD-VERSION AT END
000165                MOVE "NO OLD VERSION FOUND" TO MESSAGE-TEXT
000166                WRITE COMMENT-LINE FROM MESSAGE-LOG
000167                GO TO END-JOB.
000168             MOVE OLD-STATEMENT TO NEW-STATEMENT.
000169             PERFORM OUTPUT-A-RECORD.
000170
000171         TOP-OF-PAGE-ROUTINE.
000172             ADD 1 TO PAGE-NUMBER.
000173             MOVE ZERO TO LINE-COUNT.
000174             WRITE COMMENT-LINE FROM HEADINGS-LINE AFTER PAGE.
000175             WRITE COMMENT-LINE FROM BLANK-LINE.
000176
000177         READ-A-COMMAND.
000178             READ MODIFICATION AT END
000179                MOVE "MODIFICATION FILE ENDED " TO MESSAGE-TEXT
000180                WRITE COMMENT-LINE FROM MESSAGE-LOG
000181                GO TO FINISH-JOB.
000182             MOVE UPDATE-ORDER TO COMMAND-IMAGE.
000183             WRITE COMMENT-LINE FROM COMMAND-LISTING.
000184             ADD 2 TO LINE-COUNT.
000185             IF A-BLANK MOVE ZEROES TO A-FIELD.
000186             IF B-BLANK MOVE ZEROES TO B-FIELD.
000187             MOVE A-FIELD TO FIELDA.
000188             MOVE B-FIELD TO FIELDB.
000189
000190         TEST-COMMAND-TYPE.
000191             IF CHANGE GO TO CHANGE-A-RECORD.
000192             IF REMOVE GO TO DELETE-A-RECORD.
000193             IF DISPLY MOVE "T" TO UPSI-BIT (2)
000194                GO TO FINISH-JOB.
000195             IF ENDJOB GO TO FINISH-JOB.
000196             IF ADDNEW GO TO INSERT-A-RECORD.
000197             MOVE "INVALID COMMAND IGNORED." TO MESSAGE-TEXT.
000198             WRITE COMMENT-LINE FROM MESSAGE-LOG.
000199             GO TO READ-A-COMMAND.
000200
000201         CHANGE-A-RECORD.
000202             ALTER RETURN-TO-USER TO PROCEED TO INSERTION-PROCESS.
warning: ALTER is obsolete in GnuCOBOL
000203             ALTER NEXT-JOB-STEP TO PROCEED TO DELETION-PROCESS.
warning: ALTER is obsolete in GnuCOBOL
000204
000205         FIND-FIELDA.
000206             IF OLD-NUMBER IS GREATER THAN FIELDA
000207                MOVE "RECORD ALREADY PASSED" TO MESSAGE-TEXT
000208                WRITE COMMENT-LINE FROM MESSAGE-LOG
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0005

LINE    PG/LN  A...B............................................................

000209                GO TO READ-A-COMMAND.
000210             READ OLD-VERSION AT END
000211                MOVE "NOT FOUND IN OLD VERSION" TO DISPLAY-TEXT
000212                MOVE FIELDA TO DISPLAY-TEMP
000213                WRITE COMMENT-LINE FROM DISPLAY-MESSAGE
000214                GO TO END-JOB.
000215             IF OLD-NUMBER IS LESS THAN FIELDA
000216                MOVE OLD-STATEMENT TO NEW-STATEMENT
000217                PERFORM OUTPUT-A-RECORD
000218                GO TO FIND-FIELDA.
000219
000220         RETURN-TO-USER.
000221             GO TO END-JOB.
000222
000223         INSERT-A-RECORD.
000224             ALTER RETURN-TO-USER TO PROCEED TO INSERTION-PROCESS.
warning: ALTER is obsolete in GnuCOBOL
000225             ALTER NEXT-JOB-STEP TO PROCEED TO FORCED-WRITE.
warning: ALTER is obsolete in GnuCOBOL
000226             GO TO FIND-FIELDA.
000227
000228         INSERTION-PROCESS.
000229             READ MODIFICATION AT END
000230                MOVE "NO ENDSET FOUND" TO MESSAGE-TEXT
000231                WRITE COMMENT-LINE FROM MESSAGE-LOG
000232                GO TO END-JOB.
000233             IF ENDSET
000234                MOVE COMMAND-ADDITIONS TO DISPLAY-TEMP
000235                MOVE "RECORDS INSERTED." TO DISPLAY-TEXT
000236                WRITE COMMENT-LINE FROM DISPLAY-MESSAGE
000237                ADD COMMAND-ADDITIONS TO TOTAL-INSERTED
000238                MOVE ZEROES TO COMMAND-ADDITIONS
000239                GO TO NEXT-JOB-STEP.
000240             MOVE INSERTION TO NEW-STATEMENT, ACTIVE-IMAGE.
000241             MOVE "I " TO DISPOSITION.
000242             PERFORM OUTPUT-A-RECORD.
000243             WRITE COMMENT-LINE FROM ACTIVITIES-LISTING.
000244             ADD 1 TO COMMAND-ADDITIONS.
000245             ADD 1 TO LINE-COUNT.
000246             IF LINE-COUNT EQUAL 56 PERFORM TOP-OF-PAGE-ROUTINE.
000247             GO TO INSERTION-PROCESS.
000248
000249         NEXT-JOB-STEP.
000250             GO TO END-JOB.
000251
000252         FORCED-WRITE.
000253             MOVE OLD-STATEMENT TO NEW-STATEMENT.
000254             PERFORM OUTPUT-A-RECORD.
000255             GO TO READ-A-COMMAND.
000256
000257         DELETE-A-RECORD.
000258             ALTER RETURN-TO-USER TO PROCEED TO DELETION-PROCESS.
warning: ALTER is obsolete in GnuCOBOL
000259             GO TO FIND-FIELDA.
000260
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0006

LINE    PG/LN  A...B............................................................

000261         DELETION-PROCESS.
000262             MOVE OLD-RECORD TO ACTIVE-IMAGE.
000263             MOVE "D " TO DISPOSITION.
000264             WRITE COMMENT-LINE FROM ACTIVITIES-LISTING.
000265             ADD 1 TO LINE-COUNT.
000266             IF LINE-COUNT EQUAL 56 PERFORM TOP-OF-PAGE-ROUTINE.
000267             ADD 1 TO COMMAND-SUBTRACTIONS.
000268             IF OLD-NUMBER IS NOT LESS THAN FIELDB
000269                MOVE COMMAND-SUBTRACTIONS TO DISPLAY-TEMP
000270                MOVE "RECORDS DELETED." TO DISPLAY-TEXT
000271                WRITE COMMENT-LINE FROM DISPLAY-MESSAGE
000272                ADD COMMAND-SUBTRACTIONS TO TOTAL-DELETED
000273                MOVE OLD-STATEMENT TO NEW-STATEMENT
000274                MOVE ZEROES TO COMMAND-SUBTRACTIONS
000275                GO TO READ-A-COMMAND.
000276             READ OLD-VERSION AT END
000277                MOVE "NOT FOUND IN OLD VERSION DOING DELETE"
000278                      TO DISPLAY-TEXT
000279                WRITE COMMENT-LINE FROM DISPLAY-MESSAGE
000280                GO TO END-JOB.
000281             GO TO DELETION-PROCESS.
000282
000283         OUTPUT-A-RECORD.
000284             ADD 1 TO OUTPUT-COUNT.
000285             MOVE OUTPUT-COUNT TO NEW-NUMBER.
000286             WRITE NEW-RECORD.
000287
000288         FINISH-JOB.
000289             READ OLD-VERSION AT END GO TO TEST-FOR-LISTING.
000290             MOVE OLD-STATEMENT TO NEW-STATEMENT.
000291             GO TO OUTPUT-A-RECORD.
000292
000293         TEST-FOR-LISTING.
000294             PERFORM TOP-OF-PAGE-ROUTINE.
000295             MOVE OLD-NUMBER TO DISPLAY-TEMP.
000296             MOVE "RECORDS READ." TO DISPLAY-TEXT.
000297             WRITE COMMENT-LINE FROM DISPLAY-MESSAGE.
000298             MOVE TOTAL-INSERTED TO DISPLAY-TEMP.
000299             MOVE "RECORDS ADDED." TO DISPLAY-TEXT.
000300             WRITE COMMENT-LINE FROM DISPLAY-MESSAGE.
000301             MOVE TOTAL-DELETED TO DISPLAY-TEMP.
000302             MOVE "RECORDS DROPPED." TO DISPLAY-TEXT.
000303             WRITE COMMENT-LINE FROM DISPLAY-MESSAGE.
000304             MOVE OUTPUT-COUNT TO DISPLAY-TEMP.
000305             MOVE "RECORDS IN NEW FILE." TO DISPLAY-TEXT.
000306             WRITE COMMENT-LINE FROM DISPLAY-MESSAGE.
000307             IF UPSI-BIT (2) EQUAL "F" GO TO END-JOB.
000308             CLOSE NEW-VERSION.
000309             OPEN INPUT NEW-VERSION.
000310             MOVE "UPDATED LISTING" TO PHASE.
000311             MOVE ZEROES TO PAGE-NUMBER.
000312             PERFORM TOP-OF-PAGE-ROUTINE.
000313             MOVE SPACES TO DISPOSITION.
000314
000315         LISTING-LOOP.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0007

LINE    PG/LN  A...B............................................................

000316             READ NEW-VERSION AT END GO TO END-JOB.
000317             MOVE NEW-RECORD TO ACTIVE-IMAGE.
000318             WRITE COMMENT-LINE FROM ACTIVITIES-LISTING.
000319             ADD 1 TO LINE-COUNT.
000320             IF LINE-COUNT EQUAL 56 PERFORM TOP-OF-PAGE-ROUTINE.
000321             GO TO LISTING-LOOP.
000322
000323         END-JOB.
000324             MOVE "PROGRAM TERMINATION" TO MESSAGE-TEXT.
000325             WRITE COMMENT-LINE FROM MESSAGE-LOG.
000326             CLOSE OLD-VERSION, NEW-VERSION, MODIFICATION, COMMENTARY.
000327             STOP RUN.
000328
000329         END PROGRAM EDITOR.
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0008

SIZE TYPE           LVL  NAME                           PICTURE

0080 FILE                OLD-VERSION
0080 GROUP          01   OLD-RECORD
0075 ALPHANUMERIC   02     OLD-STATEMENT                X(75)
0005 ALPHANUMERIC   02     OLD-NUMBER                   X(5)

0080 FILE                NEW-VERSION
0080 GROUP          01   NEW-RECORD
0075 ALPHANUMERIC   02     NEW-STATEMENT                X(75)
0005 ALPHANUMERIC   02     NEW-NUMBER                   X(5)

0032 FILE                PRT-VERSION

0080 FILE                MODIFICATION
0080 GROUP          01   UPDATE-ORDER
0075 ALPHANUMERIC   02     INSERTION
0006 ALPHANUMERIC   03       COMMAND                    X(6)
     CONDITIONAL    88         ENDJOB
     CONDITIONAL    88         ENDSET
     CONDITIONAL    88         REMOVE
     CONDITIONAL    88         ADDNEW
     CONDITIONAL    88         CHANGE
     CONDITIONAL    88         DISPLY
0001 ALPHANUMERIC   03       FILLER                     X
0005 NUMERIC        03       A-FIELD                    9(5)
0005 ALPHANUMERIC-R 03       A-ALPHA                    X(5)
     CONDITIONAL    88         A-BLANK
0004 ALPHANUMERIC   03       FILLER                     X(4)
0005 NUMERIC        03       B-FIELD                    9(5)
0005 ALPHANUMERIC-R 03       B-ALPHA                    X(5)
     CONDITIONAL    88         B-BLANK
0054 ALPHANUMERIC   03       FILLER                     X(54)
0005 ALPHANUMERIC   02     FILLER                       X(5)

0082 FILE                COMMENTARY
0082 GROUP          01   COMMENT-LINE
0082 ALPHANUMERIC   02     FILLER                       X(82)

0002 NUMERIC        77   COMMAND-ADDITIONS              9(3) COMP
0002 NUMERIC        77   COMMAND-SUBTRACTIONS           9(3) COMP
0002 NUMERIC        77   TOTAL-INSERTED                 9(3) COMP
0002 NUMERIC        77   TOTAL-DELETED                  9(3) COMP
0004 NUMERIC        77   OUTPUT-COUNT                   9(5) COMP
0001 NUMERIC        77   LINE-COUNT                     9(2) COMP
0005 NUMERIC        77   FIELDA                         9(5)
0005 NUMERIC        77   FIELDB                         9(5)
0082 ALPHANUMERIC   77   BLANK-LINE                     X(82)

0006 GROUP          01   DATE-FROM-SYS
0002 NUMERIC        02     DFSYS                        99

0080 GROUP          01   HEADINGS-LINE
0015 ALPHANUMERIC   02     FILLER                       X(15)
0020 ALPHANUMERIC   02     FILLER                       X(20)
0017 ALPHANUMERIC   02     PHASE                        X(17)
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0009

SIZE TYPE           LVL  NAME                           PICTURE

0002 ALPHANUMERIC   02     MONTH-RUN                    XX
0001 ALPHANUMERIC   02     FILLER                       X
0002 ALPHANUMERIC   02     DAY-RUN                      XX
0001 ALPHANUMERIC   02     FILLER                       X
0002 ALPHANUMERIC   02     YEAR-RUN                     XX
0008 ALPHANUMERIC   02     FILLER                       X(8)
0008 ALPHANUMERIC   02     FILLER                       X(8)
0004 NUMERIC        02     PAGE-NUMBER                  9(4)

0082 GROUP          01   COMMAND-LISTING
0002 ALPHANUMERIC   02     FILLER                       X(2)
0080 ALPHANUMERIC   02     COMMAND-IMAGE                X(80)

0082 GROUP          01   ACTIVITIES-LISTING
0002 ALPHANUMERIC   02     DISPOSITION                  X(2)
0080 ALPHANUMERIC   02     ACTIVE-IMAGE                 X(80)

0008 GROUP          01   UPSI-BYTE
0001 ALPHANUMERIC   02     UPSI-BIT                     X

0082 GROUP          01   MESSAGE-LOG
0002 ALPHANUMERIC   02     FILLER                       X(2)
0080 ALPHANUMERIC   02     MESSAGE-TEXT                 X(80)

0070 GROUP          01   DISPLAY-MESSAGE
0002 ALPHANUMERIC   02     FILLER                       X(2)
0006 ALPHANUMERIC   02     DISPLAY-TEMP                 X(6)
0002 ALPHANUMERIC   02     FILLER                       X(2)
0060 ALPHANUMERIC   02     DISPLAY-TEXT                 X(60)

0001 NUMERIC        77   END-JOB-PROCESS                9
0001 NUMERIC        77   DELETE-PROCESS                 9
0001 NUMERIC        77   INSERT-PROCESS                 9
0001 NUMERIC        77   WRITE-PROCESS                  9

0002 GROUP          01   SELECTORS
0001 NUMERIC        02     RETURN-SELECT                9
0001 NUMERIC        02     NEXT-JOB-SELECT              9

GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0010

NAME                           DEFINED                REFERENCES

OLD-VERSION                     000030  000045  000158  000164  000210  000276
                                        000289  000326
OLD-RECORD                      000050  000262
OLD-STATEMENT                   000051  000168  000216  000253  000273  000290
OLD-NUMBER                      000052  000206  000215  000268  000295

NEW-VERSION                     000032  000054  000158  000286  000308  000309
                                        000316  000326
NEW-RECORD                      000059  000286  000317
NEW-STATEMENT                   000060  000168  000216  000240  000253  000273
                                        000290
NEW-NUMBER                      000061  000285

PRT-VERSION                     000034

MODIFICATION                    000036  000063  000158  000178  000229  000326
UPDATE-ORDER                    000068  000182
INSERTION                       000069  000240
COMMAND                         000070
ENDJOB                          000071  000195
ENDSET                          000072  000233
REMOVE                          000073  000192
ADDNEW                          000074  000196
CHANGE                          000075  000191
DISPLY                          000076  000193
A-FIELD                         000078  000185  000187
A-ALPHA                         000079
A-BLANK                         000080  000185
B-FIELD                         000082  000186  000188
B-ALPHA                         000083
B-BLANK                         000084  000186

COMMENTARY                      000038  000088  000158  000166  000174  000175
                                        000180  000183  000198  000208  000213
                                        000231  000236  000243  000264  000271
                                        000279  000297  000300  000303  000306
                                        000318  000325  000326
COMMENT-LINE                    000093  000166  000174  000175  000180  000183
                                        000198  000208  000213  000231  000236
                                        000243  000264  000271  000279  000297
                                        000300  000303  000306  000318  000325

COMMAND-ADDITIONS               000098  000234  000237  000238  000244
COMMAND-SUBTRACTIONS            000099  000267  000269  000272  000274
TOTAL-INSERTED                  000100  000237  000298
TOTAL-DELETED                   000101  000272  000301
OUTPUT-COUNT                    000102  000284  000285  000304
LINE-COUNT                      000103  000173  000184  000245  000246  000265
                                        000266  000319  000320
FIELDA                          000104  000187  000206  000212  000215
FIELDB                          000105  000188  000268
BLANK-LINE                      000106  000175
DATE-FROM-SYS                   000108  000160
DFSYS                           000109  000161  000162  000163
GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0011

NAME                           DEFINED                REFERENCES

HEADINGS-LINE                   000111  000174
PHASE                           000114  000310
MONTH-RUN                       000115  000162
DAY-RUN                         000117  000163
YEAR-RUN                        000119  000161
PAGE-NUMBER                     000122  000172  000311
COMMAND-LISTING                 000124  000183
COMMAND-IMAGE                   000126  000182
ACTIVITIES-LISTING              000128  000243  000264  000318
DISPOSITION                     000129  000241  000263  000313
ACTIVE-IMAGE                    000130  000240  000262  000317
UPSI-BYTE                       000132
UPSI-BIT                        000133  000159  000193  000307
MESSAGE-LOG                     000135  000166  000180  000198  000208  000231
                                        000325
MESSAGE-TEXT                    000137  000165  000179  000197  000207  000230
                                        000324
DISPLAY-MESSAGE                 000139  000213  000236  000271  000279  000297
                                        000300  000303  000306
DISPLAY-TEMP                    000141  000212  000234  000269  000295  000298
                                        000301  000304
DISPLAY-TEXT                    000143  000211  000235  000270  000277  000296
                                        000299  000302  000305
END-JOB-PROCESS                 000145
DELETE-PROCESS                  000146
INSERT-PROCESS                  000147
WRITE-PROCESS                   000148
SELECTORS                       000150
RETURN-SELECT                   000151
NEXT-JOB-SELECT                 000152

GnuCOBOL V.R.P          prog.cob             DDD MMM dd HH:MM:SS YYYY  Page 0012

LABEL                          DEFINED                REFERENCES

START-SECTION                   000156
TOP-OF-PAGE-ROUTINE             000171  000246  000266  000294  000312  000320
READ-A-COMMAND                  000177  000199  000209  000255  000275
TEST-COMMAND-TYPE               000190
CHANGE-A-RECORD                 000201  000191
FIND-FIELDA                     000205  000218  000226  000259
RETURN-TO-USER                  000220  000202  000224  000258
INSERT-A-RECORD                 000223  000196
INSERTION-PROCESS               000228  000202  000224  000247
NEXT-JOB-STEP                   000249  000203  000225  000239
FORCED-WRITE                    000252  000225
DELETE-A-RECORD                 000257  000192
DELETION-PROCESS                000261  000203  000258  000281
OUTPUT-A-RECORD                 000283  000169  000217  000242  000254  000291
FINISH-JOB                      000288  000181  000194  000195
TEST-FOR-LISTING                000293  000289
LISTING-LOOP                    000315  000321
END-JOB                         000323  000167  000214  000221  000232  000250
                                        000280  000307  000316

15 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog18.lst prog.lis], [0], [], [])

AT_CHECK([$COMPILE_ONLY -Xref -T prog.lst prog.cob], [0], [],
[prog.cob: 5: warning: AUTHOR is obsolete in GnuCOBOL
prog.cob: 7: warning: DATE-WRITTEN is obsolete in GnuCOBOL
prog.cob: 46: warning: LABEL RECORDS is obsolete in GnuCOBOL
prog.cob: 48: warning: DATA RECORDS is obsolete in GnuCOBOL
prog.cob: 55: warning: LABEL RECORDS is obsolete in GnuCOBOL
prog.cob: 57: warning: DATA RECORDS is obsolete in GnuCOBOL
prog.cob: 64: warning: LABEL RECORDS is obsolete in GnuCOBOL
prog.cob: 66: warning: DATA RECORDS is obsolete in GnuCOBOL
prog.cob: 89: warning: LABEL RECORDS is obsolete in GnuCOBOL
prog.cob: 91: warning: DATA RECORDS is obsolete in GnuCOBOL
prog.cob: in paragraph 'CHANGE-A-RECORD':
prog.cob: 202: warning: ALTER is obsolete in GnuCOBOL
prog.cob: 203: warning: ALTER is obsolete in GnuCOBOL
prog.cob: in paragraph 'INSERT-A-RECORD':
prog.cob: 224: warning: ALTER is obsolete in GnuCOBOL
prog.cob: 225: warning: ALTER is obsolete in GnuCOBOL
prog.cob: in paragraph 'DELETE-A-RECORD':
prog.cob: 258: warning: ALTER is obsolete in GnuCOBOL
])


AT_DATA([prog19.lst],
[GnuCOBOL V.R.P          prog.cob                                                     DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................SEQUENCE

000001
000002         IDENTIFICATION DIVISION.                                         EDIT0001
000003         PROGRAM-ID.                                                      EDIT0002
000004             EDITOR.                                                      EDIT0003
000005         AUTHOR.                                                          EDIT0004
warning: AUTHOR is obsolete in GnuCOBOL
000006             J H FORTNER.                                                 EDIT0005
000007         DATE-WRITTEN.                                                    EDIT0006
warning: DATE-WRITTEN is obsolete in GnuCOBOL
000008             07/23/72.                                                    EDIT0007
000009                                                                          EDIT0008
000010        *NOTE.                                                            EDIT0009
000011        *    THIS VERSION OF EDITOR 1 COMPRISES AN ENTIRE RE_WRITE        EDIT0010
000012        *    OF THE BASIC EDITOR WITH ONLY ONE CHANGE IN THE COMMAND      EDIT0011
000013        *    STRUCTURE, THAT BEING THE ADDITION OF A "CHANGE" COMMAND     EDIT0012
000014        *    TO SERVE IN PLACE OF THE INSERT-DELETE COMBINATION WHICH     EDIT0013
000015        *    WAS REQUIRED IN PREVIOUS VERSIONS. RECORD NUMBER FIELDS      EDIT0014
000016        *    HAVE ALSO BEEN REDUCED FROM 5 DIGITS TO 4.                   EDIT0015
000017        *    CHANGE 1.                                                    EDIT0016
000018        *       MODIFY TO RUN ON TI-990.                                  EDIT0017
000019        *    CHANGE 2.                                                    EDIT0018
000020        *       MODIFY TO RUN ON GNUCOBOL.                                EDIT0019
000021                                                                          EDIT0020
000022         ENVIRONMENT DIVISION.                                            EDIT0021
000023         CONFIGURATION SECTION.                                           EDIT0022
000024         SOURCE-COMPUTER.                                                 EDIT0023
000025             IBM-360.                                                     EDIT0024
000026         OBJECT-COMPUTER.                                                 EDIT0025
000027             IBM-360.                                                     EDIT0026
000028         INPUT-OUTPUT SECTION.                                            EDIT0027
000029         FILE-CONTROL.                                                    EDIT0028
000030             SELECT OLD-VERSION  ASSIGN TO "SYSUT1"                       EDIT0029
000031                                 ORGANIZATION LINE SEQUENTIAL.            EDIT0030
000032             SELECT NEW-VERSION  ASSIGN TO "SYSUT2"                       EDIT0031
000033                                 ORGANIZATION LINE SEQUENTIAL.            EDIT0032
000034             SELECT PRT-VERSION  ASSIGN TO "SYSUT2"                       EDIT0033
000035                                 ORGANIZATION LINE SEQUENTIAL.            EDIT0034
000036             SELECT MODIFICATION ASSIGN TO "SYSIN1"                       EDIT0035
000037                                 ORGANIZATION LINE SEQUENTIAL.            EDIT0036
000038             SELECT COMMENTARY   ASSIGN TO "SYSOU1"                       EDIT0037
000039                                 ORGANIZATION LINE SEQUENTIAL.            EDIT0038
000040                                                                          EDIT0039
000041         DATA DIVISION.                                                   EDIT0040
000042                                                                          EDIT0041
000043         FILE SECTION.                                                    EDIT0042
000044                                                                          EDIT0043
000045         FD  OLD-VERSION                                                  EDIT0044
000046             LABEL RECORDS ARE STANDARD                                   EDIT0045
warning: LABEL RECORDS is obsolete in GnuCOBOL
000047             BLOCK CONTAINS 80 CHARACTERS                                 EDIT0046
000048             DATA RECORD IS OLD-RECORD.                                   EDIT0047
warning: DATA RECORDS is obsolete in GnuCOBOL
000049                                                                          EDIT0048
000050         01  OLD-RECORD.                                                  EDIT0049
000051             02 OLD-STATEMENT       PICTURE X(75).                        EDIT0050
GnuCOBOL V.R.P          prog.cob                                                     DDD MMM dd HH:MM:SS YYYY  Page 0002

LINE    PG/LN  A...B............................................................SEQUENCE

000052             02 OLD-NUMBER          PICTURE X(5).                         EDIT0051
000053                                                                          EDIT0052
000054         FD  NEW-VERSION                                                  EDIT0053
000055             LABEL RECORDS ARE STANDARD                                   EDIT0054
warning: LABEL RECORDS is obsolete in GnuCOBOL
000056             BLOCK CONTAINS 80 CHARACTERS                                 EDIT0055
000057             DATA RECORD IS NEW-RECORD.                                   EDIT0056
warning: DATA RECORDS is obsolete in GnuCOBOL
000058                                                                          EDIT0057
000059         01  NEW-RECORD.                                                  EDIT0058
000060             02 NEW-STATEMENT       PICTURE X(75).                        EDIT0059
000061             02 NEW-NUMBER          PICTURE X(5).                         EDIT0060
000062                                                                          EDIT0061
000063         FD  MODIFICATION                                                 EDIT0062
000064             LABEL RECORDS ARE OMITTED                                    EDIT0063
warning: LABEL RECORDS is obsolete in GnuCOBOL
000065             BLOCK CONTAINS 80 CHARACTERS                                 EDIT0064
000066             DATA RECORD IS UPDATE-ORDER.                                 EDIT0065
warning: DATA RECORDS is obsolete in GnuCOBOL
000067                                                                          EDIT0066
000068         01  UPDATE-ORDER.                                                EDIT0067
000069             02 INSERTION.                                                EDIT0068
000070                03 COMMAND          PICTURE X(6).                         EDIT0069
000071                   88 ENDJOB        VALUE "ENDJOB".                       EDIT0070
000072                   88 ENDSET        VALUE "ENDSET".                       EDIT0071
000073                   88 REMOVE        VALUE "REMOVE".                       EDIT0072
000074                   88 ADDNEW        VALUE "INSERT".                       EDIT0073
000075                   88 CHANGE        VALUE "CHANGE".                       EDIT0074
000076                   88 DISPLY        VALUE "DISPLY".                       EDIT0075
000077                03 FILLER           PICTURE X.                            EDIT0076
000078                03 A-FIELD          PICTURE 9(5).                         EDIT0077
000079                03 A-ALPHA REDEFINES A-FIELD    PICTURE X(5).             EDIT0078
000080                   88 A-BLANK       VALUE SPACES.                         EDIT0079
000081                03 FILLER           PICTURE X(4).                         EDIT0080
000082                03 B-FIELD          PICTURE 9(5).                         EDIT0081
000083                03 B-ALPHA REDEFINES B-FIELD    PICTURE X(5).             EDIT0082
000084                   88 B-BLANK       VALUE SPACES.                         EDIT0083
000085                03 FILLER           PICTURE X(54).                        EDIT0084
000086             02 FILLER              PICTURE X(5).                         EDIT0085
000087                                                                          EDIT0086
000088         FD  COMMENTARY                                                   EDIT0087
000089             LABEL RECORDS ARE OMITTED                                    EDIT0088
warning: LABEL RECORDS is obsolete in GnuCOBOL
000090             BLOCK CONTAINS 82 CHARACTERS                                 EDIT0089
000091             DATA RECORD IS COMMENT-LINE.                                 EDIT0090
warning: DATA RECORDS is obsolete in GnuCOBOL
000092                                                                          EDIT0091
000093         01  COMMENT-LINE.                                                EDIT0092
000094             02 FILLER              PICTURE X(82).                        EDIT0093
000095                                                                          EDIT0094
000096         WORKING-STORAGE SECTION.                                         EDIT0095
000097                                                                          EDIT0096
000098         77  COMMAND-ADDITIONS      PICTURE 9(3) COMPUTATIONAL VALUE 0.   EDIT0097
000099         77  COMMAND-SUBTRACTIONS   PICTURE 9(3) COMPUTATIONAL VALUE 0.   EDIT0098
000100         77  TOTAL-INSERTED         PICTURE 9(3) COMPUTATIONAL VALUE 0.   EDIT0099
GnuCOBOL V.R.P          prog.cob                                                     DDD MMM dd HH:MM:SS YYYY  Page 0003

LINE    PG/LN  A...B............................................................SEQUENCE

000101         77  TOTAL-DELETED          PICTURE 9(3) COMPUTATIONAL VALUE 0.   EDIT0100
000102         77  OUTPUT-COUNT           PICTURE 9(5) COMPUTATIONAL VALUE 0.   EDIT0101
000103         77  LINE-COUNT             PICTURE 9(2) COMPUTATIONAL VALUE 0.   EDIT0102
000104         77  FIELDA                 PICTURE 9(5) VALUE 0.                 EDIT0103
000105         77  FIELDB                 PICTURE 9(5) VALUE 0.                 EDIT0104
000106         77  BLANK-LINE             PICTURE X(82) VALUE SPACES.           EDIT0105
000107                                                                          EDIT0106
000108         01  DATE-FROM-SYS.                                               EDIT0107
000109             02 DFSYS OCCURS 3 TIMES PICTURE 99.                          EDIT0108
000110                                                                          EDIT0109
000111         01  HEADINGS-LINE.                                               EDIT0110
000112             02 FILLER              PICTURE X(15) VALUE "EDITOR VERSION". EDIT0111
000113             02 FILLER              PICTURE X(20) VALUE "1.1 - 206/72".   EDIT0112
000114             02 PHASE               PICTURE X(17) VALUE "UPDATING AS OF". EDIT0113
000115             02 MONTH-RUN           PICTURE XX.                           EDIT0114
000116             02 FILLER              PICTURE X VALUE "/".                  EDIT0115
000117             02 DAY-RUN             PICTURE XX.                           EDIT0116
000118             02 FILLER              PICTURE X VALUE "/".                  EDIT0117
000119             02 YEAR-RUN            PICTURE XX.                           EDIT0118
000120             02 FILLER              PICTURE X(8) VALUE SPACES.            EDIT0119
000121             02 FILLER              PICTURE X(8) VALUE "  PAGE: ".        EDIT0120
000122             02 PAGE-NUMBER         PICTURE 9(4) VALUE 0.                 EDIT0121
000123                                                                          EDIT0122
000124         01  COMMAND-LISTING.                                             EDIT0123
000125             02 FILLER              PICTURE X(2) VALUE SPACES.            EDIT0124
000126             02 COMMAND-IMAGE       PICTURE X(80).                        EDIT0125
000127                                                                          EDIT0126
000128         01  ACTIVITIES-LISTING.                                          EDIT0127
000129             02 DISPOSITION         PICTURE X(2).                         EDIT0128
000130             02 ACTIVE-IMAGE        PICTURE X(80).                        EDIT0129
000131                                                                          EDIT0130
000132         01  UPSI-BYTE.                                                   EDIT0131
000133             02 UPSI-BIT OCCURS 8 TIMES  PICTURE X.                       EDIT0132
000134                                                                          EDIT0133
000135         01  MESSAGE-LOG.                                                 EDIT0134
000136             02 FILLER              PICTURE X(2) VALUE SPACES.            EDIT0135
000137             02 MESSAGE-TEXT        PICTURE X(80).                        EDIT0136
000138                                                                          EDIT0137
000139         01  DISPLAY-MESSAGE.                                             EDIT0138
000140             02 FILLER              PICTURE X(2) VALUE SPACES.            EDIT0139
000141             02 DISPLAY-TEMP        PICTURE X(6).                         EDIT0140
000142             02 FILLER              PICTURE X(2) VALUE SPACES.            EDIT0141
000143             02 DISPLAY-TEXT        PICTURE X(60).                        EDIT0142
000144                                                                          EDIT0143
000145         77  END-JOB-PROCESS        PICTURE 9 VALUE 0.                    EDIT0144
000146         77  DELETE-PROCESS         PICTURE 9 VALUE 1.                    EDIT0145
000147         77  INSERT-PROCESS         PICTURE 9 VALUE 2.                    EDIT0146
000148         77  WRITE-PROCESS          PICTURE 9 VALUE 3.                    EDIT0147
000149                                                                          EDIT0148
000150         01  SELECTORS.                                                   EDIT0149
000151             02 RETURN-SELECT       PICTURE 9 VALUE 0.                    EDIT0150
000152             02 NEXT-JOB-SELECT     PICTURE 9 VALUE 0.                    EDIT0151
000153                                                                          EDIT0152
000154         PROCEDURE DIVISION.                                              EDIT0153
000155                                                                          EDIT0154
GnuCOBOL V.R.P          prog.cob                                                     DDD MMM dd HH:MM:SS YYYY  Page 0004

LINE    PG/LN  A...B............................................................SEQUENCE

000156         START-SECTION.                                                   EDIT0155
000157             OPEN INPUT OLD-VERSION, MODIFICATION,                        EDIT0156
000158                  OUTPUT NEW-VERSION, COMMENTARY.                         EDIT0157
000159             MOVE "F" TO UPSI-BIT (1), UPSI-BIT (2).                      EDIT0158
000160             ACCEPT DATE-FROM-SYS FROM DATE.                              EDIT0159
000161             MOVE DFSYS (1) TO YEAR-RUN.                                  EDIT0160
000162             MOVE DFSYS (2) TO MONTH-RUN.                                 EDIT0161
000163             MOVE DFSYS (3) TO DAY-RUN.                                   EDIT0162
000164             READ OLD-VERSION AT END                                      EDIT0163
000165                MOVE "NO OLD VERSION FOUND" TO MESSAGE-TEXT               EDIT0164
000166                WRITE COMMENT-LINE FROM MESSAGE-LOG                       EDIT0165
000167                GO TO END-JOB.                                            EDIT0166
000168             MOVE OLD-STATEMENT TO NEW-STATEMENT.                         EDIT0167
000169             PERFORM OUTPUT-A-RECORD.                                     EDIT0168
000170                                                                          EDIT0169
000171         TOP-OF-PAGE-ROUTINE.                                             EDIT0170
000172             ADD 1 TO PAGE-NUMBER.                                        EDIT0171
000173             MOVE ZERO TO LINE-COUNT.                                     EDIT0172
000174             WRITE COMMENT-LINE FROM HEADINGS-LINE AFTER PAGE.            EDIT0173
000175             WRITE COMMENT-LINE FROM BLANK-LINE.                          EDIT0174
000176                                                                          EDIT0175
000177         READ-A-COMMAND.                                                  EDIT0176
000178             READ MODIFICATION AT END                                     EDIT0177
000179                MOVE "MODIFICATION FILE ENDED " TO MESSAGE-TEXT           EDIT0178
000180                WRITE COMMENT-LINE FROM MESSAGE-LOG                       EDIT0179
000181                GO TO FINISH-JOB.                                         EDIT0180
000182             MOVE UPDATE-ORDER TO COMMAND-IMAGE.                          EDIT0181
000183             WRITE COMMENT-LINE FROM COMMAND-LISTING.                     EDIT0182
000184             ADD 2 TO LINE-COUNT.                                         EDIT0183
000185             IF A-BLANK MOVE ZEROES TO A-FIELD.                           EDIT0184
000186             IF B-BLANK MOVE ZEROES TO B-FIELD.                           EDIT0185
000187             MOVE A-FIELD TO FIELDA.                                      EDIT0186
000188             MOVE B-FIELD TO FIELDB.                                      EDIT0187
000189                                                                          EDIT0188
000190         TEST-COMMAND-TYPE.                                               EDIT0189
000191             IF CHANGE GO TO CHANGE-A-RECORD.                             EDIT0190
000192             IF REMOVE GO TO DELETE-A-RECORD.                             EDIT0191
000193             IF DISPLY MOVE "T" TO UPSI-BIT (2)                           EDIT0192
000194                GO TO FINISH-JOB.                                         EDIT0193
000195             IF ENDJOB GO TO FINISH-JOB.                                  EDIT0194
000196             IF ADDNEW GO TO INSERT-A-RECORD.                             EDIT0195
000197             MOVE "INVALID COMMAND IGNORED." TO MESSAGE-TEXT.             EDIT0196
000198             WRITE COMMENT-LINE FROM MESSAGE-LOG.                         EDIT0197
000199             GO TO READ-A-COMMAND.                                        EDIT0198
000200                                                                          EDIT0199
000201         CHANGE-A-RECORD.                                                 EDIT0200
000202             ALTER RETURN-TO-USER TO PROCEED TO INSERTION-PROCESS.        EDIT0201
warning: ALTER is obsolete in GnuCOBOL
000203             ALTER NEXT-JOB-STEP TO PROCEED TO DELETION-PROCESS.          EDIT0202
warning: ALTER is obsolete in GnuCOBOL
000204                                                                          EDIT0205
000205         FIND-FIELDA.                                                     EDIT0206
000206             IF OLD-NUMBER IS GREATER THAN FIELDA                         EDIT0207
000207                MOVE "RECORD ALREADY PASSED" TO MESSAGE-TEXT              EDIT0208
000208                WRITE COMMENT-LINE FROM MESSAGE-LOG                       EDIT0209
GnuCOBOL V.R.P          prog.cob                                                     DDD MMM dd HH:MM:SS YYYY  Page 0005

LINE    PG/LN  A...B............................................................SEQUENCE

000209                GO TO READ-A-COMMAND.                                     EDIT0210
000210             READ OLD-VERSION AT END                                      EDIT0211
000211                MOVE "NOT FOUND IN OLD VERSION" TO DISPLAY-TEXT           EDIT0212
000212                MOVE FIELDA TO DISPLAY-TEMP                               EDIT0213
000213                WRITE COMMENT-LINE FROM DISPLAY-MESSAGE                   EDIT0214
000214                GO TO END-JOB.                                            EDIT0215
000215             IF OLD-NUMBER IS LESS THAN FIELDA                            EDIT0216
000216                MOVE OLD-STATEMENT TO NEW-STATEMENT                       EDIT0217
000217                PERFORM OUTPUT-A-RECORD                                   EDIT0218
000218                GO TO FIND-FIELDA.                                        EDIT0219
000219                                                                          EDIT0220
000220         RETURN-TO-USER.                                                  EDIT0221
000221             GO TO END-JOB.                                               EDIT0223
000222                                                                          EDIT0228
000223         INSERT-A-RECORD.                                                 EDIT0229
000224             ALTER RETURN-TO-USER TO PROCEED TO INSERTION-PROCESS.        EDIT0230
warning: ALTER is obsolete in GnuCOBOL
000225             ALTER NEXT-JOB-STEP TO PROCEED TO FORCED-WRITE.              EDIT0231
warning: ALTER is obsolete in GnuCOBOL
000226             GO TO FIND-FIELDA.                                           EDIT0234
000227                                                                          EDIT0235
000228         INSERTION-PROCESS.                                               EDIT0236
000229             READ MODIFICATION AT END                                     EDIT0237
000230                MOVE "NO ENDSET FOUND" TO MESSAGE-TEXT                    EDIT0238
000231                WRITE COMMENT-LINE FROM MESSAGE-LOG                       EDIT0239
000232                GO TO END-JOB.                                            EDIT0240
000233             IF ENDSET                                                    EDIT0241
000234                MOVE COMMAND-ADDITIONS TO DISPLAY-TEMP                    EDIT0242
000235                MOVE "RECORDS INSERTED." TO DISPLAY-TEXT                  EDIT0243
000236                WRITE COMMENT-LINE FROM DISPLAY-MESSAGE                   EDIT0244
000237                ADD COMMAND-ADDITIONS TO TOTAL-INSERTED                   EDIT0245
000238                MOVE ZEROES TO COMMAND-ADDITIONS                          EDIT0246
000239                GO TO NEXT-JOB-STEP.                                      EDIT0247
000240             MOVE INSERTION TO NEW-STATEMENT, ACTIVE-IMAGE.               EDIT0248
000241             MOVE "I " TO DISPOSITION.                                    EDIT0249
000242             PERFORM OUTPUT-A-RECORD.                                     EDIT0250
000243             WRITE COMMENT-LINE FROM ACTIVITIES-LISTING.                  EDIT0251
000244             ADD 1 TO COMMAND-ADDITIONS.                                  EDIT0252
000245             ADD 1 TO LINE-COUNT.                                         EDIT0253
000246             IF LINE-COUNT EQUAL 56 PERFORM TOP-OF-PAGE-ROUTINE.          EDIT0254
000247             GO TO INSERTION-PROCESS.                                     EDIT0255
000248                                                                          EDIT0256
000249         NEXT-JOB-STEP.                                                   EDIT0257
000250             GO TO END-JOB.                                               EDIT0259
000251                                                                          EDIT0264
000252         FORCED-WRITE.                                                    EDIT0265
000253             MOVE OLD-STATEMENT TO NEW-STATEMENT.                         EDIT0266
000254             PERFORM OUTPUT-A-RECORD.                                     EDIT0267
000255             GO TO READ-A-COMMAND.                                        EDIT0268
000256                                                                          EDIT0269
000257         DELETE-A-RECORD.                                                 EDIT0270
000258             ALTER RETURN-TO-USER TO PROCEED TO DELETION-PROCESS.         EDIT0271
warning: ALTER is obsolete in GnuCOBOL
000259             GO TO FIND-FIELDA.                                           EDIT0273
000260                                                                          EDIT0274
GnuCOBOL V.R.P          prog.cob                                                     DDD MMM dd HH:MM:SS YYYY  Page 0006

LINE    PG/LN  A...B............................................................SEQUENCE

000261         DELETION-PROCESS.                                                EDIT0275
000262             MOVE OLD-RECORD TO ACTIVE-IMAGE.                             EDIT0276
000263             MOVE "D " TO DISPOSITION.                                    EDIT0277
000264             WRITE COMMENT-LINE FROM ACTIVITIES-LISTING.                  EDIT0278
000265             ADD 1 TO LINE-COUNT.                                         EDIT0279
000266             IF LINE-COUNT EQUAL 56 PERFORM TOP-OF-PAGE-ROUTINE.          EDIT0280
000267             ADD 1 TO COMMAND-SUBTRACTIONS.                               EDIT0281
000268             IF OLD-NUMBER IS NOT LESS THAN FIELDB                        EDIT0282
000269                MOVE COMMAND-SUBTRACTIONS TO DISPLAY-TEMP                 EDIT0283
000270                MOVE "RECORDS DELETED." TO DISPLAY-TEXT                   EDIT0284
000271                WRITE COMMENT-LINE FROM DISPLAY-MESSAGE                   EDIT0285
000272                ADD COMMAND-SUBTRACTIONS TO TOTAL-DELETED                 EDIT0286
000273                MOVE OLD-STATEMENT TO NEW-STATEMENT                       EDIT0287
000274                MOVE ZEROES TO COMMAND-SUBTRACTIONS                       EDIT0288
000275                GO TO READ-A-COMMAND.                                     EDIT0289
000276             READ OLD-VERSION AT END                                      EDIT0290
000277                MOVE "NOT FOUND IN OLD VERSION DOING DELETE"              EDIT0291
000278                      TO DISPLAY-TEXT                                     EDIT0292
000279                WRITE COMMENT-LINE FROM DISPLAY-MESSAGE                   EDIT0293
000280                GO TO END-JOB.                                            EDIT0294
000281             GO TO DELETION-PROCESS.                                      EDIT0295
000282                                                                          EDIT0296
000283         OUTPUT-A-RECORD.                                                 EDIT0297
000284             ADD 1 TO OUTPUT-COUNT.                                       EDIT0298
000285             MOVE OUTPUT-COUNT TO NEW-NUMBER.                             EDIT0299
000286             WRITE NEW-RECORD.                                            EDIT0300
000287                                                                          EDIT0301
000288         FINISH-JOB.                                                      EDIT0302
000289             READ OLD-VERSION AT END GO TO TEST-FOR-LISTING.              EDIT0303
000290             MOVE OLD-STATEMENT TO NEW-STATEMENT.                         EDIT0304
000291             GO TO OUTPUT-A-RECORD.                                       EDIT0305
000292                                                                          EDIT0306
000293         TEST-FOR-LISTING.                                                EDIT0307
000294             PERFORM TOP-OF-PAGE-ROUTINE.                                 EDIT0308
000295             MOVE OLD-NUMBER TO DISPLAY-TEMP.                             EDIT0309
000296             MOVE "RECORDS READ." TO DISPLAY-TEXT.                        EDIT0310
000297             WRITE COMMENT-LINE FROM DISPLAY-MESSAGE.                     EDIT0311
000298             MOVE TOTAL-INSERTED TO DISPLAY-TEMP.                         EDIT0312
000299             MOVE "RECORDS ADDED." TO DISPLAY-TEXT.                       EDIT0313
000300             WRITE COMMENT-LINE FROM DISPLAY-MESSAGE.                     EDIT0314
000301             MOVE TOTAL-DELETED TO DISPLAY-TEMP.                          EDIT0315
000302             MOVE "RECORDS DROPPED." TO DISPLAY-TEXT.                     EDIT0316
000303             WRITE COMMENT-LINE FROM DISPLAY-MESSAGE.                     EDIT0317
000304             MOVE OUTPUT-COUNT TO DISPLAY-TEMP.                           EDIT0318
000305             MOVE "RECORDS IN NEW FILE." TO DISPLAY-TEXT.                 EDIT0319
000306             WRITE COMMENT-LINE FROM DISPLAY-MESSAGE.                     EDIT0320
000307             IF UPSI-BIT (2) EQUAL "F" GO TO END-JOB.                     EDIT0321
000308             CLOSE NEW-VERSION.                                           EDIT0322
000309             OPEN INPUT NEW-VERSION.                                      EDIT0323
000310             MOVE "UPDATED LISTING" TO PHASE.                             EDIT0324
000311             MOVE ZEROES TO PAGE-NUMBER.                                  EDIT0325
000312             PERFORM TOP-OF-PAGE-ROUTINE.                                 EDIT0326
000313             MOVE SPACES TO DISPOSITION.                                  EDIT0327
000314                                                                          EDIT0328
000315         LISTING-LOOP.                                                    EDIT0329
GnuCOBOL V.R.P          prog.cob                                                     DDD MMM dd HH:MM:SS YYYY  Page 0007

LINE    PG/LN  A...B............................................................SEQUENCE

000316             READ NEW-VERSION AT END GO TO END-JOB.                       EDIT0330
000317             MOVE NEW-RECORD TO ACTIVE-IMAGE.                             EDIT0331
000318             WRITE COMMENT-LINE FROM ACTIVITIES-LISTING.                  EDIT0332
000319             ADD 1 TO LINE-COUNT.                                         EDIT0333
000320             IF LINE-COUNT EQUAL 56 PERFORM TOP-OF-PAGE-ROUTINE.          EDIT0334
000321             GO TO LISTING-LOOP.                                          EDIT0335
000322                                                                          EDIT0336
000323         END-JOB.                                                         EDIT0337
000324             MOVE "PROGRAM TERMINATION" TO MESSAGE-TEXT.                  EDIT0338
000325             WRITE COMMENT-LINE FROM MESSAGE-LOG.                         EDIT0339
000326             CLOSE OLD-VERSION, NEW-VERSION, MODIFICATION, COMMENTARY.    EDIT0340
000327             STOP RUN.                                                    EDIT0341
000328                                                                          EDIT0342
000329         END PROGRAM EDITOR.                                              EDIT0343
GnuCOBOL V.R.P          prog.cob                                                     DDD MMM dd HH:MM:SS YYYY  Page 0008

SIZE TYPE           LVL  NAME                           PICTURE

0080 FILE                OLD-VERSION
0080 GROUP          01   OLD-RECORD
0075 ALPHANUMERIC   02     OLD-STATEMENT                X(75)
0005 ALPHANUMERIC   02     OLD-NUMBER                   X(5)

0080 FILE                NEW-VERSION
0080 GROUP          01   NEW-RECORD
0075 ALPHANUMERIC   02     NEW-STATEMENT                X(75)
0005 ALPHANUMERIC   02     NEW-NUMBER                   X(5)

0032 FILE                PRT-VERSION

0080 FILE                MODIFICATION
0080 GROUP          01   UPDATE-ORDER
0075 ALPHANUMERIC   02     INSERTION
0006 ALPHANUMERIC   03       COMMAND                    X(6)
     CONDITIONAL    88         ENDJOB
     CONDITIONAL    88         ENDSET
     CONDITIONAL    88         REMOVE
     CONDITIONAL    88         ADDNEW
     CONDITIONAL    88         CHANGE
     CONDITIONAL    88         DISPLY
0001 ALPHANUMERIC   03       FILLER                     X
0005 NUMERIC        03       A-FIELD                    9(5)
0005 ALPHANUMERIC-R 03       A-ALPHA                    X(5)
     CONDITIONAL    88         A-BLANK
0004 ALPHANUMERIC   03       FILLER                     X(4)
0005 NUMERIC        03       B-FIELD                    9(5)
0005 ALPHANUMERIC-R 03       B-ALPHA                    X(5)
     CONDITIONAL    88         B-BLANK
0054 ALPHANUMERIC   03       FILLER                     X(54)
0005 ALPHANUMERIC   02     FILLER                       X(5)

0082 FILE                COMMENTARY
0082 GROUP          01   COMMENT-LINE
0082 ALPHANUMERIC   02     FILLER                       X(82)

0002 NUMERIC        77   COMMAND-ADDITIONS              9(3) COMP
0002 NUMERIC        77   COMMAND-SUBTRACTIONS           9(3) COMP
0002 NUMERIC        77   TOTAL-INSERTED                 9(3) COMP
0002 NUMERIC        77   TOTAL-DELETED                  9(3) COMP
0004 NUMERIC        77   OUTPUT-COUNT                   9(5) COMP
0001 NUMERIC        77   LINE-COUNT                     9(2) COMP
0005 NUMERIC        77   FIELDA                         9(5)
0005 NUMERIC        77   FIELDB                         9(5)
0082 ALPHANUMERIC   77   BLANK-LINE                     X(82)

0006 GROUP          01   DATE-FROM-SYS
0002 NUMERIC        02     DFSYS                        99

0080 GROUP          01   HEADINGS-LINE
0015 ALPHANUMERIC   02     FILLER                       X(15)
0020 ALPHANUMERIC   02     FILLER                       X(20)
0017 ALPHANUMERIC   02     PHASE                        X(17)
GnuCOBOL V.R.P          prog.cob                                                     DDD MMM dd HH:MM:SS YYYY  Page 0009

SIZE TYPE           LVL  NAME                           PICTURE

0002 ALPHANUMERIC   02     MONTH-RUN                    XX
0001 ALPHANUMERIC   02     FILLER                       X
0002 ALPHANUMERIC   02     DAY-RUN                      XX
0001 ALPHANUMERIC   02     FILLER                       X
0002 ALPHANUMERIC   02     YEAR-RUN                     XX
0008 ALPHANUMERIC   02     FILLER                       X(8)
0008 ALPHANUMERIC   02     FILLER                       X(8)
0004 NUMERIC        02     PAGE-NUMBER                  9(4)

0082 GROUP          01   COMMAND-LISTING
0002 ALPHANUMERIC   02     FILLER                       X(2)
0080 ALPHANUMERIC   02     COMMAND-IMAGE                X(80)

0082 GROUP          01   ACTIVITIES-LISTING
0002 ALPHANUMERIC   02     DISPOSITION                  X(2)
0080 ALPHANUMERIC   02     ACTIVE-IMAGE                 X(80)

0008 GROUP          01   UPSI-BYTE
0001 ALPHANUMERIC   02     UPSI-BIT                     X

0082 GROUP          01   MESSAGE-LOG
0002 ALPHANUMERIC   02     FILLER                       X(2)
0080 ALPHANUMERIC   02     MESSAGE-TEXT                 X(80)

0070 GROUP          01   DISPLAY-MESSAGE
0002 ALPHANUMERIC   02     FILLER                       X(2)
0006 ALPHANUMERIC   02     DISPLAY-TEMP                 X(6)
0002 ALPHANUMERIC   02     FILLER                       X(2)
0060 ALPHANUMERIC   02     DISPLAY-TEXT                 X(60)

0001 NUMERIC        77   END-JOB-PROCESS                9
0001 NUMERIC        77   DELETE-PROCESS                 9
0001 NUMERIC        77   INSERT-PROCESS                 9
0001 NUMERIC        77   WRITE-PROCESS                  9

0002 GROUP          01   SELECTORS
0001 NUMERIC        02     RETURN-SELECT                9
0001 NUMERIC        02     NEXT-JOB-SELECT              9

GnuCOBOL V.R.P          prog.cob                                                     DDD MMM dd HH:MM:SS YYYY  Page 0010

NAME                           DEFINED                                    REFERENCES

OLD-VERSION                     000030  000045  000158  000164  000210  000276  000289  000326
OLD-RECORD                      000050  000262
OLD-STATEMENT                   000051  000168  000216  000253  000273  000290
OLD-NUMBER                      000052  000206  000215  000268  000295

NEW-VERSION                     000032  000054  000158  000286  000308  000309  000316  000326
NEW-RECORD                      000059  000286  000317
NEW-STATEMENT                   000060  000168  000216  000240  000253  000273  000290
NEW-NUMBER                      000061  000285

PRT-VERSION                     000034

MODIFICATION                    000036  000063  000158  000178  000229  000326
UPDATE-ORDER                    000068  000182
INSERTION                       000069  000240
COMMAND                         000070
ENDJOB                          000071  000195
ENDSET                          000072  000233
REMOVE                          000073  000192
ADDNEW                          000074  000196
CHANGE                          000075  000191
DISPLY                          000076  000193
A-FIELD                         000078  000185  000187
A-ALPHA                         000079
A-BLANK                         000080  000185
B-FIELD                         000082  000186  000188
B-ALPHA                         000083
B-BLANK                         000084  000186

COMMENTARY                      000038  000088  000158  000166  000174  000175  000180  000183  000198  000208  000213
                                        000231  000236  000243  000264  000271  000279  000297  000300  000303  000306
                                        000318  000325  000326
COMMENT-LINE                    000093  000166  000174  000175  000180  000183  000198  000208  000213  000231  000236
                                        000243  000264  000271  000279  000297  000300  000303  000306  000318  000325

COMMAND-ADDITIONS               000098  000234  000237  000238  000244
COMMAND-SUBTRACTIONS            000099  000267  000269  000272  000274
TOTAL-INSERTED                  000100  000237  000298
TOTAL-DELETED                   000101  000272  000301
OUTPUT-COUNT                    000102  000284  000285  000304
LINE-COUNT                      000103  000173  000184  000245  000246  000265  000266  000319  000320
FIELDA                          000104  000187  000206  000212  000215
FIELDB                          000105  000188  000268
BLANK-LINE                      000106  000175
DATE-FROM-SYS                   000108  000160
DFSYS                           000109  000161  000162  000163
HEADINGS-LINE                   000111  000174
PHASE                           000114  000310
MONTH-RUN                       000115  000162
DAY-RUN                         000117  000163
YEAR-RUN                        000119  000161
PAGE-NUMBER                     000122  000172  000311
COMMAND-LISTING                 000124  000183
COMMAND-IMAGE                   000126  000182
GnuCOBOL V.R.P          prog.cob                                                     DDD MMM dd HH:MM:SS YYYY  Page 0011

NAME                           DEFINED                                    REFERENCES

ACTIVITIES-LISTING              000128  000243  000264  000318
DISPOSITION                     000129  000241  000263  000313
ACTIVE-IMAGE                    000130  000240  000262  000317
UPSI-BYTE                       000132
UPSI-BIT                        000133  000159  000193  000307
MESSAGE-LOG                     000135  000166  000180  000198  000208  000231  000325
MESSAGE-TEXT                    000137  000165  000179  000197  000207  000230  000324
DISPLAY-MESSAGE                 000139  000213  000236  000271  000279  000297  000300  000303  000306
DISPLAY-TEMP                    000141  000212  000234  000269  000295  000298  000301  000304
DISPLAY-TEXT                    000143  000211  000235  000270  000277  000296  000299  000302  000305
END-JOB-PROCESS                 000145
DELETE-PROCESS                  000146
INSERT-PROCESS                  000147
WRITE-PROCESS                   000148
SELECTORS                       000150
RETURN-SELECT                   000151
NEXT-JOB-SELECT                 000152

GnuCOBOL V.R.P          prog.cob                                                     DDD MMM dd HH:MM:SS YYYY  Page 0012

LABEL                          DEFINED                                    REFERENCES

START-SECTION                   000156
TOP-OF-PAGE-ROUTINE             000171  000246  000266  000294  000312  000320
READ-A-COMMAND                  000177  000199  000209  000255  000275
TEST-COMMAND-TYPE               000190
CHANGE-A-RECORD                 000201  000191
FIND-FIELDA                     000205  000218  000226  000259
RETURN-TO-USER                  000220  000202  000224  000258
INSERT-A-RECORD                 000223  000196
INSERTION-PROCESS               000228  000202  000224  000247
NEXT-JOB-STEP                   000249  000203  000225  000239
FORCED-WRITE                    000252  000225
DELETE-A-RECORD                 000257  000192
DELETION-PROCESS                000261  000203  000258  000281
OUTPUT-A-RECORD                 000283  000169  000217  000242  000254  000291
FINISH-JOB                      000288  000181  000194  000195
TEST-FOR-LISTING                000293  000289
LISTING-LOOP                    000315  000321
END-JOB                         000323  000167  000214  000221  000232  000250  000280  000307  000316

15 Warnings in program
0 Errors in program
])

AT_CHECK([$UNIFY_LISTING prog.lst prog.lis], [0], [], [])
AT_CHECK([diff prog19.lst prog.lis], [0], [], [])

AT_CLEANUP

