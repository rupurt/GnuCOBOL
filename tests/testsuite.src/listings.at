## Copyright (C) 2003-2012, 2014-2015 Free Software Foundation, Inc.
## Written by Keisuke Nishida, Roger While, Simon Sobisch
## 
## This file is part of GnuCOBOL.
## 
## The GnuCOBOL compiler is free software: you can redistribute it
## and/or modify it under the terms of the GNU General Public License
## as published by the Free Software Foundation, either version 3 of the
## License, or (at your option) any later version.
## 
## GnuCOBOL is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
## GNU General Public License for more details.
## 
## You should have received a copy of the GNU General Public License
## along with GnuCOBOL.  If not, see <http://www.gnu.org/licenses/>.

### GnuCOBOL Test Suite

AT_SETUP([COPY within comment])
AT_KEYWORDS([listing])

AT_DATA([sed.txt],
[s/@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@ @<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@/HH:MM:SS YYYY/g
])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
      *COPY "copy.inc".
       PROCEDURE        DIVISION.
           STOP RUN.
])

daymon=`date +"%a %b %e"`
AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [], [])

AT_DATA([prog1.lst],
[GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006        *COPY "copy.inc".
000007         PROCEDURE        DIVISION.
000008             STOP RUN.
GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
0 Errors in program
])

sed -e 's/'"$daymon"'/DDD MMM dd/g' -f sed.txt <prog.lst >prog.lis
AT_CAPTURE_FILE(prog.lis)
AT_CHECK([diff prog1.lst prog.lis], [0], [], [])

AT_DATA([prog2.cob], [
  IDENTIFICATION   DIVISION.
  PROGRAM-ID.      prog2.
  DATA             DIVISION.
  WORKING-STORAGE  SECTION.
  *> COPY "copy.inc".
  PROCEDURE        DIVISION.
  STOP RUN.
])


daymon=`date +"%a %b %e"`
AT_CHECK([$COMPILE_ONLY -t prog.lst -free prog2.cob], [0], [], [])

AT_DATA([prog2.lst],
[GnuCOBOL 2.0.0   prog2.cob                  DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    .....................SOURCE.............................................

000001
000002    IDENTIFICATION   DIVISION.
000003    PROGRAM-ID.      prog2.
000004    DATA             DIVISION.
000005    WORKING-STORAGE  SECTION.
000006    *> COPY "copy.inc".
000007    PROCEDURE        DIVISION.
000008    STOP RUN.
GnuCOBOL 2.0.0   prog2.cob                  DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
0 Errors in program
])

sed -e 's/'"$daymon"'/DDD MMM dd/g' -f sed.txt <prog.lst >prog.lis
AT_CAPTURE_FILE(prog.lis)
AT_CHECK([diff prog2.lst prog.lis], [0], [], [])

AT_CLEANUP


AT_SETUP([COPY replacement order])
AT_KEYWORDS([listing])

AT_DATA([sed.txt],
[s/@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@ @<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@/HH:MM:SS YYYY/g
])

AT_DATA([copy.inc], [
       01 TEST-VAR PIC X(2) VALUE "OK".
])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       COPY "copy.inc"
          REPLACING ==TEST-VAR== BY ==FIRST-MATCH==
                    ==TEST-VAR== BY ==SECOND-MATCH==.
       PROCEDURE        DIVISION.
           DISPLAY FIRST-MATCH NO ADVANCING
           END-DISPLAY.
           STOP RUN.
])

daymon=`date +"%a %b %e"`
AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [], [])

AT_DATA([prog3.lst],
[GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         COPY "copy.inc"
000007            REPLACING ==TEST-VAR== BY ==FIRST-MATCH==
000008                      ==TEST-VAR== BY ==SECOND-MATCH==.
000001C
000002C        01 FIRST-MATCH PIC X(2) VALUE "OK".
000009         PROCEDURE        DIVISION.
000010             DISPLAY FIRST-MATCH NO ADVANCING
000011             END-DISPLAY.
000012             STOP RUN.
GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0002 ALPHANUMERIC   01   FIRST-MATCH                    X(2)

0 Warnings in program
0 Errors in program
])

sed -e 's/'"$daymon"'/DDD MMM dd/g' -f sed.txt <prog.lst >prog.lis
AT_CAPTURE_FILE(prog.lis)
AT_CHECK([diff prog3.lst prog.lis], [0], [], [])

AT_CLEANUP


AT_SETUP([COPY separators])
AT_KEYWORDS([listing])

AT_DATA([sed.txt],
[s/@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@ @<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@/HH:MM:SS YYYY/g
])

AT_DATA([copy.inc], [
       01 TEST-VAR PIC X(2) VALUE "OK".
])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       COPY "copy.inc"
          REPLACING ==TEST-VAR==, BY ==FIRST-MATCH==,
                 ,  ==TEST-VAR==; BY ==SECOND-MATCH==;
                 ;  ==TEST-VAR== , BY ==THIRD-MATCH==
                    ==TEST-VAR== ; BY ==FOURTH-MATCH==.
       PROCEDURE        DIVISION.
           DISPLAY FIRST-MATCH NO ADVANCING
           END-DISPLAY.
           STOP RUN.
])

daymon=`date +"%a %b %e"`
AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [], [])

AT_DATA([prog4.lst],
[GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         COPY "copy.inc"
000007            REPLACING ==TEST-VAR==, BY ==FIRST-MATCH==,
000008                   ,  ==TEST-VAR==; BY ==SECOND-MATCH==;
000009                   ;  ==TEST-VAR== , BY ==THIRD-MATCH==
000010                      ==TEST-VAR== ; BY ==FOURTH-MATCH==.
000001C
000002C        01 FIRST-MATCH PIC X(2) VALUE "OK".
000011         PROCEDURE        DIVISION.
000012             DISPLAY FIRST-MATCH NO ADVANCING
000013             END-DISPLAY.
000014             STOP RUN.
GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0002 ALPHANUMERIC   01   FIRST-MATCH                    X(2)

0 Warnings in program
0 Errors in program
])

sed -e 's/'"$daymon"'/DDD MMM dd/g' -f sed.txt <prog.lst >prog.lis
AT_CAPTURE_FILE(prog.lis)
AT_CHECK([diff prog4.lst prog.lis], [0], [], [])

AT_CLEANUP


AT_SETUP([COPY partial replacement])
AT_KEYWORDS([listing])

AT_DATA([sed.txt],
[s/@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@ @<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@/HH:MM:SS YYYY/g
])

AT_DATA([copy.inc], [
       01 :TEST:-VAR PIC X(2) VALUE "OK".
       01 (TEST)-VAR PIC X(2) VALUE "OK".
])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       COPY "copy.inc"
          REPLACING ==:TEST:== BY ==COLON==
                    ==(TEST)== BY ==PAREN==.
       PROCEDURE        DIVISION.
           DISPLAY COLON-VAR NO ADVANCING
           END-DISPLAY.
           DISPLAY PAREN-VAR NO ADVANCING
           END-DISPLAY.
           STOP RUN.
])

daymon=`date +"%a %b %e"`
AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [], [])

AT_DATA([prog5.lst],
[GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         COPY "copy.inc"
000007            REPLACING ==:TEST:== BY ==COLON==
000008                      ==(TEST)== BY ==PAREN==.
000001C
000002C        01 COLON PIC X(2) VALUE "OK".
000003C        01 PAREN PIC X(2) VALUE "OK".
000009         PROCEDURE        DIVISION.
000010             DISPLAY COLON-VAR NO ADVANCING
000011             END-DISPLAY.
000012             DISPLAY PAREN-VAR NO ADVANCING
000013             END-DISPLAY.
000014             STOP RUN.
GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0002 ALPHANUMERIC   01   COLON-VAR                      X(2)

0002 ALPHANUMERIC   01   PAREN-VAR                      X(2)

0 Warnings in program
0 Errors in program
])

sed -e 's/'"$daymon"'/DDD MMM dd/g' -f sed.txt <prog.lst >prog.lis
AT_CAPTURE_FILE(prog.lis)
AT_CHECK([diff prog5.lst prog.lis], [0], [], [])

AT_CLEANUP


AT_SETUP([COPY LEADING replacement])
AT_KEYWORDS([listing])

AT_DATA([sed.txt],
[s/@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@ @<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@/HH:MM:SS YYYY/g
])

AT_DATA([copy.inc], [
       01  TEST-VAR PIC X(2) VALUE "OK".
       01  NORM-VAR PIC X(2) VALUE "OK".
])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       COPY "copy.inc"
            REPLACING LEADING ==TEST== BY ==FIRST==
                      LEADING ==NORM== BY ==SECOND==.
       PROCEDURE        DIVISION.
           DISPLAY FIRST-VAR NO ADVANCING
           END-DISPLAY.
           DISPLAY SECOND-VAR NO ADVANCING
           END-DISPLAY.
           STOP RUN.
])

daymon=`date +"%a %b %e"`
AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [], [])

AT_DATA([progl.lst],
[GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         COPY "copy.inc"
000007              REPLACING LEADING ==TEST== BY ==FIRST==
000008                        LEADING ==NORM== BY ==SECOND==.
000001C
000002C        01 FIRST-VAR PIC X(2) VALUE "OK".
000003C        01 SECOND-VAR PIC X(2) VALUE "OK".
000009         PROCEDURE        DIVISION.
000010             DISPLAY FIRST-VAR NO ADVANCING
000011             END-DISPLAY.
000012             DISPLAY SECOND-VAR NO ADVANCING
000013             END-DISPLAY.
000014             STOP RUN.
GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0002 ALPHANUMERIC   01   FIRST-VAR                      X(2)

0002 ALPHANUMERIC   01   SECOND-VAR                     X(2)

0 Warnings in program
0 Errors in program
])

sed -e 's/'"$daymon"'/DDD MMM dd/g' -f sed.txt <prog.lst >prog.lis
AT_CAPTURE_FILE(prog.lis)
AT_CHECK([diff progl.lst prog.lis], [0], [], [])

AT_CLEANUP

AT_SETUP([COPY TRAILING replacement])
AT_KEYWORDS([listing])

AT_DATA([sed.txt],
[s/@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@ @<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@/HH:MM:SS YYYY/g
])

AT_DATA([copy.inc], [
       01  TEST-FIRST  PIC X(2) VALUE "OK".
       01  TEST-SECOND PIC X(2) VALUE "OK".
])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       COPY "copy.inc"
            REPLACING TRAILING ==FIRST== BY ==VAR1==
                      TRAILING ==SECOND== BY ==VAR2==.
       PROCEDURE        DIVISION.
           DISPLAY TEST-VAR1 NO ADVANCING
           END-DISPLAY.
           DISPLAY TEST-VAR2 NO ADVANCING
           END-DISPLAY.
           STOP RUN.
])

daymon=`date +"%a %b %e"`
AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [], [])

AT_DATA([progr.lst],
[GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         COPY "copy.inc"
000007              REPLACING TRAILING ==FIRST== BY ==VAR1==
000008                        TRAILING ==SECOND== BY ==VAR2==.
000001C
000002C        01 TEST-VAR1 PIC X(2) VALUE "OK".
000003C        01 TEST-VAR2 PIC X(2) VALUE "OK".
000009         PROCEDURE        DIVISION.
000010             DISPLAY TEST-VAR1 NO ADVANCING
000011             END-DISPLAY.
000012             DISPLAY TEST-VAR2 NO ADVANCING
000013             END-DISPLAY.
000014             STOP RUN.
GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0002 ALPHANUMERIC   01   TEST-VAR1                      X(2)

0002 ALPHANUMERIC   01   TEST-VAR2                      X(2)

0 Warnings in program
0 Errors in program
])

sed -e 's/'"$daymon"'/DDD MMM dd/g' -f sed.txt <prog.lst >prog.lis
AT_CAPTURE_FILE(prog.lis)
AT_CHECK([diff progr.lst prog.lis], [0], [], [])

AT_CLEANUP

AT_SETUP([COPY recursive replacement])
AT_KEYWORDS([listing])

AT_DATA([sed.txt],
[s/@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@ @<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@/HH:MM:SS YYYY/g
])

AT_DATA([copy-2.inc], [
       01 TEST-VAR PIC X(2) VALUE "OK".
])

AT_DATA([copy-1.inc], [
       COPY "copy-2.inc".
])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       COPY "copy-1.inc"
           REPLACING ==TEST-VAR== BY ==COPY-VAR==.
       PROCEDURE        DIVISION.
           DISPLAY COPY-VAR NO ADVANCING
           END-DISPLAY.
           STOP RUN.
])

daymon=`date +"%a %b %e"`
AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [], [])

AT_DATA([prog6.lst],
[GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         COPY "copy-1.inc"
000007             REPLACING ==TEST-VAR== BY ==COPY-VAR==.
000001C
000002C        COPY "copy-2.inc".
000001C
000002C        01 COPY-VAR PIC X(2) VALUE "OK".
000008         PROCEDURE        DIVISION.
000009             DISPLAY COPY-VAR NO ADVANCING
000010             END-DISPLAY.
000011             STOP RUN.
GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0002 ALPHANUMERIC   01   COPY-VAR                       X(2)

0 Warnings in program
0 Errors in program
])

sed -e 's/'"$daymon"'/DDD MMM dd/g' -f sed.txt <prog.lst >prog.lis
AT_CAPTURE_FILE(prog.lis)
AT_CHECK([diff prog6.lst prog.lis], [0], [], [])

AT_CLEANUP

AT_SETUP([Eject page])
AT_KEYWORDS([listing])

AT_DATA([sed.txt],
[s/@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@ @<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@/HH:MM:SS YYYY/g
])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
      /
       PROCEDURE        DIVISION.
           STOP RUN.
])

daymon=`date +"%a %b %e"`
AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [], [])

AT_DATA([prog7.lst],
[GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0002

LINE    PG/LN  A...B............................................................

000006        /
000007         PROCEDURE        DIVISION.
000008             STOP RUN.
GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0003

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
0 Errors in program
])

sed -e 's/'"$daymon"'/DDD MMM dd/g' -f sed.txt <prog.lst >prog.lis
AT_CAPTURE_FILE(prog.lis)
AT_CHECK([diff prog7.lst prog.lis], [0], [], [])

AT_DATA([prog2.cob], [
  IDENTIFICATION   DIVISION.
  PROGRAM-ID.      prog2.
  DATA             DIVISION.
  WORKING-STORAGE  SECTION.
>>PAGE
  PROCEDURE        DIVISION.
  STOP RUN.
])


daymon=`date +"%a %b %e"`
AT_CHECK([$COMPILE_ONLY -t prog.lst -free prog2.cob], [0], [], [])

AT_DATA([prog8.lst],
[GnuCOBOL 2.0.0   prog2.cob                  DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    .....................SOURCE.............................................

000001
000002    IDENTIFICATION   DIVISION.
000003    PROGRAM-ID.      prog2.
000004    DATA             DIVISION.
000005    WORKING-STORAGE  SECTION.
GnuCOBOL 2.0.0   prog2.cob                  DDD MMM dd HH:MM:SS YYYY  Page 0002

LINE    .....................SOURCE.............................................

000006  >>PAGE
000007    PROCEDURE        DIVISION.
000008    STOP RUN.
GnuCOBOL 2.0.0   prog2.cob                  DDD MMM dd HH:MM:SS YYYY  Page 0003

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
0 Errors in program
])

sed -e 's/'"$daymon"'/DDD MMM dd/g' -f sed.txt <prog.lst >prog.lis
AT_CAPTURE_FILE(prog.lis)
AT_CHECK([diff prog8.lst prog.lis], [0], [], [])

AT_CLEANUP

AT_SETUP([Wide listing])
AT_KEYWORDS([listing])

AT_DATA([sed.txt],
[s/@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@ @<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@/HH:MM:SS YYYY/g
])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
      /
       PROCEDURE        DIVISION.
           STOP RUN.
])

daymon=`date +"%a %b %e"`
AT_CHECK([$COMPILE_ONLY -T prog.lst prog.cob], [0], [], [])

AT_DATA([prog9.lst],
[GnuCOBOL 2.0.0   prog.cob                                                           DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................SEQUENCE

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
GnuCOBOL 2.0.0   prog.cob                                                           DDD MMM dd HH:MM:SS YYYY  Page 0002

LINE    PG/LN  A...B............................................................SEQUENCE

000006        /
000007         PROCEDURE        DIVISION.
000008             STOP RUN.
GnuCOBOL 2.0.0   prog.cob                                                           DDD MMM dd HH:MM:SS YYYY  Page 0003

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
0 Errors in program
])

sed -e 's/'"$daymon"'/DDD MMM dd/g' -f sed.txt <prog.lst >prog.lis
AT_CAPTURE_FILE(prog.lis)
AT_CHECK([diff prog9.lst prog.lis], [0], [], [])

AT_DATA([prog2.cob], [
  IDENTIFICATION   DIVISION.
  PROGRAM-ID.      prog2.
  DATA             DIVISION.
  WORKING-STORAGE  SECTION.
  >>PAGE
  PROCEDURE        DIVISION.
  STOP RUN.
])


daymon=`date +"%a %b %e"`
AT_CHECK([$COMPILE_ONLY -T prog.lst -free prog2.cob], [0], [], [])

AT_DATA([prog10.lst],
[GnuCOBOL 2.0.0   prog2.cob                                                          DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    .....................................................SOURCE.....................................................

000001
000002    IDENTIFICATION   DIVISION.
000003    PROGRAM-ID.      prog2.
000004    DATA             DIVISION.
000005    WORKING-STORAGE  SECTION.
GnuCOBOL 2.0.0   prog2.cob                                                          DDD MMM dd HH:MM:SS YYYY  Page 0002

LINE    .....................................................SOURCE.....................................................

000006    >>PAGE
000007    PROCEDURE        DIVISION.
000008    STOP RUN.
GnuCOBOL 2.0.0   prog2.cob                                                          DDD MMM dd HH:MM:SS YYYY  Page 0003

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
0 Errors in program
])

sed -e 's/'"$daymon"'/DDD MMM dd/g' -f sed.txt <prog.lst >prog.lis
AT_CAPTURE_FILE(prog.lis)
AT_CHECK([diff prog10.lst prog.lis], [0], [], [])

AT_CLEANUP

AT_SETUP([Two source files])
AT_KEYWORDS([listing])

AT_DATA([sed.txt],
[s/@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@ @<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@/HH:MM:SS YYYY/g
])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
      *COPY "copy.inc".
       PROCEDURE        DIVISION.
           STOP RUN.
])

AT_DATA([prog1.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
      *COPY "copy.inc".
       PROCEDURE        DIVISION.
           STOP RUN.
])


daymon=`date +"%a %b %e"`
AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob prog1.cob], [0], [], [])

AT_DATA([prog11.lst],
[GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006        *COPY "copy.inc".
000007         PROCEDURE        DIVISION.
000008             STOP RUN.
GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
0 Errors in program
GnuCOBOL 2.0.0   prog1.cob                  DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006        *COPY "copy.inc".
000007         PROCEDURE        DIVISION.
000008             STOP RUN.
GnuCOBOL 2.0.0   prog1.cob                  DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
0 Errors in program
])

sed -e 's/'"$daymon"'/DDD MMM dd/g' -f sed.txt <prog.lst >prog.lis
AT_CAPTURE_FILE(prog.lis)
AT_CHECK([diff prog11.lst prog.lis], [0], [], [])

AT_CLEANUP

AT_SETUP([Error/Warning messages])
AT_KEYWORDS([listing])

AT_DATA([sed.txt],
[s/@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@ @<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@/HH:MM:SS YYYY/g
])

AT_DATA([copy.inc], [
       01 TEST-VAR PIC X(2) VULUE "OK".
])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       COPY "copy.inc".
       PROCEDURE        DIVISION.
           DISPLAY FIRST-MATCH NO ADVANCING
           END-DISPLAY.
           STOP RUN.
])

daymon=`date +"%a %b %e"`
AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [1], [],
[copy.inc: 2: Error: syntax error, unexpected Identifier, expecting EXTERNAL or GLOBAL
prog.cob: 8: Error: 'FIRST-MATCH' is not defined
])

AT_DATA([prog12.lst],
[GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         COPY "copy.inc".
000001C
000002C        01 TEST-VAR PIC X(2) VULUE "OK".
Error: syntax error, unexpected Identifier, expecting EXTERNAL or GLOBAL
000007         PROCEDURE        DIVISION.
000008             DISPLAY FIRST-MATCH NO ADVANCING
Error: 'FIRST-MATCH' is not defined
000009             END-DISPLAY.
000010             STOP RUN.
GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
2 Errors in program
])

sed -e 's/'"$daymon"'/DDD MMM dd/g' -f sed.txt <prog.lst >prog.lis
AT_CAPTURE_FILE(prog.lis)
AT_CHECK([diff prog12.lst prog.lis], [0], [], [])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 TEST-VAR PIC X(2) VULUE "OK".
       PROCEDURE        DIVISION.
           DISPLAY FIRST-MATCH NO ADVANCING
           END-DISPLAY.
           STOP RUN.
])

daymon=`date +"%a %b %e"`
AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [1], [],
[prog.cob: 6: Error: syntax error, unexpected Identifier, expecting EXTERNAL or GLOBAL
prog.cob: 8: Error: 'FIRST-MATCH' is not defined
])

AT_DATA([prog13.lst],
[GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         01 TEST-VAR PIC X(2) VULUE "OK".
Error: syntax error, unexpected Identifier, expecting EXTERNAL or GLOBAL
000007         PROCEDURE        DIVISION.
000008             DISPLAY FIRST-MATCH NO ADVANCING
Error: 'FIRST-MATCH' is not defined
000009             END-DISPLAY.
000010             STOP RUN.
GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
2 Errors in program
])

sed -e 's/'"$daymon"'/DDD MMM dd/g' -f sed.txt <prog.lst >prog.lis
AT_CAPTURE_FILE(prog.lis)
AT_CHECK([diff prog13.lst prog.lis], [0], [], [])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 TEST-VAR PIC 9(2) VALUE 'F1F2'.
       PROCEDURE        DIVISION.
           DISPLAY TEST-VAR NO ADVANCING
           END-DISPLAY.
           STOP RUN.
])

daymon=`date +"%a %b %e"`
AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [],
[prog.cob: 6: Warning: Numeric value is expected
])

AT_DATA([prog14.lst],
[GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         01 TEST-VAR PIC 9(2) VALUE 'F1F2'.
Warning: Numeric value is expected
000007         PROCEDURE        DIVISION.
000008             DISPLAY TEST-VAR NO ADVANCING
000009             END-DISPLAY.
000010             STOP RUN.
GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0002 NUMERIC        01   TEST-VAR                       9(2)

1 Warnings in program
0 Errors in program
])

sed -e 's/'"$daymon"'/DDD MMM dd/g' -f sed.txt <prog.lst >prog.lis
AT_CAPTURE_FILE(prog.lis)
AT_CHECK([diff prog14.lst prog.lis], [0], [], [])

AT_CLEANUP

AT_SETUP([Symbols])
AT_KEYWORDS([listing])

AT_DATA([sed.txt],
[s/@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@ @<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@/HH:MM:SS YYYY/g
])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       01 WS-ONE    PIC 9(4) VALUE 37.
       01 WS-TWO    PIC A(4) VALUE 'HIGH'.
       01 WS-THREE  PIC X(4) VALUE 'BAR'.
       01 WS-FOUR            COMP-1 VALUE 37.
       01 WS-FIVE            COMP-2 VALUE 37.
       01 WS-SIX    PIC S999 COMP-3 VALUE -37.
       01 WS-SEVEN  PIC $$,$$$,$$9.99 VALUE ZERO.
       PROCEDURE        DIVISION.
           STOP RUN.
])

daymon=`date +"%a %b %e"`
AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [], [])

AT_DATA([prog15.lst],
[GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         01 WS-ONE    PIC 9(4) VALUE 37.
000007         01 WS-TWO    PIC A(4) VALUE 'HIGH'.
000008         01 WS-THREE  PIC X(4) VALUE 'BAR'.
000009         01 WS-FOUR            COMP-1 VALUE 37.
000010         01 WS-FIVE            COMP-2 VALUE 37.
000011         01 WS-SIX    PIC S999 COMP-3 VALUE -37.
000012         01 WS-SEVEN  PIC $$,$$$,$$9.99 VALUE ZERO.
000013         PROCEDURE        DIVISION.
000014             STOP RUN.
GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0004 NUMERIC        01   WS-ONE                         9(4)

0004 ALPHABETIC     01   WS-TWO                         A(4)

0004 ALPHANUMERIC   01   WS-THREE                       X(4)

0004 NUMERIC        01   WS-FOUR                        S9(7)V9(8)

0008 NUMERIC        01   WS-FIVE                        S9(17)V9(17)

0002 NUMERIC        01   WS-SIX                         S999

0013 NUMERIC        01   WS-SEVEN                       $$,$$$,$$9.99

0 Warnings in program
0 Errors in program
])

sed -e 's/'"$daymon"'/DDD MMM dd/g' -f sed.txt <prog.lst >prog.lis
AT_CAPTURE_FILE(prog.lis)
AT_CHECK([diff prog15.lst prog.lis], [0], [], [])

AT_CLEANUP

AT_SETUP([Conditional compilation])
AT_KEYWORDS([listing])

AT_DATA([sed.txt],
[s/@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@ @<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@/HH:MM:SS YYYY/g
])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       PROCEDURE        DIVISION.
       >>IF ACTIVATE DEFINED
           DISPLAY "NOTOK" NO ADVANCING
           END-DISPLAY
       >>ELIF ACTIVATE2 DEFINED
           DISPLAY "OK" NO ADVANCING
           END-DISPLAY
       >>ELSE
           DISPLAY "NOTOK" NO ADVANCING
           END-DISPLAY
       >>END-IF
           STOP RUN.
])

daymon=`date +"%a %b %e"`
AT_CHECK([$COMPILE_ONLY -DACTIVATE2 -t prog.lst prog.cob], [0], [], [])

AT_DATA([prog16.lst],
[GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         PROCEDURE        DIVISION.
000007         >>IF ACTIVATE DEFINED
000008X            DISPLAY "NOTOK" NO ADVANCING
000009X            END-DISPLAY
000010         >>ELIF ACTIVATE2 DEFINED
000011             DISPLAY "OK" NO ADVANCING
000012             END-DISPLAY
000013         >>ELSE
000014X            DISPLAY "NOTOK" NO ADVANCING
000015X            END-DISPLAY
000016         >>END-IF
000017             STOP RUN.
GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE


0 Warnings in program
0 Errors in program
])

sed -e 's/'"$daymon"'/DDD MMM dd/g' -f sed.txt <prog.lst >prog.lis
AT_CAPTURE_FILE(prog.lis)
AT_CHECK([diff prog16.lst prog.lis], [0], [], [])

AT_CLEANUP

AT_SETUP([LISTING ON/OFF])
AT_KEYWORDS([listing])

AT_DATA([sed.txt],
[s/@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@ @<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@/HH:MM:SS YYYY/g
])

AT_DATA([copy.inc], [
       >>LISTING OFF
       01 TEST1-VAR PIC X(2) VALUE "OK".
       01 TEST2-VAR PIC X(2) VALUE "OK".
       01 TEST3-VAR PIC X(2) VALUE "OK".
       01 TEST4-VAR PIC X(2) VALUE "OK".
       >>LISTING ON
       01 TEST5-VAR PIC X(2) VALUE "OK".
       01 TEST6-VAR PIC X(2) VALUE "OK".
       01 TEST7-VAR PIC X(2) VALUE "OK".
       01 TEST8-VAR PIC X(2) VALUE "OK".
])

AT_DATA([prog.cob], [
       IDENTIFICATION   DIVISION.
       PROGRAM-ID.      prog.
       DATA             DIVISION.
       WORKING-STORAGE  SECTION.
       COPY "copy.inc".
       PROCEDURE        DIVISION.
           DISPLAY TEST1-VAR NO ADVANCING
           END-DISPLAY.
           STOP RUN.
])

daymon=`date +"%a %b %e"`
AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [], [])

AT_DATA([prog17.lst],
[GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION   DIVISION.
000003         PROGRAM-ID.      prog.
000004         DATA             DIVISION.
000005         WORKING-STORAGE  SECTION.
000006         COPY "copy.inc".
000001C
000002C        >>LISTING OFF
000007C        >>LISTING ON
000008C        01 TEST5-VAR PIC X(2) VALUE "OK".
000009C        01 TEST6-VAR PIC X(2) VALUE "OK".
000010C        01 TEST7-VAR PIC X(2) VALUE "OK".
000011C        01 TEST8-VAR PIC X(2) VALUE "OK".
000007         PROCEDURE        DIVISION.
000008             DISPLAY TEST1-VAR NO ADVANCING
000009             END-DISPLAY.
000010             STOP RUN.
GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0002

SIZE TYPE           LVL  NAME                           PICTURE

0002 ALPHANUMERIC   01   TEST1-VAR                      X(2)

0002 ALPHANUMERIC   01   TEST2-VAR                      X(2)

0002 ALPHANUMERIC   01   TEST3-VAR                      X(2)

0002 ALPHANUMERIC   01   TEST4-VAR                      X(2)

0002 ALPHANUMERIC   01   TEST5-VAR                      X(2)

0002 ALPHANUMERIC   01   TEST6-VAR                      X(2)

0002 ALPHANUMERIC   01   TEST7-VAR                      X(2)

0002 ALPHANUMERIC   01   TEST8-VAR                      X(2)

0 Warnings in program
0 Errors in program
])

sed -e 's/'"$daymon"'/DDD MMM dd/g' -f sed.txt <prog.lst >prog.lis
AT_CAPTURE_FILE(prog.lis)
AT_CHECK([diff prog17.lst prog.lis], [0], [], [])

AT_CLEANUP

AT_SETUP([File descriptions])
AT_KEYWORDS([listing])

AT_DATA([sed.txt],
[s/@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@:@<:@0-9@:>@@<:@0-9@:>@ @<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@@<:@0-9@:>@/HH:MM:SS YYYY/g
])

AT_DATA([prog.cob], [
       IDENTIFICATION DIVISION.
       PROGRAM-ID. prog.
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT OLD-VERSION  ASSIGN TO "SYSUT1"
                               ORGANIZATION LINE SEQUENTIAL.
           SELECT NEW-VERSION  ASSIGN TO "SYSUT2"
                               ORGANIZATION LINE SEQUENTIAL.
           SELECT PRT-VERSION  ASSIGN TO "SYSUT2"
                               ORGANIZATION LINE SEQUENTIAL.
           SELECT MODIFICATION ASSIGN TO "SYSIN1"
                               ORGANIZATION LINE SEQUENTIAL.
           SELECT COMMENTARY   ASSIGN TO "SYSOU1"
                               ORGANIZATION LINE SEQUENTIAL.
       DATA DIVISION.
       FILE SECTION.

       FD  OLD-VERSION
           LABEL RECORDS ARE STANDARD
           BLOCK CONTAINS 80 CHARACTERS
           DATA RECORD IS OLD-RECORD.

       01  OLD-RECORD.
           02 OLD-STATEMENT       PICTURE X(75).
           02 OLD-NUMBER          PICTURE X(5).

       FD  NEW-VERSION
           LABEL RECORDS ARE STANDARD
           BLOCK CONTAINS 80 CHARACTERS
           DATA RECORD IS NEW-RECORD.

       01  NEW-RECORD.
           02 NEW-STATEMENT       PICTURE X(75).
           02 NEW-NUMBER          PICTURE X(5).

       FD  MODIFICATION
           LABEL RECORDS ARE OMITTED
           BLOCK CONTAINS 80 CHARACTERS
           DATA RECORD IS UPDATE-ORDER.

       01  UPDATE-ORDER.
           02 INSERTION.
              03 COMMAND          PICTURE X(6).
                 88 ENDJOB        VALUE "ENDJOB".
                 88 ENDSET        VALUE "ENDSET".
                 88 REMOVE        VALUE "REMOVE".
                 88 ADDNEW        VALUE "INSERT".
                 88 CHANGE        VALUE "CHANGE".
                 88 DISPLY        VALUE "DISPLY".
              03 FILLER           PICTURE X.
              03 A-FIELD          PICTURE 9(5).
              03 A-ALPHA REDEFINES A-FIELD    PICTURE X(5).
                 88 A-BLANK       VALUE SPACES.
              03 FILLER           PICTURE X(4).
              03 B-FIELD          PICTURE 9(5).
              03 B-ALPHA REDEFINES B-FIELD    PICTURE X(5).
                 88 B-BLANK       VALUE SPACES.
              03 FILLER           PICTURE X(54).
           02 FILLER              PICTURE X(5).

       FD  COMMENTARY
           LABEL RECORDS ARE OMITTED
           BLOCK CONTAINS 82 CHARACTERS
           DATA RECORD IS COMMENT-LINE.

       01  COMMENT-LINE.
           02 FILLER              PICTURE X(82).

       WORKING-STORAGE  SECTION.

       01  HEADINGS-LINE.
           02 FILLER              PICTURE X(15) VALUE "EDITOR VERSION".
           02 FILLER              PICTURE X(20) VALUE "1.1 - 206/72".
           02 PHASE               PICTURE X(17) VALUE "UPDATING AS OF".
           02 MONTH-RUN           PICTURE XX.
           02 FILLER              PICTURE X VALUE "/".
           02 DAY-RUN             PICTURE XX.
           02 FILLER              PICTURE X VALUE "/".
           02 YEAR-RUN            PICTURE XX.
           02 FILLER              PICTURE X(8) VALUE SPACES.
           02 FILLER              PICTURE X(8) VALUE "  PAGE: ".
           02 PAGE-NUMBER         PICTURE 9(4) VALUE 0.

       01  COMMAND-LISTING.
           02 FILLER              PICTURE X(2) VALUE SPACES.
           02 COMMAND-IMAGE       PICTURE X(80).

       01  ACTIVITIES-LISTING.
           02 DISPOSITION         PICTURE X(2).
           02 ACTIVE-IMAGE        PICTURE X(80).

       01  UPSI-BYTE.
           02 UPSI-BIT OCCURS 8 TIMES  PICTURE X.

       01  MESSAGE-LOG.
           02 FILLER              PICTURE X(2) VALUE SPACES.
           02 MESSAGE-TEXT        PICTURE X(80).

       01  DISPLAY-MESSAGE.
           02 FILLER              PICTURE X(2) VALUE SPACES.
           02 DISPLAY-TEMP        PICTURE X(6).
           02 FILLER              PICTURE X(2) VALUE SPACES.
           02 DISPLAY-TEXT        PICTURE X(60).

       PROCEDURE DIVISION.
           OPEN INPUT OLD-VERSION, MODIFICATION,
                OUTPUT NEW-VERSION, COMMENTARY.
           CLOSE OLD-VERSION, NEW-VERSION, MODIFICATION, COMMENTARY.
           STOP RUN.
])

daymon=`date +"%a %b %e"`
AT_CHECK([$COMPILE_ONLY -t prog.lst prog.cob], [0], [],
[prog.cob: 21: Warning: LABEL RECORDS is obsolete in GnuCOBOL
prog.cob: 23: Warning: DATA RECORDS is obsolete in GnuCOBOL
prog.cob: 30: Warning: LABEL RECORDS is obsolete in GnuCOBOL
prog.cob: 32: Warning: DATA RECORDS is obsolete in GnuCOBOL
prog.cob: 39: Warning: LABEL RECORDS is obsolete in GnuCOBOL
prog.cob: 41: Warning: DATA RECORDS is obsolete in GnuCOBOL
prog.cob: 64: Warning: LABEL RECORDS is obsolete in GnuCOBOL
prog.cob: 66: Warning: DATA RECORDS is obsolete in GnuCOBOL
])


AT_DATA([prog18.lst],
[GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0001

LINE    PG/LN  A...B............................................................

000001
000002         IDENTIFICATION DIVISION.
000003         PROGRAM-ID. prog.
000004         ENVIRONMENT DIVISION.
000005         INPUT-OUTPUT SECTION.
000006         FILE-CONTROL.
000007             SELECT OLD-VERSION  ASSIGN TO "SYSUT1"
000008                                 ORGANIZATION LINE SEQUENTIAL.
000009             SELECT NEW-VERSION  ASSIGN TO "SYSUT2"
000010                                 ORGANIZATION LINE SEQUENTIAL.
000011             SELECT PRT-VERSION  ASSIGN TO "SYSUT2"
000012                                 ORGANIZATION LINE SEQUENTIAL.
000013             SELECT MODIFICATION ASSIGN TO "SYSIN1"
000014                                 ORGANIZATION LINE SEQUENTIAL.
000015             SELECT COMMENTARY   ASSIGN TO "SYSOU1"
000016                                 ORGANIZATION LINE SEQUENTIAL.
000017         DATA DIVISION.
000018         FILE SECTION.
000019
000020         FD  OLD-VERSION
000021             LABEL RECORDS ARE STANDARD
Warning: LABEL RECORDS is obsolete in GnuCOBOL
000022             BLOCK CONTAINS 80 CHARACTERS
000023             DATA RECORD IS OLD-RECORD.
Warning: DATA RECORDS is obsolete in GnuCOBOL
000024
000025         01  OLD-RECORD.
000026             02 OLD-STATEMENT       PICTURE X(75).
000027             02 OLD-NUMBER          PICTURE X(5).
000028
000029         FD  NEW-VERSION
000030             LABEL RECORDS ARE STANDARD
Warning: LABEL RECORDS is obsolete in GnuCOBOL
000031             BLOCK CONTAINS 80 CHARACTERS
000032             DATA RECORD IS NEW-RECORD.
Warning: DATA RECORDS is obsolete in GnuCOBOL
000033
000034         01  NEW-RECORD.
000035             02 NEW-STATEMENT       PICTURE X(75).
000036             02 NEW-NUMBER          PICTURE X(5).
000037
000038         FD  MODIFICATION
000039             LABEL RECORDS ARE OMITTED
Warning: LABEL RECORDS is obsolete in GnuCOBOL
000040             BLOCK CONTAINS 80 CHARACTERS
000041             DATA RECORD IS UPDATE-ORDER.
Warning: DATA RECORDS is obsolete in GnuCOBOL
000042
000043         01  UPDATE-ORDER.
000044             02 INSERTION.
000045                03 COMMAND          PICTURE X(6).
000046                   88 ENDJOB        VALUE "ENDJOB".
000047                   88 ENDSET        VALUE "ENDSET".
000048                   88 REMOVE        VALUE "REMOVE".
000049                   88 ADDNEW        VALUE "INSERT".
GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0002

LINE    PG/LN  A...B............................................................

000050                   88 CHANGE        VALUE "CHANGE".
000051                   88 DISPLY        VALUE "DISPLY".
000052                03 FILLER           PICTURE X.
000053                03 A-FIELD          PICTURE 9(5).
000054                03 A-ALPHA REDEFINES A-FIELD    PICTURE X(5).
000055                   88 A-BLANK       VALUE SPACES.
000056                03 FILLER           PICTURE X(4).
000057                03 B-FIELD          PICTURE 9(5).
000058                03 B-ALPHA REDEFINES B-FIELD    PICTURE X(5).
000059                   88 B-BLANK       VALUE SPACES.
000060                03 FILLER           PICTURE X(54).
000061             02 FILLER              PICTURE X(5).
000062
000063         FD  COMMENTARY
000064             LABEL RECORDS ARE OMITTED
Warning: LABEL RECORDS is obsolete in GnuCOBOL
000065             BLOCK CONTAINS 82 CHARACTERS
000066             DATA RECORD IS COMMENT-LINE.
Warning: DATA RECORDS is obsolete in GnuCOBOL
000067
000068         01  COMMENT-LINE.
000069             02 FILLER              PICTURE X(82).
000070
000071         WORKING-STORAGE  SECTION.
000072
000073         01  HEADINGS-LINE.
000074             02 FILLER              PICTURE X(15) VALUE "EDITOR VERSION".
000075             02 FILLER              PICTURE X(20) VALUE "1.1 - 206/72".
000076             02 PHASE               PICTURE X(17) VALUE "UPDATING AS OF".
000077             02 MONTH-RUN           PICTURE XX.
000078             02 FILLER              PICTURE X VALUE "/".
000079             02 DAY-RUN             PICTURE XX.
000080             02 FILLER              PICTURE X VALUE "/".
000081             02 YEAR-RUN            PICTURE XX.
000082             02 FILLER              PICTURE X(8) VALUE SPACES.
000083             02 FILLER              PICTURE X(8) VALUE "  PAGE: ".
000084             02 PAGE-NUMBER         PICTURE 9(4) VALUE 0.
000085
000086         01  COMMAND-LISTING.
000087             02 FILLER              PICTURE X(2) VALUE SPACES.
000088             02 COMMAND-IMAGE       PICTURE X(80).
000089
000090         01  ACTIVITIES-LISTING.
000091             02 DISPOSITION         PICTURE X(2).
000092             02 ACTIVE-IMAGE        PICTURE X(80).
000093
000094         01  UPSI-BYTE.
000095             02 UPSI-BIT OCCURS 8 TIMES  PICTURE X.
000096
000097         01  MESSAGE-LOG.
000098             02 FILLER              PICTURE X(2) VALUE SPACES.
000099             02 MESSAGE-TEXT        PICTURE X(80).
000100
000101         01  DISPLAY-MESSAGE.
000102             02 FILLER              PICTURE X(2) VALUE SPACES.
GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0003

LINE    PG/LN  A...B............................................................

000103             02 DISPLAY-TEMP        PICTURE X(6).
000104             02 FILLER              PICTURE X(2) VALUE SPACES.
000105             02 DISPLAY-TEXT        PICTURE X(60).
000106
000107         PROCEDURE DIVISION.
000108             OPEN INPUT OLD-VERSION, MODIFICATION,
000109                  OUTPUT NEW-VERSION, COMMENTARY.
000110             CLOSE OLD-VERSION, NEW-VERSION, MODIFICATION, COMMENTARY.
000111             STOP RUN.
GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0004

SIZE TYPE           LVL  NAME                           PICTURE

0080 FILE                OLD-VERSION
0080 GROUP          01   OLD-RECORD                      
0075 ALPHANUMERIC   02     OLD-STATEMENT                X(75)
0005 ALPHANUMERIC   02     OLD-NUMBER                   X(5)

0080 FILE                NEW-VERSION
0080 GROUP          01   NEW-RECORD                      
0075 ALPHANUMERIC   02     NEW-STATEMENT                X(75)
0005 ALPHANUMERIC   02     NEW-NUMBER                   X(5)

0032 FILE                PRT-VERSION

0080 FILE                MODIFICATION
0080 GROUP          01   UPDATE-ORDER                    
0075 ALPHANUMERIC   02     INSERTION                     
0006 ALPHANUMERIC   03       COMMAND                    X(6)
0001 ALPHANUMERIC   03       FILLER                     X
0005 ALPHANUMERIC   03       A-FIELD                    9(5)
0005 ALPHANUMERIC   03       A-ALPHA                    X(5)
0004 ALPHANUMERIC   03       FILLER                     X(4)
0005 ALPHANUMERIC   03       B-FIELD                    9(5)
0005 ALPHANUMERIC   03       B-ALPHA                    X(5)
0054 ALPHANUMERIC   03       FILLER                     X(54)
0005 ALPHANUMERIC   02     FILLER                       X(5)

0082 FILE                COMMENTARY
0082 GROUP          01   COMMENT-LINE                    
0082 ALPHANUMERIC   02     FILLER                       X(82)

0080 GROUP          01   HEADINGS-LINE                   
0015 ALPHANUMERIC   02     FILLER                       X(15)
0020 ALPHANUMERIC   02     FILLER                       X(20)
0017 ALPHANUMERIC   02     PHASE                        X(17)
0002 ALPHANUMERIC   02     MONTH-RUN                    XX
0001 ALPHANUMERIC   02     FILLER                       X
0002 ALPHANUMERIC   02     DAY-RUN                      XX
0001 ALPHANUMERIC   02     FILLER                       X
0002 ALPHANUMERIC   02     YEAR-RUN                     XX
0008 ALPHANUMERIC   02     FILLER                       X(8)
0008 ALPHANUMERIC   02     FILLER                       X(8)
0004 NUMERIC        02     PAGE-NUMBER                  9(4)

0082 GROUP          01   COMMAND-LISTING                 
0002 ALPHANUMERIC   02     FILLER                       X(2)
0080 ALPHANUMERIC   02     COMMAND-IMAGE                X(80)

0082 GROUP          01   ACTIVITIES-LISTING              
0002 ALPHANUMERIC   02     DISPOSITION                  X(2)
0080 ALPHANUMERIC   02     ACTIVE-IMAGE                 X(80)

0008 GROUP          01   UPSI-BYTE                       
0001 ALPHANUMERIC   02     UPSI-BIT                     X

0082 GROUP          01   MESSAGE-LOG                     
GnuCOBOL 2.0.0   prog.cob                   DDD MMM dd HH:MM:SS YYYY  Page 0005

SIZE TYPE           LVL  NAME                           PICTURE

0002 ALPHANUMERIC   02     FILLER                       X(2)
0080 ALPHANUMERIC   02     MESSAGE-TEXT                 X(80)

0070 GROUP          01   DISPLAY-MESSAGE                 
0002 ALPHANUMERIC   02     FILLER                       X(2)
0006 ALPHANUMERIC   02     DISPLAY-TEMP                 X(6)
0002 ALPHANUMERIC   02     FILLER                       X(2)
0060 ALPHANUMERIC   02     DISPLAY-TEXT                 X(60)

8 Warnings in program
0 Errors in program
])

sed -e 's/'"$daymon"'/DDD MMM dd/g' -f sed.txt <prog.lst >prog.lis
AT_CAPTURE_FILE(prog.lis)
AT_CHECK([diff prog18.lst prog.lis], [0], [], [])

AT_CLEANUP

